ACTOR Taradino {
	Health 100
	ActiveSound "Taradino/See"
	Deathsound "Taradino/Death"
	PainSound "Taradino/Pain"
	PainChance 32
	MinMissileChance 92
	XScale 0.68
	YScale 0.65
	Gravity 0.8125
	Speed 10
	Species "Player"
	BloodType "RottFreeleyBlood"	
	//Actor metrics.	
	Height 52
	Mass 100
	Radius 12
	Tag "Taradino Cassatt"
	MeleeRange 70
	MaxStepHeight 57 //This is equal to the maximum distance a player can jump. Modify to allow no jumps and stuff.
	MaxDropOffHeight 16383
	MaxTargetRange 65536	
	//Actor flags.
	MONSTER
	+FLOORCLIP
	+NOTELEPORT //We don't want them stepping into teleports. Let them teleport themselves when you are out of range.
	+QUICKTORETALIATE
	+NOBLOCKMONST
	+DONTHARMSPECIES
	+FIXMAPTHINGPOS
	+LOOKALLAROUND
	+PUSHABLE
	+SLIDESONWALLS
	+JUMPDOWN
	+NOTELESTOMP //Never telefrags. If it ever teleports into you, just punch it a few times.
	+THRUSPECIES
	+NOTAUTOAIMED
	+NOFEAR
	+NOINFIGHTING
	+MISSILEMORE
	+MISSILEEVENMORE
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	-DONTSPLASH
	-NORADIUSDMG
	-CANNOTPUSH
	-COUNTKILL	
	+MTHRUSPECIES	
	DamageFactor "Falling", 0.0 //We don't want our guy getting killed by the environment, so protect him from non-enemy hazards.
	DamageFactor "Crush", 0.0
	DamageFactor "Drowning", 0.0
	DamageFactor "Slime", 0.0
	DamageFactor "Massacre", 0.0 //And from "kill monsters" while we are at it. It was annoying me during debug and doesn't hurt. 
	DamageFactor "SWFlameCoop", 0.0	
	DamageFactor "CMDMGSHIT", 0.0	
	DamageFactor "SWStickyCoop", 0.0	
	DamageFactor "SWNukeCoop", 0.0		
	DamageFactor "SWRailgunCoop", 0.0
	DamageFactor "SWFlame2Coop", 0.0
	DamageFactor "PhosFireCoop", 0.0	
    DamageFactor "C7MineBoom", 0.0	
	DamageFactor "EradCoopExplosive2", 0.0
    DamageFactor "EradCoopGreenFire", 0.0	
	DamageFactor "IPOGGrenade", 0.0
	DamageFactor "IPOGTimeBomb", 0.0
	DamageFactor "IPOGProxyMine", 0.0		
	STATES {
		SPAWN:
			TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteAlways("Samsara_AllyHealthRegen", 0, 0, 0, 0)
		IDLE:
		SPAWN2:
			TNT1 A 0
			TNT1 A 0 A_GiveInventory("AllyToken", 1)
			AL15 A 1 A_LookEx(0, 0, 0, 0, 360)
			GOTO SEE
		
		SEE:
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "FOLLOWPLAYER")
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL15 A 0 A_FaceTarget
			AL15 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL15 A 1 A_Chase(0, 0)
			AL15 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL15 A 1 A_Chase(0, 0)
			AL15 A 0 A_Recoil(-1)
			TNT1 A 0 A_FaceTarget
			AL15 BBBBCCCCDDDDEEEE 1 A_Chase(0, "MISSILE")
			GOTO FOLLOWPLAYER
			
		IGNOREHELPERS: 
			//Look until you find something that is not a helper. If the other possible target is the player, go towards it.
			AL15 A 1 //Little delay to avoid infinite looping.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, 3)
			GOTO SEE
			TNT1 A 0 A_ClearTarget
			AL15 A 1 A_LookEx(0, 0, 0, 0, 360, "IGNOREHELPERS")
			GOTO FOLLOWPLAYER
			
		FOLLOWPLAYER:
			//Become unfriendly to chase the player directly. Lower their attack rate so they actually move towards it.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			//This part was influenced by Brutal Doom's helper marines. Dash, check for proximity to player to stay still, otherwise check if it should teleport.
			//It...works. Much better than regular A_Chase.
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_FaceTarget
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, 2)
			TNT1 A 0 A_ClearTarget
			
			AL15 BBBB 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL15 CCCC 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL15 DDDD 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")

			AL15 EEEE 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			GOTO SEE

		CHECKPLAYERDISTANCE:
			TNT1 A 0 A_JumpIfCloser(192, "STAND") //How far the player needs to be to teleport to it.
			GOTO FOLLOWPLAYER
			
		STAND:
			//In this state it'll be close to the player, therefore make it friendly again so it starts looking for monsters again.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			TNT1 A 0 A_ClearTarget
			
			//If you want proximity effects this is the place to go.
			TNT1 A 0 A_Jump(1, "LOOKAROUND")
			
			AL15 AA 1 A_LookEx(0, 0, 0, 0, 360, "SEE")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			AL15 A 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		LOOKAROUND:
			//The shoddiest caricature of looking around you can ever conceive. No need for applause.
			TNT1 A 0 A_SetAngle(angle + 45)
			AL15 OO 4 A_Look
			TNT1 A 0 A_SetAngle(angle + 45)
			AL15 OO 8 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL15 OO 4 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL15 OO 4 A_Look
			AL15 OOOO 8 A_Look
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0) //Return to hostile to follow player.
			AL15 E 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		MISSILE:
			//This is to be defined per-actor via inheritance. 
			//First the helper avoids targeting the player by looking for its resistance to helper damage.
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "CHECKPLAYERDISTANCE")
			//Then checks if the target is an ally and aborts.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			//And finally decides which weapon to use based on range. Weapon timings and damages need tweaking.
			TNT1 A 0 A_JumpIfCloser(256, "GOPRIMARY")
			TNT1 A 0 A_JumpIfCloser(512, "GOSECONDARY")
			GOTO GOPRIMARY
		
		GOPRIMARY:
			AL15 O 2 A_FaceTarget
			AL15 S 0 A_PlayWeaponSound("mp40/shoot")  
			AL15 P 3 Bright A_CustomMissile("RottMP40Bullet", 36, 0, angle+random(-36,36)/10.0, 128, random(-36,36)/10.0)
			AL15 T 0 A_Jump(8,"See")
			AL15 O 2 A_FaceTarget
			AL15 S 0 A_PlayWeaponSound("mp40/shoot")  
			AL15 P 3 Bright A_CustomMissile("RottMP40Bullet", 36, 0, angle+random(-36,36)/10.0, 128, random(-36,36)/10.0)
			AL15 T 0 A_Jump(8,"See")
			AL15 O 2 A_FaceTarget
			AL15 S 0 A_PlayWeaponSound("mp40/shoot")  
			AL15 P 3 Bright A_CustomMissile("RottMP40Bullet", 36, 0, angle+random(-36,36)/10.0, 128, random(-36,36)/10.0)
			AL15 T 0 A_Jump(8,"See")
			AL15 O 2 A_FaceTarget
			AL15 S 0 A_PlayWeaponSound("mp40/shoot")  
			AL15 P 3 Bright A_CustomMissile("RottMP40Bullet", 36, 0, angle+random(-36,36)/10.0, 128, random(-36,36)/10.0)
			AL15 T 0 A_Jump(8,"See")
			AL15 O 2 A_FaceTarget
			AL15 S 0 A_PlayWeaponSound("mp40/shoot")  
			AL15 P 3 Bright A_CustomMissile("RottMP40Bullet", 36, 0, angle+random(-36,36)/10.0, 128, random(-36,36)/10.0)
			AL15 T 0 A_Jump(8,"See")
			AL15 O 2 A_FaceTarget
			AL15 S 0 A_PlayWeaponSound("mp40/shoot")  
			AL15 P 3 Bright A_CustomMissile("RottMP40Bullet", 36, 0, angle+random(-36,36)/10.0, 128, random(-36,36)/10.0)
			AL15 T 0 A_Jump(8,"See")
			AL15 O 2 A_FaceTarget
			AL15 S 0 A_PlayWeaponSound("mp40/shoot")  
			AL15 P 3 Bright A_CustomMissile("RottMP40Bullet", 36, 0, angle+random(-36,36)/10.0, 128, random(-36,36)/10.0)
			AL15 T 0 A_CPOSRefire
			goto GOPRIMARY
		
		GOSECONDARY:
			TNT1 A 0		
			AL15 E 1 A_FaceTarget
			AL15 V 0 A_PlayWeaponSound("Bazooka/Shoot")  
			AL15 F 2 Bright A_CustomMissile("RottMissile",36)
			AL15 E 24 A_FaceTarget
			AL15 E 1 A_FaceTarget
			AL15 E 1 A_FaceTarget
			TNT1 A 0 A_Jump(128, "See")
			goto Missile
			
		PAIN:
			AL15 A 3 A_Pain
			AL15 A 3 //A_SpawnItemEx("giblets",0, 0, 32, random(3.0,4.5),random(3.0,4.5),random(-20.0,3.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)			
			GOTO SEE
		
		Pain.Slime:
			TNT1 A 0 A_GiveInventory("SlimeToken", 1)
			AL15 A 6 A_Playsound("freely/cough", CHAN_VOICE)
			GOTO SEE

		DEATH:
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL15 H 5 A_Noblocking
			AL15 I 5 A_Scream
			AL15 J 5 A_ChangeFLag("SOLID", 0)
			AL15 KLM 5
			AL15 N -1
			Stop

		Death.RottExplosive:
        XDeath:
		   GUTS A 1 A_PlaySound("Rott/gibbed")
//		   TNT1 A 0 A_Jump(96, 2)
//		   TNT1 A 0 A_GiveToTarget("LudicrousGibs", 1)
		   GUTS AAAAAAAAAAAAAAAAAAAAAAA 0 A_custommissile("wallgib",32.0, 0, random(0,360), CMF_AIMDIRECTION, random(0,45))
		   GUTS DDDDDDDDDDDDDDDDDDDDDDD 0 A_SpawnItemex ("giblets",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibarm",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
	       GUTS D 0 A_SpawnItemex ("Playerhead",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibhip",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("gibhum",0, 0, 32, random(3.0,5.0),random(3.0,5.0), random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibleg",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibribs",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS BCDEFGHIJK 5 A_Fall
		   GUTS L -1
		   Stop
		   
		Death.RottDisintegrate:
			TNT1 A 0 A_Scream
			TNT1 A 0 A_UnsetSolid
			TNT1 A 5 A_SpawnItem("RGodModeDeath")
			BLAN A -1
			stop
	   
	   Burn:
	   Death.RottFire:
			TNT1 A 0 A_Scream
			ske7 A 0 A_playsound("gen/burned") 
			ske7 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 bright
			skex ABCDEFGHIJKL 2 bright
			skex M 0 A_playsound("gen/skel") 
			skex MNOPQRSTUV 3 bright
			skex V -1 a_fall    
			Stop	
  

		TELEPORTCHECK:
			TNT1 A 1 A_JumpIfCloser(768, "FOLLOWPLAYER") //Change this to define how far from the player it should teleport.
			GOTO TELEPORTING
	
		TELEPORTING:
			//For some reason if I try to replace this via inheritance, it will execute the original and not the override.
			//Thus I got to do it the hard way, but at least it works!
			//I made the "ally tokens" in their inventory to be an indicator of their level, and thus it spawns the required spawner actor.
			//This is also like in Brutal Doom, I tried other solutions but really required more monitoring or hackery, this is the best compromise.
			//At this point the actor will destroy itself and spawn a beacon. The beacon will follow around the player and try to spawn by
			//letting friendly damaging actors destroy them if in a suitable position.
			//This also regenerates the actor's health, so there's no need to keep track and makes them feel much more durable, and they
			//will mostly die whenever you can see them die.
			//Having the tokens decide the level did the trick, as I can override SPAWN in every children class. I wonder why I couldn't override this one?
			//I'll try doing it that way later in case it was some obscure bug.
			
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
			TNT1 A 0 A_ChangeFlag("NOBLOCKMAP", 1)
			TNT1 A 0 A_ChangeFlag("NOCLIP", 1)
			TNT1 A 0 A_ChangeFlag("SOLID", 0)
			TNT1 A 0 A_Noblocking	
			TNT1 A 1 A_SpawnItemEx("Telehax",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
			
	}
}

ACTOR Telehax {
	Radius 18
	Height 52
	Speed 32
	Health 1
	
	MaxTargetRange 192
	MinMissileChance 32
	DamageFactor "TelehaxSpawnCheck", 9999.0
	MaxDropOffHeight 16383 //There's no mountain tall enough...
	MaxStepHeight 16383 //And no abyss deep enough to contain the telehax's movement.
	
	MONSTER
	+NOTARGET
	+THRUACTORS
	+MISSILEMORE
	+MISSILEEVENMORE
	+NODAMAGETHRUST
	+FASTER
	+DONTSPLASH //You can remove this if you want, but it's kinda weird and creepy depending on the map.
	+NOCLIP
	+NOBLOCKMONST
	+LOOKALLAROUND
	+NOINFIGHTING
	+NOTELEPORT //Ironic.
	-SHOOTABLE
	-FRIENDLY
	-COUNTKILL
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	
	STATES {
		SPAWN:
			TNT1 A 0 A_LookEx(0, 0, 0, 360)
		PAIN:
		SEE:
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			LOOP
		MISSILE:
			TNT1 A 0 A_SpawnItem("AllySpawnChecker")
			TNT1 A 5
			GOTO SEE
		DEATH:
		MISSILE:
			TNT1 A 0 A_NoBlocking
			TNT1 A 1 A_SpawnItemEx("Taradino",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
	}
}

ACTOR AllySpawnChecker {
	Health 1
	Radius 24
	Height 52
	DamageType "TelehaxSpawnCheck"
	
	MONSTER
	+FRIENDLY
	-COUNTKILL
	-SOLID
	-SHOOTABLE
	STATES {
		SPAWN:
			TNT1 A 0 A_AlertMonsters(24)
			TNT1 A 0 A_Explode(4, 24)
			STOP
		DEATH:
			TNT1 A 1 A_NoBlocking
			STOP
	}
}

ACTOR ThiBarret {
	Health 100
	ActiveSound "Thi/See"
	Deathsound "Thi/Death"
	PainSound "Thi/Pain"
	PainChance 32
	MinMissileChance 92
	XScale 0.68
	YScale 0.65
	Gravity 0.8125
	Speed 10
	Species "Player"
	BloodType "RottFreeleyBlood"	
	//Actor metrics.	
	Height 52
	Mass 100
	Radius 12
	Tag "Thi Barrett"
	MeleeRange 70
	MaxStepHeight 57 //This is equal to the maximum distance a player can jump. Modify to allow no jumps and stuff.
	MaxDropOffHeight 16383
	MaxTargetRange 65536	
	//Actor flags.
	MONSTER
	+FLOORCLIP
	+NOTELEPORT //We don't want them stepping into teleports. Let them teleport themselves when you are out of range.
	+QUICKTORETALIATE
	+NOBLOCKMONST
	+DONTHARMSPECIES
	+FIXMAPTHINGPOS
	+LOOKALLAROUND
	+PUSHABLE
	+SLIDESONWALLS
	+JUMPDOWN
	+NOTELESTOMP //Never telefrags. If it ever teleports into you, just punch it a few times.
	+THRUSPECIES
	+NOTAUTOAIMED
	+NOFEAR
	+NOINFIGHTING
	+MISSILEMORE
	+MISSILEEVENMORE
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	-DONTSPLASH
	-NORADIUSDMG
	-CANNOTPUSH
	-COUNTKILL	
	+MTHRUSPECIES	
	DamageFactor "Falling", 0.0 //We don't want our guy getting killed by the environment, so protect him from non-enemy hazards.
	DamageFactor "Crush", 0.0
	DamageFactor "Drowning", 0.0
	DamageFactor "Slime", 0.0
	DamageFactor "Massacre", 0.0 //And from "kill monsters" while we are at it. It was annoying me during debug and doesn't hurt. 
	DamageFactor "SWFlameCoop", 0.0	
	DamageFactor "CMDMGSHIT", 0.0	
	DamageFactor "SWStickyCoop", 0.0	
	DamageFactor "SWNukeCoop", 0.0		
	DamageFactor "SWRailgunCoop", 0.0
	DamageFactor "SWFlame2Coop", 0.0
	DamageFactor "PhosFireCoop", 0.0	
    DamageFactor "C7MineBoom", 0.0	
	DamageFactor "EradCoopExplosive2", 0.0
    DamageFactor "EradCoopGreenFire", 0.0	
	DamageFactor "IPOGGrenade", 0.0
	DamageFactor "IPOGTimeBomb", 0.0
	DamageFactor "IPOGProxyMine", 0.0	
	STATES {
		SPAWN:
			TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteAlways("Samsara_AllyHealthRegen", 0, 0, 0, 0)
		IDLE:
		SPAWN2:
			TNT1 A 0
			TNT1 A 0 A_GiveInventory("AllyToken", 1)
			AL16 A 1 A_LookEx(0, 0, 0, 0, 360)
			GOTO SEE
		
		SEE:
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "FOLLOWPLAYER")
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL16 A 0 A_FaceTarget
			AL16 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL16 A 1 A_Chase(0, 0)
			AL16 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL16 A 1 A_Chase(0, 0)
			AL16 A 0 A_Recoil(-1)
			TNT1 A 0 A_FaceTarget
			AL16 BBBBCCCCDDDDEEEE 1 A_Chase(0, "MISSILE")
			GOTO FOLLOWPLAYER
			
		IGNOREHELPERS: 
			//Look until you find something that is not a helper. If the other possible target is the player, go towards it.
			AL16 A 1 //Little delay to avoid infinite looping.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, 3)
			GOTO SEE
			TNT1 A 0 A_ClearTarget
			AL16 A 1 A_LookEx(0, 0, 0, 0, 360, "IGNOREHELPERS")
			GOTO FOLLOWPLAYER
			
		FOLLOWPLAYER:
			//Become unfriendly to chase the player directly. Lower their attack rate so they actually move towards it.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			//This part was influenced by Brutal Doom's helper marines. Dash, check for proximity to player to stay still, otherwise check if it should teleport.
			//It...works. Much better than regular A_Chase.
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			AL16 A 0 A_FaceTarget
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, 2)
			TNT1 A 0 A_ClearTarget
			
			AL16 BBBB 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL16 CCCC 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL16 DDDD 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")

			AL16 EEEE 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			GOTO SEE

		CHECKPLAYERDISTANCE:
			TNT1 A 0 A_JumpIfCloser(192, "STAND") //How far the player needs to be to teleport to it.
			GOTO FOLLOWPLAYER
			
		STAND:
			//In this state it'll be close to the player, therefore make it friendly again so it starts looking for monsters again.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			TNT1 A 0 A_ClearTarget
			
			//If you want proximity effects this is the place to go.
			TNT1 A 0 A_Jump(1, "LOOKAROUND")
			
			AL16 AA 1 A_LookEx(0, 0, 0, 0, 360, "SEE")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			AL16 A 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		LOOKAROUND:
			//The shoddiest caricature of looking around you can ever conceive. No need for applause.
			TNT1 A 0 A_SetAngle(angle + 45)
			AL16 FF 4 A_Look
			TNT1 A 0 A_SetAngle(angle + 45)
			AL16 FF 8 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL16 FF 4 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL16 FF 4 A_Look
			AL16 FFFF 8 A_Look
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0) //Return to hostile to follow player.
			AL16 E 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		MISSILE:
			//This is to be defined per-actor via inheritance. 
			//First the helper avoids targeting the player by looking for its resistance to helper damage.
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "CHECKPLAYERDISTANCE")
			//Then checks if the target is an ally and aborts.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			//And finally decides which weapon to use based on range. Weapon timings and damages need tweaking.
			TNT1 A 0 A_JumpIfCloser(256, "GOPRIMARY")
			TNT1 A 0 A_JumpIfCloser(512, "GOSECONDARY")
			GOTO GOPRIMARY
		
		GOPRIMARY:
			AL16 F 8 A_FaceTarget
			AL16 S 0 A_PlayWeaponSound("rott/pistolf")  
			AL16 G 3 Bright A_CustomMissile("RottPistolBullet", 36, 0, angle+random(-13,13)/10.0, 128, random(-13,13)/10.0)
			AL16 T 0 A_Jump(32,"See")
			AL16 T 0 A_CPOSRefire
			goto GOPRIMARY
		
		GOSECONDARY:
			TNT1 A 0		
			AL16 F 1 A_FaceTarget
			AL16 V 0 A_PlayWeaponSound("Bazooka/Shoot")  
			AL16 G 2 Bright A_CustomMissile("SMissile1",44,8) 
			AL16 F 0 Bright A_CustomMissile("SMissile2",44,-8) 
			AL16 F 24 A_FaceTarget
			AL16 F 1 A_FaceTarget
			AL16 F 1 A_FaceTarget
			TNT1 A 0 A_Jump(128, "See")
			goto Missile
			
		PAIN:
			AL16 A 3 A_Pain
			AL16 A 3 //A_SpawnItemEx("giblets",0, 0, 32, random(3.0,4.5),random(3.0,4.5),random(-20.0,3.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)						
			GOTO SEE
			
		Pain.Slime:
			TNT1 A 0 A_GiveInventory("SlimeToken", 1)
			AL16 A 6 A_Playsound("rottf/cough", CHAN_VOICE)
			GOTO SEE

		DEATH:
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL16 J 5 A_Noblocking
			AL16 K 5 A_Scream
			AL16 L 5 A_ChangeFLag("SOLID", 0)
			AL16 MNO 5
			AL16 P -1
			Stop

		Death.RottExplosive:
        XDeath:
		   GUTS A 1 A_PlaySound("Rott/gibbed")
//		   TNT1 A 0 A_Jump(96, 2)
//		   TNT1 A 0 A_GiveToTarget("LudicrousGibs", 1)
		   GUTS AAAAAAAAAAAAAAAAAAAAAAA 0 A_custommissile("wallgib",32.0, 0, random(0,360), CMF_AIMDIRECTION, random(0,45))
		   GUTS DDDDDDDDDDDDDDDDDDDDDDD 0 A_SpawnItemex ("giblets",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibarm",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("Playerhead",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibhip",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("gibhum",0, 0, 32, random(3.0,5.0),random(3.0,5.0), random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibleg",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibribs",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS BCDEFGHIJK 5 A_Fall
		   GUTS L -1
		   Stop
		   
       Death.RottDisintegrate:
			TNT1 A 0 A_Scream
			TNT1 A 0 A_UnsetSolid
			TNT1 A 5 A_SpawnItem("RGodModeDeath")
			BLAN A -1
			stop
	   
	   Burn:
	   Death.RottFire:
			TNT1 A 0 A_Scream
			ske7 A 0 A_playsound("gen/burned") 
			ske7 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 bright
			skex ABCDEFGHIJKL 2 bright
			skex M 0 A_playsound("gen/skel") 
			skex MNOPQRSTUV 3 bright
			skex V -1 a_fall    
			Stop	
  

		TELEPORTCHECK:
			TNT1 A 1 A_JumpIfCloser(768, "FOLLOWPLAYER") //Change this to define how far from the player it should teleport.
			GOTO TELEPORTING
	
		TELEPORTING:
			//For some reason if I try to replace this via inheritance, it will execute the original and not the override.
			//Thus I got to do it the hard way, but at least it works!
			//I made the "ally tokens" in their inventory to be an indicator of their level, and thus it spawns the required spawner actor.
			//This is also like in Brutal Doom, I tried other solutions but really required more monitoring or hackery, this is the best compromise.
			//At this point the actor will destroy itself and spawn a beacon. The beacon will follow around the player and try to spawn by
			//letting friendly damaging actors destroy them if in a suitable position.
			//This also regenerates the actor's health, so there's no need to keep track and makes them feel much more durable, and they
			//will mostly die whenever you can see them die.
			//Having the tokens decide the level did the trick, as I can override SPAWN in every children class. I wonder why I couldn't override this one?
			//I'll try doing it that way later in case it was some obscure bug.
			
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
			TNT1 A 0 A_ChangeFlag("NOBLOCKMAP", 1)
			TNT1 A 0 A_ChangeFlag("NOCLIP", 1)
			TNT1 A 0 A_ChangeFlag("SOLID", 0)
			TNT1 A 0 A_Noblocking	
			TNT1 A 1 A_SpawnItemEx("TelehaxThi",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
			
	}
}

ACTOR TelehaxThi {
	Radius 18
	Height 52
	Speed 32
	Health 1
	
	MaxTargetRange 192
	MinMissileChance 32
	DamageFactor "TelehaxSpawnCheck", 9999.0
	MaxDropOffHeight 16383 //There's no mountain tall enough...
	MaxStepHeight 16383 //And no abyss deep enough to contain the telehax's movement.
	
	MONSTER
	+NOTARGET
	+THRUACTORS
	+MISSILEMORE
	+MISSILEEVENMORE
	+NODAMAGETHRUST
	+FASTER
	+DONTSPLASH //You can remove this if you want, but it's kinda weird and creepy depending on the map.
	+NOCLIP
	+NOBLOCKMONST
	+LOOKALLAROUND
	+NOINFIGHTING
	+NOTELEPORT //Ironic.
	-SHOOTABLE
	-FRIENDLY
	-COUNTKILL
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	
	STATES {
		SPAWN:
			TNT1 A 0 A_LookEx(0, 0, 0, 360)
		PAIN:
		SEE:

			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			LOOP
		MISSILE:
			TNT1 A 0 A_SpawnItem("AllySpawnChecker")
			TNT1 A 5
			GOTO SEE
		DEATH:
		MISSILE:
			TNT1 A 0 A_NoBlocking
			TNT1 A 1 A_SpawnItemEx("ThiBarret",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
	}
}

ACTOR LoreleiNi {
	Health 100
	ActiveSound "Lorelei/See"
	Deathsound "Lorelei/Death"
	PainSound "Lorelei/Pain"
	PainChance 32
	MinMissileChance 92
	XScale 0.68
	YScale 0.65
	Gravity 0.8125
	Speed 10
	Species "Player"
	BloodType "RottFreeleyBlood"	
	//Actor metrics.	
	Height 52
	Mass 100
	Radius 12
	Tag "Lorelei Ni"
	MeleeRange 70
	MaxStepHeight 57 //Loreleis is equal to the maximum distance a player can jump. Modify to allow no jumps and stuff.
	MaxDropOffHeight 16383
	MaxTargetRange 65536	
	//Actor flags.
	MONSTER	
	+FLOORCLIP
	+NOTELEPORT //We don't want them stepping into teleports. Let them teleport themselves when you are out of range.
	+QUICKTORETALIATE
	+NOBLOCKMONST
	+DONTHARMSPECIES
	+FIXMAPTHINGPOS
	+LOOKALLAROUND
	+PUSHABLE
	+SLIDESONWALLS
	+JUMPDOWN
	+NOTELESTOMP //Never telefrags. If it ever teleports into you, just punch it a few times.
	+THRUSPECIES
	+NOTAUTOAIMED
	+NOFEAR
	+NOINFIGHTING
	+MISSILEMORE
	+MISSILEEVENMORE
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	-DONTSPLASH
	-NORADIUSDMG
	-CANNOTPUSH
	-COUNTKILL	
	+MTHRUSPECIES	
	DamageFactor "Falling", 0.0 //We don't want our guy getting killed by the environment, so protect him from non-enemy hazards.
	DamageFactor "Crush", 0.0
	DamageFactor "Drowning", 0.0
	DamageFactor "Slime", 0.0
	DamageFactor "Massacre", 0.0 //And from "kill monsters" while we are at it. It was annoying me during debug and doesn't hurt. 
	DamageFactor "SWFlameCoop", 0.0	
	DamageFactor "CMDMGSHIT", 0.0	
	DamageFactor "SWStickyCoop", 0.0	
	DamageFactor "SWNukeCoop", 0.0		
	DamageFactor "SWRailgunCoop", 0.0
	DamageFactor "SWFlame2Coop", 0.0
	DamageFactor "PhosFireCoop", 0.0	
    DamageFactor "C7MineBoom", 0.0	
	DamageFactor "EradCoopExplosive2", 0.0
    DamageFactor "EradCoopGreenFire", 0.0	
	DamageFactor "IPOGGrenade", 0.0
	DamageFactor "IPOGTimeBomb", 0.0
	DamageFactor "IPOGProxyMine", 0.0		
	STATES {
		SPAWN:
			TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteAlways("Samsara_AllyHealthRegen", 0, 0, 0, 0)
		IDLE:
		SPAWN2:
			TNT1 A 0
			TNT1 A 0 A_GiveInventory("AllyToken", 1)
			AL17 A 1 A_LookEx(0, 0, 0, 0, 360)
			GOTO SEE
		
		SEE:
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "FOLLOWPLAYER")
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL17 A 0 A_FaceTarget
			AL17 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL17 A 1 A_Chase(0, 0)
			AL17 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL17 A 1 A_Chase(0, 0)
			AL17 A 0 A_Recoil(-1)
			TNT1 A 0 A_FaceTarget
			AL17 BBBBCCCCDDDDEEEE 1 A_Chase(0, "MISSILE")
			GOTO FOLLOWPLAYER
			
		IGNOREHELPERS: 
			//Look until you find something that is not a helper. If the other possible target is the player, go towards it.
			AL17 A 1 //Little delay to avoid infinite looping.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, 3)
			GOTO SEE
			TNT1 A 0 A_ClearTarget
			AL17 A 1 A_LookEx(0, 0, 0, 0, 360, "IGNOREHELPERS")
			GOTO FOLLOWPLAYER
			
		FOLLOWPLAYER:
			//Become unfriendly to chase the player directly. Lower their attack rate so they actually move towards it.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			//Loreleis part was influenced by Brutal Doom's helper marines. Dash, check for proximity to player to stay still, otherwise check if it should teleport.
			//It...works. Much better than regular A_Chase.
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			AL17 A 0 A_FaceTarget
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, 2)
			TNT1 A 0 A_ClearTarget
			
			AL17 BBBB 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL17 CCCC 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL17 DDDD 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")

			AL17 EEEE 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			GOTO SEE

		CHECKPLAYERDISTANCE:
			TNT1 A 0 A_JumpIfCloser(192, "STAND") //How far the player needs to be to teleport to it.
			GOTO FOLLOWPLAYER
			
		STAND:
			//In Loreleis state it'll be close to the player, therefore make it friendly again so it starts looking for monsters again.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			TNT1 A 0 A_ClearTarget
			
			//If you want proximity effects Loreleis is the place to go.
			TNT1 A 0 A_Jump(1, "LOOKAROUND")
			
			AL17 AA 1 A_LookEx(0, 0, 0, 0, 360, "SEE")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			AL17 A 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		LOOKAROUND:
			//The shoddiest caricature of looking around you can ever conceive. No need for applause.
			TNT1 A 0 A_SetAngle(angle + 45)
			AL17 FF 4 A_Look
			TNT1 A 0 A_SetAngle(angle + 45)
			AL17 FF 8 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL17 FF 4 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL17 FF 4 A_Look
			AL17 FFFF 8 A_Look
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0) //Return to hostile to follow player.
			AL17 E 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		MISSILE:
			//Loreleis is to be defined per-actor via inheritance. 
			//First the helper avoids targeting the player by looking for its resistance to helper damage.
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "CHECKPLAYERDISTANCE")
			//Then checks if the target is an ally and aborts.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			//And finally decides which weapon to use based on range. Weapon timings and damages need tweaking.
			TNT1 A 0 A_JumpIfCloser(256, "GOPRIMARY")
			TNT1 A 0 A_JumpIfCloser(512, "GOSECONDARY")
			GOTO GOPRIMARY
		
		GOPRIMARY:
			AL17 F 8 A_FaceTarget
			AL17 S 0 A_PlayWeaponSound("rott/pistolf")  
			AL17 G 3 Bright A_CustomMissile("RottPistolBullet", 36, 0, angle+random(-13,13)/10.0, 128, random(-13,13)/10.0)
			AL17 T 0 A_Jump(32,"See")
			AL17 T 0 A_CPOSRefire
			goto GOPRIMARY
		
		GOSECONDARY:
			TNT1 A 0		
			AL17 H 1 A_FaceTarget
			AL17 V 0 A_PlayWeaponSound("Firebomb/Shoot")  
			AL17 I 2 Bright A_CustomMissile("FBomb",36)
			AL17 H 24 A_FaceTarget
			AL17 H 1 A_FaceTarget
			AL17 H 1 A_FaceTarget
			TNT1 A 0 A_Jump(128, "See")
			goto Missile
			
		PAIN:
			AL17 A 3 A_Pain
			AL17 A 3 //A_SpawnItemEx("giblets",0, 0, 32, random(3.0,4.5),random(3.0,4.5),random(-20.0,3.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
			GOTO SEE
		
		Pain.Slime:
			TNT1 A 0 A_GiveInventory("SlimeToken", 1)
			AL17 A 6 A_Playsound("rottf/cough", CHAN_VOICE)
			GOTO SEE

		DEATH:
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL17 J 5 A_Noblocking
			AL17 K 5 A_Scream
			AL17 L 5 A_ChangeFLag("SOLID", 0)
			AL17 MNO 5
			AL17 P -1
			Stop

		Death.RottExplosive:
        XDeath:
		   GUTS A 1 A_PlaySound("Rott/gibbed")
//		   TNT1 A 0 A_Jump(96, 2)
//		   TNT1 A 0 A_GiveToTarget("LudicrousGibs", 1)
		   GUTS AAAAAAAAAAAAAAAAAAAAAAA 0 A_custommissile("wallgib",32.0, 0, random(0,360), CMF_AIMDIRECTION, random(0,45))
		   GUTS DDDDDDDDDDDDDDDDDDDDDDD 0 A_SpawnItemex ("giblets",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibarm",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("Playerhead",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibhip",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("gibhum",0, 0, 32, random(3.0,5.0),random(3.0,5.0), random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibleg",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibribs",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS BCDEFGHIJK 5 A_Fall
		   GUTS L -1
		   Stop
		   
	   Death.RottDisintegrate:
			TNT1 A 0 A_Scream
			TNT1 A 0 A_UnsetSolid
			TNT1 A 5 A_SpawnItem("RGodModeDeath")
			BLAN A -1
			stop
	   
	   Burn:
	   Death.RottFire:
			TNT1 A 0 A_Scream
			ske7 A 0 A_playsound("gen/burned") 
			ske7 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 bright
			skex ABCDEFGHIJKL 2 bright
			skex M 0 A_playsound("gen/skel") 
			skex MNOPQRSTUV 3 bright
			skex V -1 a_fall    
			Stop	
  

		TELEPORTCHECK:
			TNT1 A 1 A_JumpIfCloser(768, "FOLLOWPLAYER") //Change Loreleis to define how far from the player it should teleport.
			GOTO TELEPORTING
	
		TELEPORTING:
			//For some reason if I try to replace Loreleis via inheritance, it will execute the original and not the override.
			//Thus I got to do it the hard way, but at least it works!
			//I made the "ally tokens" in their inventory to be an indicator of their level, and thus it spawns the required spawner actor.
			//Loreleis is also like in Brutal Doom, I tried other solutions but really required more monitoring or hackery, Loreleis is the best compromise.
			//At Loreleis point the actor will destroy itself and spawn a beacon. The beacon will follow around the player and try to spawn by
			//letting friendly damaging actors destroy them if in a suitable position.
			//Loreleis also regenerates the actor's health, so there's no need to keep track and makes them feel much more durable, and they
			//will mostly die whenever you can see them die.
			//Having the tokens decide the level did the trick, as I can override SPAWN in every children class. I wonder why I couldn't override Loreleis one?
			//I'll try doing it that way later in case it was some obscure bug.
			
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
			TNT1 A 0 A_ChangeFlag("NOBLOCKMAP", 1)
			TNT1 A 0 A_ChangeFlag("NOCLIP", 1)
			TNT1 A 0 A_ChangeFlag("SOLID", 0)
			TNT1 A 0 A_Noblocking	
			TNT1 A 1 A_SpawnItemEx("TelehaxLorelei",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
			
	}
}

ACTOR TelehaxLorelei {
	Radius 18
	Height 52
	Speed 32
	Health 1
	
	MaxTargetRange 192
	MinMissileChance 32
	DamageFactor "TelehaxSpawnCheck", 9999.0
	MaxDropOffHeight 16383 //There's no mountain tall enough...
	MaxStepHeight 16383 //And no abyss deep enough to contain the telehax's movement.
	
	MONSTER
	+NOTARGET
	+THRUACTORS
	+MISSILEMORE
	+MISSILEEVENMORE
	+NODAMAGETHRUST
	+FASTER
	+DONTSPLASH //You can remove Loreleis if you want, but it's kinda weird and creepy depending on the map.
	+NOCLIP
	+NOBLOCKMONST
	+LOOKALLAROUND
	+NOINFIGHTING
	+NOTELEPORT //Ironic.
	-SHOOTABLE
	-FRIENDLY
	-COUNTKILL
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	
	STATES {
		SPAWN:
			TNT1 A 0 A_LookEx(0, 0, 0, 360)
		PAIN:
		SEE:
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			LOOP
		MISSILE:
			TNT1 A 0 A_SpawnItem("AllySpawnChecker")
			TNT1 A 5
			GOTO SEE
		DEATH:
		MISSILE:
			TNT1 A 0 A_NoBlocking
			TNT1 A 1 A_SpawnItemEx("LoreleiNi",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
	}
}

ACTOR DougWendt {
	Health 100
	ActiveSound "Doug/See"
	Deathsound "Doug/Death"
	PainSound "Doug/Pain"
	PainChance 32
	MinMissileChance 92
	XScale 0.68
	YScale 0.65
	Gravity 0.8125	
	Speed 10
	Species "Player"
	BloodType "RottFreeleyBlood"
	//Actor metrics.	
	Height 52
	Mass 100
	Radius 12
	Tag "Doug Wendt"
	MeleeRange 70
	MaxStepHeight 57 //Dougs is equal to the maximum distance a player can jump. Modify to allow no jumps and stuff.
	MaxDropOffHeight 16383
	MaxTargetRange 65536	
	//Actor flags.
	MONSTER
	+FLOORCLIP
	+NOTELEPORT //We don't want them stepping into teleports. Let them teleport themselves when you are out of range.
	+QUICKTORETALIATE
	+NOBLOCKMONST
	+DONTHARMSPECIES
	+FIXMAPTHINGPOS
	+LOOKALLAROUND
	+PUSHABLE
	+SLIDESONWALLS
	+JUMPDOWN
	+NOTELESTOMP //Never telefrags. If it ever teleports into you, just punch it a few times.
	+THRUSPECIES
	+NOTAUTOAIMED
	+NOFEAR
	+NOINFIGHTING
	+MISSILEMORE
	+MISSILEEVENMORE
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	-DONTSPLASH
	-NORADIUSDMG
	-CANNOTPUSH
	-COUNTKILL	
	+MTHRUSPECIES	
	DamageFactor "Falling", 0.0 //We don't want our guy getting killed by the environment, so protect him from non-enemy hazards.
	DamageFactor "Crush", 0.0
	DamageFactor "Drowning", 0.0
	DamageFactor "Slime", 0.0
	DamageFactor "Massacre", 0.0 //And from "kill monsters" while we are at it. It was annoying me during debug and doesn't hurt. 
	DamageFactor "SWFlameCoop", 0.0	
	DamageFactor "CMDMGSHIT", 0.0	
	DamageFactor "SWStickyCoop", 0.0	
	DamageFactor "SWNukeCoop", 0.0		
	DamageFactor "SWRailgunCoop", 0.0
	DamageFactor "SWFlame2Coop", 0.0
	DamageFactor "PhosFireCoop", 0.0	
    DamageFactor "C7MineBoom", 0.0	
	DamageFactor "EradCoopExplosive2", 0.0
    DamageFactor "EradCoopGreenFire", 0.0	
	DamageFactor "IPOGGrenade", 0.0
	DamageFactor "IPOGTimeBomb", 0.0
	DamageFactor "IPOGProxyMine", 0.0		
	STATES {
		SPAWN:
			TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteAlways("Samsara_AllyHealthRegen", 0, 0, 0, 0)
		IDLE:
		SPAWN2:
			TNT1 A 0
			TNT1 A 0 A_GiveInventory("AllyToken", 1)
			AL18 A 1 A_LookEx(0, 0, 0, 0, 360)
			GOTO SEE
		
		SEE:
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "FOLLOWPLAYER")
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL18 A 0 A_FaceTarget
			AL18 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL18 A 1 A_Chase(0, 0)
			AL18 A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			AL18 A 1 A_Chase(0, 0)
			AL18 A 0 A_Recoil(-1)
			TNT1 A 0 A_FaceTarget
			AL18 BBBBCCCCDDDDEEEE 1 A_Chase(0, "MISSILE")
			GOTO FOLLOWPLAYER
			
		IGNOREHELPERS: 
			//Look until you find someDougng that is not a helper. If the other possible target is the player, go towards it.
			AL18 A 1 //Little delay to avoid infinite looping.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, 3)
			GOTO SEE
			TNT1 A 0 A_ClearTarget
			AL18 A 1 A_LookEx(0, 0, 0, 0, 360, "IGNOREHELPERS")
			GOTO FOLLOWPLAYER
			
		FOLLOWPLAYER:
			//Become unfriendly to chase the player directly. Lower their attack rate so they actually move towards it.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			//Dougs part was influenced by Brutal Doom's helper marines. Dash, check for proximity to player to stay still, otherwise check if it should teleport.
			//It...works. Much better than regular A_Chase.
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			AL18 A 0 A_FaceTarget
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, 2)
			TNT1 A 0 A_ClearTarget
			
			AL18 BBBB 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL18 CCCC 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			AL18 DDDD 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")

			AL18 EEEE 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			GOTO SEE

		CHECKPLAYERDISTANCE:
			TNT1 A 0 A_JumpIfCloser(192, "STAND") //How far the player needs to be to teleport to it.
			GOTO FOLLOWPLAYER
			
		STAND:
			//In Dougs state it'll be close to the player, therefore make it friendly again so it starts looking for monsters again.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			TNT1 A 0 A_ClearTarget
			
			//If you want proximity effects Dougs is the place to go.
			TNT1 A 0 A_Jump(1, "LOOKAROUND")
			
			AL18 AA 1 A_LookEx(0, 0, 0, 0, 360, "SEE")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			AL18 A 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		LOOKAROUND:
			//The shoddiest caricature of looking around you can ever conceive. No need for applause.
			TNT1 A 0 A_SetAngle(angle + 45)
			AL18 FF 4 A_Look
			TNT1 A 0 A_SetAngle(angle + 45)
			AL18 FF 8 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL18 FF 4 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			AL18 FF 4 A_Look
			AL18 FFFF 8 A_Look
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0) //Return to hostile to follow player.
			AL18 E 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		MISSILE:
			//Dougs is to be defined per-actor via inheritance. 
			//First the helper avoids targeting the player by looking for its resistance to helper damage.
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "CHECKPLAYERDISTANCE")
			//Then checks if the target is an ally and aborts.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			//And finally decides which weapon to use based on range. Weapon timings and damages need tweaking.
			TNT1 A 0 A_JumpIfCloser(256, "GOPRIMARY")
			TNT1 A 0 A_JumpIfCloser(512, "GOSECONDARY")
			GOTO GOPRIMARY
		
		GOPRIMARY:
			AL18 F 8 A_FaceTarget
			AL18 S 0 A_PlayWeaponSound("rott/pistolf")  
			AL18 G 3 Bright A_CustomMissile("RottPistolBullet", 36, 0, angle+random(-13,13)/10.0, 128, random(-13,13)/10.0)
			AL18 T 0 A_Jump(32,"See")
			AL18 T 0 A_CPOSRefire
			goto GOPRIMARY
		
		GOSECONDARY:
			TNT1 A 0		
			AL18 H 1 A_FaceTarget
			AL18 V 0 A_PlayWeaponSound("Bazooka/Shoot")  
			AL18 I 2 Bright A_CustomMissile("DrunkM",44,-8)
			AL18 I 0 Bright A_CustomMissile("DrunkM",44,-8)
			AL18 I 0 Bright A_CustomMissile("DrunkM",44,-8)
			AL18 I 0 Bright A_CustomMissile("DrunkM",44,-8)
			AL18 I 0 Bright A_CustomMissile("DrunkM",44,-8)
			AL18 H 24 A_FaceTarget
			AL18 H 1 A_FaceTarget
			AL18 H 1 A_FaceTarget
			TNT1 A 0 A_Jump(128, "See")
			goto Missile
			
		PAIN:
			AL18 A 3 A_Pain
			AL18 A 3 //A_SpawnItemEx("giblets",0, 0, 32, random(3.0,4.5),random(3.0,4.5),random(-20.0,3.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)						
			GOTO SEE
			
		Pain.Slime:
			TNT1 A 0 A_GiveInventory("SlimeToken", 1)
			AL18 A 6 A_Playsound("freely/cough", CHAN_VOICE)
			GOTO SEE

		DEATH:
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			AL18 J 5 A_Noblocking
			AL18 K 5 A_Scream
			AL18 L 5 A_ChangeFLag("SOLID", 0)
			AL18 MNO 5
			AL18 P -1
			Stop

		Death.RottExplosive:
        XDeath:
		   GUTS A 1 A_PlaySound("Rott/gibbed")
//		   TNT1 A 0 A_Jump(96, 2)
//		   TNT1 A 0 A_GiveToTarget("LudicrousGibs", 1)
		   GUTS AAAAAAAAAAAAAAAAAAAAAAA 0 A_custommissile("wallgib",32.0, 0, random(0,360), CMF_AIMDIRECTION, random(0,45))
		   GUTS DDDDDDDDDDDDDDDDDDDDDDD 0 A_SpawnItemex ("giblets",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibarm",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("Playerhead",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibhip",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("gibhum",0, 0, 32, random(3.0,5.0),random(3.0,5.0), random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibleg",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibribs",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS BCDEFGHIJK 5 A_Fall
		   GUTS L -1
		   Stop
		   
       Death.RottDisintegrate:
			TNT1 A 0 A_Scream
			TNT1 A 0 A_UnsetSolid
			TNT1 A 5 A_SpawnItem("RGodModeDeath")
			BLAN A -1
			stop
	   
	   Burn:
	   Death.RottFire:
			TNT1 A 0 A_Scream
			ske7 A 0 A_playsound("gen/burned") 
			ske7 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 bright
			skex ABCDEFGHIJKL 2 bright
			skex M 0 A_playsound("gen/skel") 
			skex MNOPQRSTUV 3 bright
			skex V -1 a_fall    
			Stop	
  

		TELEPORTCHECK:
			TNT1 A 1 A_JumpIfCloser(768, "FOLLOWPLAYER") //Change Dougs to define how far from the player it should teleport.
			GOTO TELEPORTING
	
		TELEPORTING:
			//For some reason if I try to replace Dougs via inheritance, it will execute the original and not the override.
			//Thus I got to do it the hard way, but at least it works!
			//I made the "ally tokens" in their inventory to be an indicator of their level, and thus it spawns the required spawner actor.
			//Dougs is also like in Brutal Doom, I tried other solutions but really required more monitoring or hackery, Dougs is the best compromise.
			//At Dougs point the actor will destroy itself and spawn a beacon. The beacon will follow around the player and try to spawn by
			//letting friendly damaging actors destroy them if in a suitable position.
			//Dougs also regenerates the actor's health, so there's no need to keep track and makes them feel much more durable, and they
			//will mostly die whenever you can see them die.
			//Having the tokens decide the level did the trick, as I can override SPAWN in every children class. I wonder why I couldn't override Dougs one?
			//I'll try doing it that way later in case it was some obscure bug.
			
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
			TNT1 A 0 A_ChangeFlag("NOBLOCKMAP", 1)
			TNT1 A 0 A_ChangeFlag("NOCLIP", 1)
			TNT1 A 0 A_ChangeFlag("SOLID", 0)
			TNT1 A 0 A_Noblocking	
			TNT1 A 1 A_SpawnItemEx("TelehaxDoug",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
			
	}
}

ACTOR TelehaxDoug {
	Radius 18
	Height 52
	Speed 32
	Health 1
	
	MaxTargetRange 192
	MinMissileChance 32
	DamageFactor "TelehaxSpawnCheck", 9999.0
	MaxDropOffHeight 16383 //There's no mountain tall enough...
	MaxStepHeight 16383 //And no abyss deep enough to contain the telehax's movement.
	
	MONSTER
	+NOTARGET
	+THRUACTORS
	+MISSILEMORE
	+MISSILEEVENMORE
	+NODAMAGETHRUST
	+FASTER
	+DONTSPLASH //You can remove Dougs if you want, but it's kinda weird and creepy depending on the map.
	+NOCLIP
	+NOBLOCKMONST
	+LOOKALLAROUND
	+NOINFIGHTING
	+NOTELEPORT //Ironic.
	-SHOOTABLE
	-FRIENDLY
	-COUNTKILL
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	
	STATES {
		SPAWN:
			TNT1 A 0 A_LookEx(0, 0, 0, 360)
		PAIN:
		SEE:
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			LOOP
		MISSILE:
			TNT1 A 0 A_SpawnItem("AllySpawnChecker")
			TNT1 A 5
			GOTO SEE
		DEATH:
		MISSILE:
			TNT1 A 0 A_NoBlocking
			TNT1 A 1 A_SpawnItemEx("DougWendt",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
	}
}

ACTOR IanPaulFreeley {
	Health 100
	ActiveSound "freely/yes"
	Deathsound "Ian/Death"
	PainSound "Ian/Pain"
	PainChance 32
	MinMissileChance 92
	XScale 0.68
	YScale 0.65
	Gravity 0.8125
	Speed 9
	Species "Player"
	BloodType "RottFreeleyBlood"	
	//Actor metrics.	
	Height 52
	Mass 100
	Radius 12
	Tag "Ian Paul Freeley"
	MeleeRange 70
	MaxStepHeight 57 //Ian is equal to the maximum distance a player can jump. Modify to allow no jumps and stuff.
	MaxDropOffHeight 16383
	MaxTargetRange 65536	
	//Actor flags.
	MONSTER	
	+FLOORCLIP
	+NOTELEPORT //We don't want them stepping into teleports. Let them teleport themselves when you are out of range.
	+QUICKTORETALIATE
	+NOBLOCKMONST
	+DONTHARMSPECIES
	+FIXMAPTHINGPOS
	+LOOKALLAROUND
	+PUSHABLE
	+SLIDESONWALLS
	+JUMPDOWN
	+NOTELESTOMP //Never telefrags. If it ever teleports into you, just punch it a few times.
	+THRUSPECIES
	+NOTAUTOAIMED
	+NOFEAR
	+NOINFIGHTING
	+MISSILEMORE
	+MISSILEEVENMORE
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	-DONTSPLASH
	-NORADIUSDMG
	-CANNOTPUSH
	-COUNTKILL	
	+MTHRUSPECIES	
	DamageFactor "Falling", 0.0 //We don't want our guy getting killed by the environment, so protect him from non-enemy hazards.
	DamageFactor "Crush", 0.0
	DamageFactor "Drowning", 0.0
	DamageFactor "Slime", 0.0
	DamageFactor "Massacre", 0.0 //And from "kill monsters" while we are at it. It was annoying me during debug and doesn't hurt. 
	DamageFactor "SWFlameCoop", 0.0	
	DamageFactor "CMDMGSHIT", 0.0	
	DamageFactor "SWStickyCoop", 0.0	
	DamageFactor "SWNukeCoop", 0.0		
	DamageFactor "SWRailgunCoop", 0.0
	DamageFactor "SWFlame2Coop", 0.0
	DamageFactor "PhosFireCoop", 0.0	
    DamageFactor "C7MineBoom", 0.0	
	DamageFactor "EradCoopExplosive2", 0.0
    DamageFactor "EradCoopGreenFire", 0.0	
	DamageFactor "IPOGGrenade", 0.0
	DamageFactor "IPOGTimeBomb", 0.0
	DamageFactor "IPOGProxyMine", 0.0		
	STATES {
		SPAWN:
			TNT1 A 0
			TNT1 A 0 ACS_NamedExecuteAlways("Samsara_AllyHealthRegen", 0, 0, 0, 0)
		IDLE:
		SPAWN2:
			TNT1 A 0
			TNT1 A 0 A_GiveInventory("AllyToken", 1)
			IPFS A 1 A_LookEx(0, 0, 0, 0, 360)
			GOTO SEE
		
		SEE:
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "FOLLOWPLAYER")
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			IPFW A 0 A_FaceTarget
			IPFW A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			IPFW A 1 A_Chase(0, 0)
			IPFW A 1 A_Chase(0, 0, CHF_NOPLAYACTIVE)
			IPFW A 1 A_Chase(0, 0)
			IPFW A 0 A_Recoil(-1)
			TNT1 A 0 A_FaceTarget
			IPFW AAAABBBBCCCCDDDD 1 A_Chase(0, "MISSILE")
			GOTO FOLLOWPLAYER
			
		IGNOREHELPERS: 
			//Look until you find something that is not a helper. If the other possible target is the player, go towards it.
			IPFS A 1 //Little delay to avoid infinite looping.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, 3)
			GOTO SEE
			TNT1 A 0 A_ClearTarget
			IPFS A 1 A_LookEx(0, 0, 0, 0, 360, "IGNOREHELPERS")
			GOTO FOLLOWPLAYER
			
		FOLLOWPLAYER:
			//Become unfriendly to chase the player directly. Lower their attack rate so they actually move towards it.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			//Ian's part was influenced by Brutal Doom's helper marines. Dash, check for proximity to player to stay still, otherwise check if it should teleport.
			//It...works. Much better than regular A_Chase.
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			IPFS A 0 A_FaceTarget
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, 2)
			TNT1 A 0 A_ClearTarget
			
			IPFW AAAA 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			IPFW BBBB 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")	
			
			IPFW CCCC 1 A_Chase(0,0, CHF_NOPLAYACTIVE)
			TNT1 A 0 A_Recoil(-1)
			TNT1 A 0 A_JumpIfCloser(192, "STAND")
			TNT1 A 0 A_CheckSight("TELEPORTCHECK")

			IPFW DDDD 1 A_Chase(0,0)
			TNT1 A 0 A_Recoil(-1)
			GOTO SEE

		CHECKPLAYERDISTANCE:
			TNT1 A 0 A_JumpIfCloser(192, "STAND") //How far the player needs to be to teleport to it.
			GOTO FOLLOWPLAYER
			
		STAND:
			//In Ian's state it'll be close to the player, therefore make it friendly again so it starts looking for monsters again.
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			TNT1 A 0 A_ClearTarget
			
			//If you want proximity effects Ian's is the place to go.
			TNT1 A 0 A_Jump(1, "LOOKAROUND")
			
			IPFS AA 1 A_LookEx(0, 0, 0, 0, 360, "SEE")
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			IPFS A 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		LOOKAROUND:
			//The shoddiest caricature of looking around you can ever conceive. No need for applause.
			TNT1 A 0 A_SetAngle(angle + 45)
			IPFS BB 4 A_Look
			TNT1 A 0 A_SetAngle(angle + 45)
			IPFS BB 8 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			IPFS BB 4 A_Look
			TNT1 A 0 A_SetAngle(angle - 45)
			IPFS BB 4 A_Look
			IPFS BBBB 8 A_Look
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0) //Return to hostile to follow player.
			IPFS B 1 A_LookEx(0, 0, 0, 0, 360, "FOLLOWPLAYER")
			GOTO SEE
			
		MISSILE:
			//Ian's is to be defined per-actor via inheritance. 
			//First the helper avoids targeting the player by looking for its resistance to helper damage.
			TNT1 A 0 A_JumpIfInTargetInventory("RottClass", 1, "CHECKPLAYERDISTANCE")
			//Then checks if the target is an ally and aborts.
			TNT1 A 0 A_JumpIfInTargetInventory("AllyToken", 1, "IGNOREHELPERS")
			//And finally decides which weapon to use based on range. Weapon timings and damages need tweaking.
			TNT1 A 0 A_JumpIfCloser(256, "GOPRIMARY")
			TNT1 A 0 A_JumpIfCloser(512, "GOSECONDARY")
			GOTO GOPRIMARY
		
		GOPRIMARY:
			IPFS B 8 A_FaceTarget
			IPFS C 0 A_PlayWeaponSound("rott/pistolf")  
			IPFS C 3 Bright A_CustomMissile("RottPistolBullet", 36, 0, angle+random(-13,13)/10.0, 128, random(-13,13)/10.0)
			IPFS C 0 A_Jump(32,"See")
			IPFS C 0 A_CPOSRefire
			goto GOPRIMARY
		
		GOSECONDARY:
			TNT1 A 0		
			IPMS D 1 A_FaceTarget
			IPMS E 0 A_PlayWeaponSound("Firebomb/Shoot")  
			IPMS E 2 Bright A_CustomMissile("FBomb",36)
			IPMS D 24 A_FaceTarget
			IPMS D 1 A_FaceTarget
			IPMS D 1 A_FaceTarget
			TNT1 A 0 A_Jump(128, "See")
			goto Missile
			
		PAIN:
			IPFS A 3 A_Pain
			IPFS A 3 //A_SpawnItemEx("giblets",0, 0, 32, random(3.0,4.5),random(3.0,4.5),random(-20.0,3.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
			GOTO SEE
		
		Pain.Slime:
			TNT1 A 0 A_GiveInventory("SlimeToken", 1)
			IPFS A 6 A_Playsound("rottf/cough", CHAN_VOICE)
			GOTO SEE

		DEATH:
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 1)
			IPFD A 5 A_Noblocking
			IPFD B 5 A_Scream
			IPFD C 5 A_ChangeFLag("SOLID", 0)
			IPFD DEF 5
			IPFD G -1
			Stop

		Death.RottExplosive:
        XDeath:
		   GUTS A 1 A_PlaySound("Rott/gibbed")
//		   TNT1 A 0 A_Jump(96, 2)
//		   TNT1 A 0 A_GiveToTarget("LudicrousGibs", 1)
		   GUTS AAAAAAAAAAAAAAAAAAAAAAA 0 A_custommissile("wallgib",32.0, 0, random(0,360), CMF_AIMDIRECTION, random(0,45))
		   GUTS DDDDDDDDDDDDDDDDDDDDDDD 0 A_SpawnItemex ("giblets",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibarm",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("Playerhead",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(3.0,5.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibhip",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS D 0 A_SpawnItemex ("gibhum",0, 0, 32, random(3.0,5.0),random(3.0,5.0), random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibleg",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("giblim",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DDDD 0 A_SpawnItemex ("gibpin",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS DD 0 A_SpawnItemex ("gibribs",0, 0, 32, random(3.0,5.0),random(3.0,5.0),random(0.0,10.0),random(0.0,360.0), SXF_ABSOLUTEANGLE , 0)
		   GUTS BCDEFGHIJK 5 A_Fall
		   GUTS L -1
		   Stop
		   
	   Death.RottDisintegrate:
			TNT1 A 0 A_Scream
			TNT1 A 0 A_UnsetSolid
			TNT1 A 5 A_SpawnItem("RGodModeDeath")
			BLAN A -1
			stop
	   
	   Burn:
	   Death.RottFire:
			TNT1 A 0 A_Scream
			ske7 A 0 A_playsound("gen/burned") 
			ske7 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 bright
			skex ABCDEFGHIJKL 2 bright
			skex M 0 A_playsound("gen/skel") 
			skex MNOPQRSTUV 3 bright
			skex V -1 a_fall    
			Stop	
  

		TELEPORTCHECK:
			TNT1 A 1 A_JumpIfCloser(768, "FOLLOWPLAYER") //Change Loreleis to define how far from the player it should teleport.
			GOTO TELEPORTING
	
		TELEPORTING:			
			TNT1 A 0 A_ChangeFLag("FRIENDLY", 0)
			TNT1 A 0 A_ChangeFlag("SHOOTABLE", 0)
			TNT1 A 0 A_ChangeFlag("NOBLOCKMAP", 1)
			TNT1 A 0 A_ChangeFlag("NOCLIP", 1)
			TNT1 A 0 A_ChangeFlag("SOLID", 0)
			TNT1 A 0 A_Noblocking	
			TNT1 A 1 A_SpawnItemEx("TelehaxIanPaulFreeley",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
			
	}
}

ACTOR TelehaxIanPaulFreeley {
	Radius 18
	Height 52
	Speed 32
	Health 1
	
	MaxTargetRange 192
	MinMissileChance 32
	DamageFactor "TelehaxSpawnCheck", 9999.0
	MaxDropOffHeight 16383 //There's no mountain tall enough...
	MaxStepHeight 16383 //And no abyss deep enough to contain the telehax's movement.
	
	MONSTER
	+NOTARGET
	+THRUACTORS
	+MISSILEMORE
	+MISSILEEVENMORE
	+NODAMAGETHRUST
	+FASTER
	+DONTSPLASH
	+NOCLIP
	+NOBLOCKMONST
	+LOOKALLAROUND
	+NOINFIGHTING
	+NOTELEPORT //Ironic.
	-SHOOTABLE
	-FRIENDLY
	-COUNTKILL
	-ACTIVATEMCROSS
	-ACTIVATEPCROSS
	
	STATES {
		SPAWN:
			TNT1 A 0 A_LookEx(0, 0, 0, 360)
		PAIN:
		SEE:
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			TNT1 A 1 A_Chase
			TNT1 A 0 A_Recoil(-2)
			LOOP
		MISSILE:
			TNT1 A 0 A_SpawnItem("AllySpawnChecker")
			TNT1 A 5
			GOTO SEE
		DEATH:
		MISSILE:
			TNT1 A 0 A_NoBlocking
			TNT1 A 1 A_SpawnItemEx("IanPaulFreeley",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERTRANSLATION,0)
			STOP
	}
}