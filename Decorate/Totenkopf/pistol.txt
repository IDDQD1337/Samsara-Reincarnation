actor Totenkopf_Pistol : InstantSwitchWeapon
{
    Weapon.SelectionOrder 900
    Weapon.SlotNumber 1
	Weapon.SlotPriority 0
    Inventory.PickUpSound "Totenkopf/getweapon"
    Obituary ""
    Inventory.PickupMessage "Walther P38 Pistol"
	Weapon.AmmoType "Clip"
    Weapon.AmmoUse 0
    Weapon.AmmoGive 8
	+WEAPON.Ammo_Optional
    +WEAPON.WIMPY_WEAPON
    +DONTBOB
    +INVENTORY.UNDROPPABLE
	+WEAPON.NOAUTOFIRE
    Weapon.YAdjust 16
    States
    {
      Spawn:
        TK02 M -1
        Loop

      Ready:
        TK02 A 1 A_WeaponReady
        loop

      Fire:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"CheckAmmo")
	  Fire2:
		TK02 C 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")	  
        TK02 B 3
        TK02 C 0 A_PlaySound("Totenkopf/atkpistol", CHAN_WEAPON)
		TK02 C 0 A_FireCustomMissile("Totenkopf_Tracer_Pistol",random(-2,2),1)
        TK02 C 3 Bright
		TK02 DE 3 
        Goto Ready
		
	CoopFire:
        TK02 B 3
        TK02 C 0 A_PlaySound("Totenkopf/atkpistol", CHAN_WEAPON)
		TK02 C 0 A_FireCustomMissile("Totenkopf_Tracer_PistolCoop",random(-2,2),1)
        TK02 C 3 Bright
		TK02 DE 3 
        Goto Ready		
		
	CheckAmmo:
		TNT1 A 0 A_JumpIfInventory("Clip", 1, 2)
		TNT1 A 0 A_SelectWeapon("Totenkopf_Knife")
		Goto Deselect
		TNT1 A 0 A_TakeInventory("Clip", 1)
		Goto Fire2
    }
}

actor Totenkopf_PistolDual : Totenkopf_Pistol
{
    Weapon.SelectionOrder 850
	Weapon.SlotPriority 1
	Weapon.AmmoGive 4
    States
    {
      Spawn:
        TK02 M -1
        Loop

      Ready:
        TK02 F 1 A_WeaponReady
        loop

      Fire:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"CheckAmmo")
	  Fire2:
		TK02 G 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")	
        TK02 G 3
        TK02 H 0 A_PlaySound("Totenkopf/atkpistol", CHAN_WEAPON)
		TK02 H 0 A_FireCustomMissile("Totenkopf_Tracer_Pistol",random(-3,3))
        TK02 H 3 Bright
		TK02 I 5
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"CheckAmmo2")
	  Fire3:	
		TK02 J 0 A_PlaySound("Totenkopf/atkpistol", CHAN_WEAPON)
		TK02 J 0 A_FireCustomMissile("Totenkopf_Tracer_Pistol",random(-3,3))
        TK02 J 3 Bright
		TK02 K 3
		TK02 K 0 A_Refire("Fire")
		TK02 L 3
        Goto Ready
	
	  CoopFire:
        TK02 G 3
        TK02 H 0 A_PlaySound("Totenkopf/atkpistol", CHAN_WEAPON)
		TK02 H 0 A_FireCustomMissile("Totenkopf_Tracer_PistolCoop",random(-3,3))
        TK02 H 3 Bright
		TK02 I 5
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"CheckAmmo2Coop")
	  CoopFire2:	
		TK02 J 0 A_PlaySound("Totenkopf/atkpistol", CHAN_WEAPON)
		TK02 J 0 A_FireCustomMissile("Totenkopf_Tracer_PistolCoop",random(-3,3))
        TK02 J 3 Bright
		TK02 K 3
		TK02 K 0 A_Refire("Fire")
		TK02 L 3
        Goto Ready	
		
	CheckAmmo:
		TNT1 A 0 A_JumpIfInventory("Clip", 1, 2)
		TNT1 A 0 A_SelectWeapon("Totenkopf_Knife")
		Goto Deselect
		TNT1 A 0 A_TakeInventory("Clip", 1)
		Goto Fire2	
		
	CheckAmmo2:
		TNT1 A 0 A_JumpIfInventory("Clip", 1, 2)
		TNT1 A 0 A_SelectWeapon("Totenkopf_Knife")
		Goto Deselect
		TNT1 A 0 A_TakeInventory("Clip", 1)
		Goto Fire3	
		
	CheckAmmo2Coop:
		TNT1 A 0 A_JumpIfInventory("Clip", 1, 2)
		TNT1 A 0 A_SelectWeapon("Totenkopf_Knife")
		Goto Deselect
		TNT1 A 0 A_TakeInventory("Clip", 1)
		Goto CoopFire2			
    }
}

Actor Totenkopf_Tracer_Pistol : Totenkopf_Tracer { Damage(10 + (random(0,256)%25)) }

Actor Totenkopf_Tracer_PistolCoop : Totenkopf_Tracer_Pistol { Species "Player" +THRUSPECIES }