actor freeman_uniqueselected : Boolean { Inventory.InterHubAmount 0 }
actor SamsaraHalfLifeLoadoutUnique1 : Boolean {}
actor HLGrenadeFuse : Counter { Inventory.MaxAmount 105 }

Actor "HL Squeaks" : HLWeapon
{
    Inventory.PickupMessage "You found some squeaks!"
    Weapon.SlotNumber 9
    Weapon.SelectionOrder 1600
    Weapon.AmmoType1 "HLSqueakAmmo"
    Weapon.AmmoGive1 5
    Weapon.AmmoUse1 1
    Weapon.AmmoType2 "RocketAmmo"
    Weapon.AmmoGive2 3
    Weapon.AmmoUse2 1
    Tag "Snarks"
    +EXPLOSIVE
    States
    {
      Spawn:
        HWU0 ABCDEFGHIJKLMNO 2 bright
        loop

      // Snarks
      // Gordon Freeman
      ReadyActual:
        HW32 A 0 A_JumpIfInventory("SamsaraHalfLifeLoadoutUnique1",1,"ReadyActualGrenades")
        HW32 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReadyActualAmmo")
        HW32 A 0 A_JumpIfInventory("HLSqueakAmmo",1,"ReadyActualAmmo")
        goto ReadyActualNoAmmo

      ReadyActualNoAmmo:
        TNT1 A 2 A_WeaponReady
        goto ReadyActualNoAmmoCheck

      ReadyActualAmmo:
        HW32 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyActualAmmoShephard")
        HW32 A 2 A_WeaponReady
        goto ReadyActualJump

      ReadyActualJump:
        HW32 A 0 A_JumpIfInventory("SamsaraHalfLifeLoadoutUnique1",1,"ReadyActualJumpGrenades")
        HW32 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReadyActualJumpStart")
        HW32 A 0 A_JumpIfInventory("HLSqueakAmmo",1,"ReadyActualJumpStart")
        goto ReadyActual

      ReadyActualJumpStart:
        HW32 A 0 A_Jump(4,"ReadyActual")
        HW32 A 0 A_Jump(3,"ReadyActual")
        HW32 A 0 A_Jump(2,"ReadyActual")
        HW32 A 0 A_JumpIfInventory("SamsaraHalfLifeLoadoutUnique1",1,"ReadyActualJumpStartGrenades")
        HW32 A 0 A_Jump(1,"ReadyActualIdle1","ReadyActualIdle2","ReadyActualIdle3")
        goto ReadyActual

      ReadyActualIdle1:
        HW32 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyActualIdle1Shephard")
        HW32 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW33 ABCDE 1 A_WeaponReady
        goto ReadyActual

      ReadyActualIdle2:
        HW32 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyActualIdle2Shephard")
        HW32 A 1 A_WeaponReady
        HW39 A 1 A_WeaponReady
        HW35 YZ 1 A_WeaponReady
        HW36 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW37 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW38 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        goto ReadyActual

      ReadyActualIdle3:
        HW32 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyActualIdle3Shephard")
        HW32 A 1 A_WeaponReady
        HW33 FGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW34 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW35 ABCDEFGHIJKLMNOPQRSTUVWX 1 A_WeaponReady
        goto ReadyActual

      ReadyActualNoAmmoCheck:
        TNT1 A 0 A_JumpIfInventory("SamsaraHalfLifeLoadoutUnique1",1,"ReadyActualNoAmmoCheckGrenades")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReloadStart")
        TNT1 A 0 A_JumpIfInventory("HLSqueakAmmo",1,"ReloadStart")
        goto ReadyActual

      Select:
        TNT1 A 0 A_TakeInventory("freeman_fistselected")
        TNT1 A 0 A_TakeInventory("freeman_pistolselected")
        TNT1 A 0 A_TakeInventory("freeman_slot1selected")
        TNT1 A 0 A_TakeInventory("freeman_slot2selected")
        TNT1 A 0 A_TakeInventory("freeman_slot3selected")
        TNT1 A 0 A_TakeInventory("freeman_slot4selected")
        TNT1 A 0 A_TakeInventory("freeman_slot5selected")
        TNT1 A 0 A_TakeInventory("freeman_slot6selected")
        TNT1 A 0 A_TakeInventory("freeman_slot7selected")
        TNT1 A 0 A_GiveInventory("freeman_uniqueselected")
        TNT1 A 0 A_TakeInventory("freeman_unique2selected")
        TNT1 A 0 A_TakeInventory("freeman_unique3selected")
        goto Super::Select

      Ready: // our "Select" state
        TNT1 A 0 A_JumpIfInventory("SamsaraHalfLifeLoadoutUnique1",1,"ReadyGrenades")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReadyAmmo")
        TNT1 A 0 A_JumpIfInventory("HLSqueakAmmo",1,"ReadyAmmo")
        goto ReadyNoAmmo

      ReadyNoAmmo:
        TNT1 AAAA 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAA 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        TNT1 AAAAAAAAAAAAAAAAAAAA 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        goto ReadyActual

      ReadyAmmo:
        HW39 W 0 A_PlaySound("halflife/squeak_select")
        HW39 W 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyAmmoShephard")
        HW39 WXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        HW40 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        HW41 ABCDEFGHIJKLMNOPQRST 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        goto ReadyActual

      Fire:
        HW41 A 0 A_JumpIfInventory("HLOriginalKeySwitcherOpen",1,"ReadyActual")
        HW41 A 0 A_JumpIfInventory("SamsaraHalfLifeLoadoutUnique1",1,"FireGrenades")
        HW41 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FireStart")
        HW41 A 0 A_JumpIfInventory("HLSqueakAmmo",1,"FireStart")
        goto FireDry

      FireDry:
        TNT1 A 0 A_ClearReFire
        TNT1 A 4 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      FireStart:
        HW41 U 0 A_GiveInventory("SamsaraHalfLifeSqueakAttackHandler")
        HW41 U 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"FireStartShephard")
        HW41 UVWXYZ 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        HW42 ABCDEFGHIJ 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      ReloadStart:
        HW39 W 0 A_JumpIfInventory("SamsaraHalfLifeLoadoutUnique1",1,"ReloadStartGrenades")
        HW39 W 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReloadStartShephard")
        HW39 WXYZ 1 A_WeaponReady
        HW40 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW41 ABCDEFGHIJKLMNOPQRST 1 A_WeaponReady
        goto ReadyActual

      // Adrian Shephard
      ReadyActualAmmoShephard:
        HW32 A 2 A_WeaponReady
        goto ReadyActualJump

      ReadyActualIdle1Shephard:
        HW32 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW33 ABCDE 1 A_WeaponReady
        goto ReadyActual

      ReadyActualIdle2Shephard:
        HW32 A 1 A_WeaponReady
        HW39 A 1 A_WeaponReady
        HW35 YZ 1 A_WeaponReady
        HW36 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW37 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW38 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        goto ReadyActual

      ReadyActualIdle3Shephard:
        HW32 A 1 A_WeaponReady
        HW33 FGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW34 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW35 ABCDEFGHIJKLMNOPQRSTUVWX 1 A_WeaponReady
        goto ReadyActual

      ReadyAmmoShephard:
        HW39 WXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        HW40 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        HW41 ABCDEFGHIJKLMNOPQRST 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        goto ReadyActual

      FireStartShephard:
        HW41 UVWXYZ 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        HW42 ABCDEFGHIJ 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      ReloadStartShephard:
        HW39 WXYZ 1 A_WeaponReady
        HW40 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        HW41 ABCDEFGHIJKLMNOPQRST 1 A_WeaponReady
        goto ReadyActual

      // Mk 2 Grenades
      // Gordon Freeman
      ReadyActualGrenades:
        OP00 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReadyActualAmmoGrenades")
        OP00 A 0 A_JumpIfInventory("RocketAmmo",1,"ReadyActualAmmoGrenades")
        goto ReadyActualNoAmmoGrenades

      ReadyActualNoAmmoGrenades:
        TNT1 A 2 A_WeaponReady
        goto ReadyActualNoAmmoCheck

      ReadyActualAmmoGrenades:
        OP00 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyActualAmmoGrenadesShephard")
        OP00 A 2 A_WeaponReady
        goto ReadyActualJump

      ReadyActualJumpGrenades:
        OP00 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReadyActualJumpStart")
        OP00 A 0 A_JumpIfInventory("RocketAmmo",1,"ReadyActualJumpStart")
        goto ReadyActual

      ReadyActualJumpStartGrenades:
        OP00 A 0 A_Jump(1,"ReadyActualIdle1Grenades","ReadyActualIdle2Grenades")
        goto ReadyActual

      ReadyActualIdle1Grenades:
        OP00 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyActualIdle1GrenadesShephard")
        OP00 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP01 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP02 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP03 ABCDEFGHIJKL 1 A_WeaponReady
        goto ReadyActual

      ReadyActualIdle2Grenades:
        OP00 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyActualIdle2GrenadesShephard")
        OP00 A 1 A_WeaponReady
        OP04 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP05 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP06 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP07 ABCDEFGHIJKL 1 A_WeaponReady
        goto ReadyActual

      ReadyActualNoAmmoCheckGrenades:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReloadStart")
        TNT1 A 0 A_JumpIfInventory("RocketAmmo",1,"ReloadStart")
        goto ReadyActual

      ReadyGrenades:
        OP13 B 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReadyAmmoGrenades")
        OP13 B 0 A_JumpIfInventory("RocketAmmo",1,"ReadyAmmoGrenades")
        goto ReadyNoAmmoGrenades

      ReadyNoAmmoGrenades:
        TNT1 AAAAAAAAAAAAA 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        goto ReadyActual

      ReadyAmmoGrenades:
        OP13 B 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReadyAmmoGrenadesShephard")
        OP13 BCEFGHIJKLMNO 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        goto ReadyActual

      FireGrenades:
        OP08 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FireStartGrenades")
        OP08 A 0 A_JumpIfInventory("RocketAmmo",1,"FireStartGrenades")
        goto FireDryGrenades

      FireDryGrenades:
        TNT1 A 0 A_ClearReFire
        TNT1 A 4 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      FireStartGrenades:
        OP08 A 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"FireStartGrenadesShephard")
        OP08 ABCDEFGHIJKLMNOPQRSTUVWX 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        OP08 X 0 A_TakeInventory("HLGrenadeFuse") // reset
        OP08 X 0 A_GiveInventory("HLGrenadeFuse",105)
      FireLoopGrenades:
        OP08 X 0 A_TakeInventory("HLGrenadeFuse",1)
        OP08 X 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        OP08 X 0 A_ReFire("FireLoopGrenades")
        OP09 A 0 A_GiveInventory("SamsaraHalfLifeGrenadeAttackHandler")
        OP09 A 0 A_Jump(256,"FireFinish1Grenades","FireFinish2Grenades","FireFinish3Grenades")
      FireFinish1Grenades:
        OP09 ABCDEFGHIJKLMNOPQR 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      FireFinish2Grenades:
        OP10 ABCDEFGHIJKLMNOPQR 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      FireFinish3Grenades:
        OP11 ABCDEFGHIJKLMNOPQR 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      ReloadStartGrenades:
        OP13 B 0 A_JumpIfInventory("HalfLifeOpposingForce",1,"ReloadStartGrenadesShephard")
        OP13 BCEFGHIJKLMNO 1 A_WeaponReady
        goto ReadyActual

      // Adrian Shephard
      ReadyActualAmmoGrenadesShephard:
        OP00 A 2 A_WeaponReady
        goto ReadyActualJump

      ReadyActualIdle1GrenadesShephard:
        OP00 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP01 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP02 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP03 ABCDEFGHIJKL 1 A_WeaponReady
        goto ReadyActual

      ReadyActualIdle2GrenadesShephard:
        OP00 A 1 A_WeaponReady
        OP04 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP05 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP06 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady
        OP07 ABCDEFGHIJKL 1 A_WeaponReady
        goto ReadyActual

      ReadyAmmoGrenadesShephard:
        OP13 BCEFGHIJKLMNO 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
        goto ReadyActual

      FireStartGrenadesShephard:
        OP08 ABCDEFGHIJKLMNOPQRSTUVWX 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        OP08 X 0 A_TakeInventory("HLGrenadeFuse") // reset
        OP08 X 0 A_GiveInventory("HLGrenadeFuse",105)
      FireLoopGrenadesShephard:
        OP08 X 0 A_TakeInventory("HLGrenadeFuse",1)
        OP08 X 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        OP08 X 0 A_ReFire("FireLoopGrenadesShephard")
        OP09 A 0 A_GiveInventory("SamsaraHalfLifeGrenadeAttackHandler")
        OP09 A 0 A_Jump(256,"FireFinish1GrenadesShephard","FireFinish2GrenadesShephard","FireFinish3GrenadesShephard")
      FireFinish1GrenadesShephard:
        OP09 ABCDEFGHIJKLMNOPQR 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      FireFinish2GrenadesShephard:
        OP10 ABCDEFGHIJKLMNOPQR 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      FireFinish3GrenadesShephard:
        OP11 ABCDEFGHIJKLMNOPQR 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto ReadyActualNoAmmoCheck

      ReloadStartGrenadesShephard:
        OP13 BCEFGHIJKLMNO 1 A_WeaponReady
        goto ReadyActual
    }
}

// Snarks

actor SamsaraHalfLifeSqueakAttackHandler : Trigger
{
    States
    {
      // Ammo checking/taking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttack")
        TNT1 A 0 A_JumpIfInventory("HLSqueakAmmo",1,1)
        stop
        TNT1 A 0 A_TakeInventory("HLSqueakAmmo",1)
        goto PickupAttack

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCoop")
      PickupAttackDM:
        TNT1 A 0 A_SpawnItemEx("HLSqueak",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)
        TNT1 A 0 A_JumpIfInventory("SamsaraHasSpread",1,1)
        stop
        TNT1 A 0 A_SpawnItemEx("HLSqueak",0,0,0,0,0,0,-15,SXF_NOCHECKPOSITION)
        TNT1 A 0 A_SpawnItemEx("HLSqueak",0,0,0,0,0,0,15,SXF_NOCHECKPOSITION)
        stop

      PickupAttackCoop:
        TNT1 A 0 A_SpawnItemEx("HLSqueakCoop",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)
        TNT1 A 0 A_JumpIfInventory("SamsaraHasSpread",1,1)
        stop
        TNT1 A 0 A_SpawnItemEx("HLSqueakCoop",0,0,0,0,0,0,-15,SXF_NOCHECKPOSITION)
        TNT1 A 0 A_SpawnItemEx("HLSqueakCoop",0,0,0,0,0,0,15,SXF_NOCHECKPOSITION)
        stop
    }
}

actor HLSqueakAmmo : Ammo
{
    Inventory.MaxAmount 5
    Tag "Snarks"
    +IGNORESKILL
}

Actor HLSqueakSpawned : Boolean {}
Actor HLSqueakHitWall : Boolean {}
Actor HLSqueakIsEvil : Boolean {}

Actor HLSqueak
{
    MONSTER
    -SOLID
    -TELESTOMP
    -TELEPORT
    -COUNTKILL
    +FRIENDLY
    +FLOORCLIP
    +THRUSPECIES
    +DROPOFF
    +LOOKALLAROUND
    +NEVERFAST
    Species "Squeak"
    ReactionTime 500
    Gravity 0.8
    Health 13
    Radius 9
    Height 15
    Mass 50
    Speed 7
    Tag "Snark"
    SeeSound "halflife/squeak_active"
    ActiveSound "halflife/squeak_active"
    Obituary "%o was killed by a Snark."
    BloodColor "99 FF 33"
    states
    {
    Spawn:
        HL03 A 0
        HL03 A 0 A_JumpIfInventory("HLSqueakSpawned",1,"SpawnDeploy")
        HL03 A 0 A_GiveInventory("HLSqueakSpawned")
        HL03 A 0 A_PlaySound("halflife/squeak_deploy",CHAN_VOICE)
        HL03 ABCDEFGH 2 A_Recoil(-1)
        goto SpawnDeploy
    SpawnDeploy:
        HL00 A 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
        HL00 A 0 A_JumpIf(CallACS("SamsaraReactionTimeChecker") <= 1, "ForceDeath")
        HL00 A 0 A_Countdown
        HL00 ABCD 1 A_Recoil(-1)
        HL00 E 0 A_CustomMissile("HLSqueakCheckHitObject",3,0,0,CMF_AIMDIRECTION,0)
        HL00 EFGH 1 A_Recoil(-1)
        HL00 I 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
        HL00 I 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
        HL00 IJKL 1 A_Recoil(-1)
        HL00 M 0 A_CustomMissile("HLSqueakCheckHitObject",3,0,0,CMF_AIMDIRECTION,0)
        HL00 MNOP 1 A_Recoil(-1)
        HL00 A 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
        loop
    SpawnFlip:
        HL00 A 0 A_SetAngle(angle+180)
        //HL00 A 0 A_ChangeFlag("FRIENDLY",0)
        //HL00 A 0 A_GiveInventory("HLSqueakIsEvil")
        HL00 A 0 A_TakeInventory("HLSqueakHitWall")
        goto SpawnDeploy
    See:
        HL02 ABCDEFGH 1 A_Chase
        HL02 A 0 A_ChangeFlag("FRIENDLY",0)
        HL02 A 0 A_GiveInventory("HLSqueakIsEvil")
        HL02 A 0 A_JumpIf(CallACS("SamsaraReactionTimeChecker") <= 1, "ForceDeath")
        HL02 A 0 A_Countdown
        loop
    Melee:
        HL00 A 0 A_JumpIfInventory("HLSqueakIsEvil",1,2)
        HL00 A 0 A_ChangeFlag("FRIENDLY",1) //Keep seeking targets if enemy successfully attacked
        HL00 A 0 A_FaceTarget
        HL00 A 0 A_CustomMeleeAttack(30,"halflife/squeak_attack","halflife/squeak_attack","HLSqueak",1)
        HL00 A 0 A_Stop
        HL00 ABCD 1 ThrustThingZ(0,7,0,1)
        HL00 EFGHIJKLM 1 A_Recoil(random(10.0,15.0)/10.0)
        HL00 A 0 A_JumpIf(CallACS("SamsaraReactionTimeChecker") <= 1, "ForceDeath")
        HL00 A 0 A_Countdown
        goto See
    ForceDeath:
        HL00 A 0 A_PlaySound("halflife/squeak_die",CHAN_VOICE)
        HL00 A 1 A_Countdown
        wait
    Death:
        TNT1 A 5 A_SpawnItemEx("HLSqueakSplat",0,0,0,0,0,0,0,SXF_CLIENTSIDE)
        stop
    }
}

Actor HLSqueakCoop : HLSqueak
{
    Species "Player"
    +DONTHARMCLASS
    +DONTHARMSPECIES
    +MTHRUSPECIES
    ReactionTime 2450
    Speed 14
    Health 1550
    states
    {
    Spawn:
        HL03 A 0
        HL03 A 0 A_JumpIfInventory("HLSqueakSpawned",1,"SpawnDeploy")
        HL03 A 0 A_GiveInventory("HLSqueakSpawned")
        HL03 A 0 A_PlaySound("halflife/squeak_deploy",CHAN_VOICE)
        HL03 ABCDEFGH 2 A_Recoil(-1)
        goto SpawnDeploy
    SpawnDeploy:
        HL00 A 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
        HL00 A 0 A_JumpIf(CallACS("SamsaraReactionTimeChecker") <= 1, "ForceDeath")
        HL00 A 0 A_Countdown
        HL00 ABCD 1 A_Recoil(-1)
        HL00 E 0 A_CustomMissile("HLSqueakCheckHitObjectCoop",3,0,0,CMF_AIMDIRECTION,0)
        HL00 EFGH 1 A_Recoil(-1)
        HL00 I 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
        HL00 I 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
        HL00 IJKL 1 A_Recoil(-1)
        HL00 M 0 A_CustomMissile("HLSqueakCheckHitObjectCoop",3,0,0,CMF_AIMDIRECTION,0)
        HL00 MNOP 1 A_Recoil(-1)
        HL00 A 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
        loop
    SpawnFlip:
        HL00 A 0 A_SetAngle(angle+180)
        HL00 A 0 A_TakeInventory("HLSqueakHitWall")
        goto SpawnDeploy
    See:
        HL02 ABCDEFGH 1 A_Chase
        HL02 A 0 A_JumpIf(CallACS("SamsaraReactionTimeChecker") <= 1, "ForceDeath")
        HL02 A 0 A_Countdown
        loop
    Melee:
        HL00 A 0 A_FaceTarget
        HL00 A 0 A_CustomMeleeAttack(30,"halflife/squeak_attack","halflife/squeak_attack","HLSqueak",1)
        HL00 A 0 A_Stop
        HL00 ABCD 1 ThrustThingZ(0,7,0,1)
        HL00 EFGHIJKLM 1 A_Recoil(random(10.0,15.0)/10.0)
        HL00 A 0 A_JumpIf(CallACS("SamsaraReactionTimeChecker") <= 1, "ForceDeath")
        HL00 A 0 A_Countdown
        goto See
    ForceDeath:
        HL00 A 0 A_PlaySound("halflife/squeak_die",CHAN_VOICE)
        HL00 A 1 A_Countdown
        wait
    Death:
        TNT1 A 0 A_Explode(15,15)
        TNT1 A 5 A_SpawnItemEx("HLSqueakSplat",0,0,0,0,0,0,0,SXF_CLIENTSIDE)
        stop
    }
}

Actor HLSqueakSplat
{
    +CLIENTSIDEONLY
    +NOINTERACTION
    -SOLID
    +NOBLOCKMAP
    +NOTIMEFREEZE
    scale 0.75
    states
    {
    Spawn:
        HGB9 A 0
        HGB9 A 0 A_PlaySound("halflife/squeak_boom",CHAN_VOICE)
        HGB9 A 1 A_ChangeFlag("NOTIMEFREEZE",false)
        HGB9 BCDEFGHIJ 1
        stop
    }
}

Actor HLSqueakCheckHitObject : BulletPuff
{
    Radius 4
    height 6
    Speed 30
    PROJECTILE
    +PUFFGETSOWNER
    +PUFFONACTORS
    +BLOODLESSIMPACT
    +NOBLOODDECALS
    +THRUSPECIES
    species "Squeak"
    States
    {
    Spawn:
        TNT1 A 1
        stop
    Death:
        TNT1 A 3 A_GiveToTarget("HLSqueakHitWall", 1)
        Stop
    }
}

Actor HLSqueakCheckHitObjectCoop : HLSqueakCheckHitObject
{
    species "Player"
    +THRUSPECIES
    +DONTHARMCLASS
    +DONTHARMSPECIES
    +MTHRUSPECIES
}

// Mk 2 Grenades

actor SamsaraHalfLifeGrenadeAttackHandler : Trigger
{
    States
    {
      // Ammo checking/taking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttack")
        TNT1 A 0 A_JumpIfInventory("RocketAmmo",1,1)
        stop
        TNT1 A 0 A_TakeInventory("RocketAmmo",1)
        goto PickupAttack

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCoop")
      PickupAttackDM:
        TNT1 A 0 A_FireCustomMissile("HLShephardGrenade",0,false,4)
        stop

      PickupAttackCoop:
        TNT1 A 0 A_FireCustomMissile("HLShephardGrenadeCoop",0,false,4)
        stop
    }
}

Actor HLShephardGrenade {
    Radius 8
    Height 8
    Speed 8
    PROJECTILE
    -NOGRAVITY
    +BOUNCEONWALLS
    +BOUNCEONFLOORS
    +BOUNCEONCEILINGS
    +BOUNCEONACTORS
    +ALLOWBOUNCEONACTORS
    Scale 0.75
    BounceCount 3
    BounceSound "HECU/Grenade/Bounce"
    WallBounceSound "HECU/Grenade/Bounce"    
    Damage (0)
    DamageType "HLExplosive"
    Gravity 0.234    
    States {
    Spawn:
        TNT1 A 0
        TNT1 A 0 ACS_NamedExecuteAlways("HalfLifeGrenadeFuse")
        TNT1 A 0 ThrustThingZ(0,15,0,1)
        TNT1 A 0 A_Jump(128,"SpawnLoop2")
    SpawnLoop1:    
          HL23 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 A_JumpIf(momx == 0 && momy == 0 && momz == 0, "OnFloor")
          HL24 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 A_JumpIf(momx == 0 && momy == 0 && momz == 0, "OnFloor")
          HL25 ABCDEFGHI 2 A_JumpIf(momx == 0 && momy == 0 && momz == 0, "OnFloor")
        Loop
    SpawnLoop2:    
          HL26 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 A_JumpIf(momx == 0 && momy == 0 && momz == 0, "OnFloor")
          HL27 ABCDEFGHIJKLMNOPQRSTUVWXYZ 2 A_JumpIf(momx == 0 && momy == 0 && momz == 0, "OnFloor")
          HL28 ABCDEFGHI 2 A_JumpIf(momx == 0 && momy == 0 && momz == 0, "OnFloor")
        Loop    
    OnFloor:
        TNT1 A 0 A_CheckFloor(1)
        Goto Death+1
        HL29 A 1
        Loop
    Death:
    XDeath:
        TNT1 A 0 A_JumpIfInventory("HLGrenadeFuse",1,"OnFloor")
        TNT1 A 0 A_PlaySound("halflife/mp5_grenadehit",CHAN_BODY)
        TNT1 A 0 A_AlertMonsters
        TNT1 A 0 A_Explode(300,124,0)
        TNT1 A 5 A_SpawnItemEx("HLExplosionBoom",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)
        Stop
    }
}

Actor HLShephardGrenadeCoop : HLShephardGrenade
{
    Species "Player"
    +THRUSPECIES
    +DONTHURTSPECIES
    +DONTHARMSPECIES
    +MTHRUSPECIES
}
