actor LifeLeech : CalebWeapon
{
	inventory.pickupmessage "You found the Life Leech!"
	Inventory.PickupSound "Caleb/Weaponup"
	Obituary "%k sucked %o's soul dry."
	weapon.selectionorder 400
	weapon.ammotype1 "Cell"
	weapon.ammotype2 "Cell"
	weapon.ammouse1 0
	weapon.ammouse2 30
	weapon.ammogive 40
	Weapon.SlotNumber 7
	Weapon.SlotPriority 0
	+WEAPON.BFG
	+WEAPON.NOALERT
	Tag "Life Leech"
	states
	{
	Spawn:
		LLS_ B -1
		Stop
	Ready:
		TNT1 A 0 A_TakeInventory("UsingPitchfork", 1)
		TNT1 A 0 A_JumpIfInventory("CalebReady",1,"IntroTaunt")
		TNT1 A 0 A_JumpIfInventory("CalebWaiting",60,"WaitingTaunt")
		LLST A 1 A_WeaponReady
		Goto Ready+1
	Select:
		TNT1 A 0 A_JumpIfInventory("CalebLighterReadyDummy",1,"DeselectLighter")
		LLST A 0 A_TakeInventory("StopFromPickingTurrets_",999)
		Goto Super::SelectLoop
	Deselect:
		LLST A 0
		Goto Super::DeselectLoop
	Fire:
		TNT1 A 0 A_AlertMonsters
		LLSL ABCDE 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_PlaySound("LifeLeech/Fire",CHAN_WEAPON)
		LLST B 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST E 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST M 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST F 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST C 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST C 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST G 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST G 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST H 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST I 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST K 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST J 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST D 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST G 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST K 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST L 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST M 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST N 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST P 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST O 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST P 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST G 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST Q 3 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST R 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner3", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST Q 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST S 3 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST T 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner3", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST D 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST U 3 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST W 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner3", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST D 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST X 3 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST Y 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner3", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST Q 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLST Z 3 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLS2 C 2 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST G 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLS2 G 3 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST L 0 ACS_NamedExecuteAlways("CalebLifeLeech", 0)
		LLST M 0 A_SpawnItemEx("LifeLeechLightSpawner2", 0, 0, 0)
		TNT1 A 0 A_GunFlash
		LLST G 0 A_GiveInventory("SamsaraBloodLifeLeechAttackHandler")
		LLSA AB 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST B 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLSL EDCBA 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		LLST A 0 A_Refire
		Goto Ready
	 AltFire:
		TNT1 A 2 A_FireCustomMissile("LifeLeechSentrySpawner")
		TNT1 A 0 A_GiveInventory("StopFromPickingTurrets_",1)
		TNT1 A 0 A_TakeInventory("LifeLeech", 1)
		Goto Ready
	 Flash:
		TNT1 A 2 A_Light2
		TNT1 A 2 A_Light1
		TNT1 A 2 A_Light0
		Stop
	}
}

Actor SamsaraBloodLifeLeechAttackHandler : Trigger
{
	States
	{
		Pickup:
			TNT1 A 0
			TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "PickupAttackCoop")
			TNT1 A 0 A_FireCustomMissile("LifeLeechShot", random(-80,80)/10.0, false, 5, 3, 0, random(-40,40)/10.0)
			Stop
		PickupAttackCoop:
			TNT1 A 0 A_FireCustomMissile("LifeLeechShotCoop", random(-80,80)/10.0, false, 5, 3, 0, random(-40,40)/10.0)
			Stop
	}
}

Actor StopFromPickingTurrets_ : Boolean {}
Actor LifeLeechMarkedForDeath : Boolean {}

Actor LifeLeechSentrySpawner
{
	Radius 16
	Height 32
	Speed 18
	Scale 0.8
	Damage (0)
	PROJECTILE
	-NOGRAVITY
	States
	{
	Spawn:
		LLSP A -1
		Loop
	Death:
		TNT1 A 1 A_SpawnItemEx("LifeLeechTurret",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_TRANSFERPOINTERS)
		Stop
	}
}

actor LifeLeechShot
{
	PROJECTILE
	+BRIGHT
	Damage (Random(7,14))
	Obituary "%o had %p soul sucked dry by %k."
	DamageType "LifeLeech"
	DeathSound "LifeLeech/Explode"
	Height 8
	Radius 8
	SeeSound ""
	alpha 0.5
	scale 0.6
	speed 36
	Decal none
	+FOILINVUL
	+PIERCEARMOR
	+FORCERADIUSDMG
	+HITTRACER
	States
	{
	Spawn:
		LLSS A 4 A_SpawnItemEx("LifeLeechTrail",0,0,0,random(-40,40)/10.0,random(-40,40)/10.0,random(-40,40)/10.0,random(1,360))
		Loop
	Death:
		TNT1 A 0 ACS_NamedExecuteWithResult("CalebBurner")
		TNT1 A 0 A_RadiusGive("BloodBurnVFXTrigger",112,RGF_MONSTERS|RGF_PLAYERS)
		LLSX ABCDEFGHIJK 2 A_Explode(15, 112, 0)
		Stop
	}
}

Actor LifeLeechShotCoop : LifeLeechShot
{
	Species "Player"
	+THRUSPECIES
	// Damage (96)
	States
	{
	Spawn:
		LLSS A 4 A_SpawnItemEx("LifeLeechTrailCoop",0,0,0,random(-40,40)/10.0,random(-40,40)/10.0,random(-40,40)/10.0,random(1,360))
		Loop
	}
}

Actor LifeLeechTrail
{
	Projectile
	Damage (3)
	DamageType "LifeLeech"
	Obituary "%o had %p soul sucked dry by %k."
	+BRIGHT
	+RIPPER
	+BLOODLESSIMPACT
	+FOILINVUL
	+PIERCEARMOR
	Speed 0
	Radius 12
	Height 12
	Scale 0.15
	Alpha 0.9
	States
	{
	Spawn:
		ESST ABCDEFGHI 1 A_FadeOut
		Wait
	}
}

Actor LifeLeechTrailCoop : LifeLeechTrail { Species "Player" +THRUSPECIES +DONTHARMCLASS +DONTHARMSPECIES Damage (5) }

actor LifeLeechLightSpawner2
{
	Radius 8
	Height 8
	+CLIENTSIDEONLY
	Scale 0.5
	States
	{
	Spawn:
		TNT1 A 5
		Stop
	}
}

actor LifeLeechLightSpawner3
{
	Radius 8
	Height 8
	Scale 0.5
	+CLIENTSIDEONLY
	States
	{
	Spawn:
		TNT1 A 5
		Stop
	}
}

Actor LifeLeechTurret : SwitchableDecoration
{
	Radius 9
	Height 56
	Health 250
	Mass 96
	Speed 0
	Scale 0.8
	MONSTER
	MaxTargetRange 3192
	Activation  THINGSPEC_ThingActs|THINGSPEC_Switch
	Tag "Life Leech Sentry"
	Species "Player"
	+USESPECIAL
	+DONTREFLECT
	+NOICEDEATH
	+NOTARGET
	+NOINFIGHTING
	+NEVERRESPAWN
	+NOBLOOD
	+LOOKALLAROUND
	+DONTBLAST
	+INVULNERABLE
	+DONTMORPH
	+SHOOTABLE
	-FRIENDLY
	-TELESTOMP
	-SOLID
	-COUNTKILL
	States
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 A_ReArrangePointers(AAPTR_Null, AAPTR_Target)
		TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraDecorate",41)
		TNT1 A 0 A_JumpIf(1 == ACS_NamedExecuteWithResult("CalebDeathmatchCheck", 0), "SpawnKillable")
		TNT1 A 0 A_JumpIf(1 == ACS_NamedExecuteWithResult("CalebCoopCheck", 0), "SpawnThru")
		Goto SpawnLoop
	SpawnLoop:
		TNT1 A 0 A_ChangeFlag("NOTARGET", 0)
		LLSP A 0 ACS_NamedExecuteWithResult("CalebLifeLeechTurretMarkForDeath")
		LLSP A 10 A_Look
		LLSP A 0 ACS_NamedExecuteWithResult("CalebLifeLeechTurretMarkForDeath")
		LLSP A 10 A_Look
		LLSP A 0 ACS_NamedExecuteWithResult("CalebLifeLeechTurretMarkForDeath")
		LLSP A 10 A_Look
		LLSP A 0 ACS_NamedExecuteWithResult("CalebLifeLeechTurretMarkForDeath")
		LLSP A 10 A_Look
		LLSP A 0 ACS_NamedExecuteWithResult("CalebLifeLeechTurretMarkForDeath")
		LLSP A 10 A_Look
		Loop
	SpawnThru:
		TNT1 A 0 A_ChangeFlag("MTHRUSPECIES", 1)
		Goto SpawnLoop
	SpawnKillable:
		TNT1 A 0 A_ChangeFlag("INVULNERABLE", 0)
		Goto SpawnLoop
	Inactive:
	Active:
		LLSP A 0 ACS_NamedExecuteWithResult("CalebRetrieveLifeLeech")
		Goto SpawnLoop
	See:
		LLSP A 0 ACS_NamedExecuteWithResult("CalebLifeLeechTurretMarkForDeath")
		LLSP A 15 A_JumpIfTargetInLOS("Missile")
		LLSP A 5 A_ClearTarget
		Goto SpawnLoop
	Missile:
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_FaceTarget
		TNT1 A 0 A_JumpIf(1 == ACS_NamedExecuteWithResult("CalebDeathmatchCheck", 0), "MissileDM")
		TNT1 A 0 A_JumpIf(1 == ACS_NamedExecuteWithResult("CalebCoopCheck", 0), "MissileCoop")
		TNT1 A 0 A_CustomMissile("LifeLeechSentryShot", 48, 8)
		TNT1 A 0 A_CustomMissile("LifeLeechSentryShot", 48, -8)
		Goto MissileEnd
	MissileCoop:
		TNT1 A 0 A_CustomMissile("LifeLeechSentryShotCoop", 48, 8)
		TNT1 A 0 A_CustomMissile("LifeLeechSentryShotCoop", 48, -8)
		Goto MissileEnd
	MissileDM:
		TNT1 A 0 A_CustomMissile("LifeLeechSentryShotDM", 48, 8)
		TNT1 A 0 A_CustomMissile("LifeLeechSentryShotDM", 48, -8)
		Goto MissileEnd
	MissileEnd:
		LLSP A 9 A_ClearTarget
		Goto SpawnLoop
	Death:
		TNT1 A 0 A_TakeInventory("GotWeapon7", 999, 0, AAPTR_Master)
		TNT1 A 0 A_TakeInventory("StopFromPickingTurrets_", 999, 0, AAPTR_Master)
		TNT1 AAAAAAAAAAAAAAA 0 A_CustomMissile("LifeLeechSentryFX", 24, 0, random(0,360), 2, random(-90,90))
		TNT1 A 1 A_PlaySound("LifeLeech/AltBlast")
		Stop
	}
}

actor LifeLeechSentryLight
{
	Radius 8
	Height 8
	Scale 0.5
	+NOGRAVITY
	+CLIENTSIDEONLY
	+NOINTERACTION
	States
	{
	Spawn:
		TNT1 A 5
		Stop
	}
}

actor LifeLeechSentryShot
{
	radius 6
	height 8
	speed 56
	SCALE 0.25
	damage (20+Random(0,19))
	DamageType "Vodoo"
	seesound "LifeLeech/AltSpawn"
	deathsound "LifeLeech/AltBlast"
	PROJECTILE
	+BRIGHT
	+FORCERADIUSDMG
	+FOILINVUL
	states
	{
	Spawn:
		EYEB ABCD 1
		Loop
	Death:
		TNT1 AAAAAAAAAAAAAAAAAA 0 A_CustomMissile("LifeLeechSentryFX", 0, 0, random(0,360), 2, random(-90,90))
		TNT1 A 1 A_SpawnItemEx("LifeLeechSentryLight")
		stop
	}
}

actor LifeLeechSentryShotCoop : LifeLeechSentryShot { Species "Player" +THRUSPECIES	}

actor LifeLeechSentryShotDM : LifeLeechSentryShot { Damage (10+Random(0,9))	}