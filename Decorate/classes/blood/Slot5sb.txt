Actor RemoteTNTSeamlessToken : TemporaryCounter { Inventory.MaxAmount 5 }
Actor RemoteTNTNoDynamite : TemporaryBoolean {}
Actor RemoteTNTDetonate : TemporaryBoolean {}
Actor BloodRemoteTNT : CalebWeapon
{
	Inventory.PickupMessage "Picked up Remote Detonator"
	Weapon.SelectionOrder 880
	Weapon.AmmoGive 5
	Weapon.AmmoType "RocketAmmo"
	Weapon.AmmoType2 "RocketAmmo"
	Obituary "%o got a faceful of %k's TNT!"
	Weapon.AmmoUse 1
	Weapon.AmmoUse2 1
	Weapon.SlotNumber 5
	Weapon.SlotPriority 2
	Inventory.PickupSound "Caleb/Weaponup"
	+WEAPON.EXPLOSIVE
	+WEAPON.NOALERT
	+WEAPON.NOAUTOAIM
	Tag "Remote Detonator"
	States
	{
	Ready:
		TNT1 A 0 A_TakeInventory("CalebInterpolateBar")
		TNT1 A 0 A_TakeInventory("ThrowPowerBig")
		TNT1 A 0 A_TakeInventory("ThrowPower")
		TNT1 A 0 A_TakeInventory("UsingPitchfork", 1)
		Goto ReadyLoop+6
	RaisingDynamite:
		BRMT FGHDE 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	ReadyLoop:
		TNT1 A 0 A_TakeInventory("RemoteTNTNoDynamite")
		TNT1 A 0 A_TakeInventory("RemoteTNTSeamlessToken")
		TNT1 A 0 A_TakeInventory("ThrowPowerBig")
		TNT1 A 0 A_TakeInventory("CalebInterpolateBar")
		TNT1 A 0 A_TakeInventory("ThrowPower")
		TNT1 A 0 A_JumpIfNoAmmo("ReadyAmmoless")
		TNT1 A 0 A_JumpIfInventory("CalebReady",1,"IntroTaunt")
		TNT1 A 0 A_JumpIfInventory("CalebWaiting",60,"WaitingTaunt")
		BRMT M 4 A_WeaponReady
		TNT1 A 0 A_GiveInventory("RemoteTNTSeamlessToken")
		BRMT N 4 A_WeaponReady
		TNT1 A 0 A_GiveInventory("RemoteTNTSeamlessToken")
		BRMT O 4 A_WeaponReady
		TNT1 A 0 A_GiveInventory("RemoteTNTSeamlessToken")
		BRMT P 4 A_WeaponReady
		TNT1 A 0 A_GiveInventory("RemoteTNTSeamlessToken")
		BRMT Q 4 A_WeaponReady
		TNT1 A 0 A_GiveInventory("RemoteTNTSeamlessToken")
		BRMT R 4 A_WeaponReady
		Loop
	ReadyAmmoless:
		TNT1 A 0 A_GiveInventory("RemoteTNTNoDynamite")
		TNT1 A 0 A_JumpIfInventory("CalebReady",1,"IntroTaunt")
		TNT1 A 0 A_JumpIfInventory("CalebWaiting",60,"WaitingTaunt")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",5,"ReadyAmmoless6")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",4,"ReadyAmmoless5")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",3,"ReadyAmmoless4")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",2,"ReadyAmmoless3")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",1,"ReadyAmmoless2")
	ReadyAmmoless1:
		BRMT S 4 A_WeaponReady
		Goto ReadyAmmoless
	ReadyAmmoless2:
		BRMT T 4 A_WeaponReady
		Goto ReadyAmmoless
	ReadyAmmoless3:
		BRMT U 4 A_WeaponReady
		Goto ReadyAmmoless
	ReadyAmmoless4:
		BRMT V 4 A_WeaponReady
		Goto ReadyAmmoless
	ReadyAmmoless5:
		BRMT W 4 A_WeaponReady
		Goto ReadyAmmoless
	ReadyAmmoless6:
		BRMT X 4 A_WeaponReady
		Goto ReadyAmmoless
	Deselect:
		TNT1 A 0 A_TakeInventory("RemoteTNTDetonate")
		TNT1 A 0 A_TakeInventory("RemoteTNTSeamlessToken")
		TNT1 A 0 A_TakeInventory("CalebInterpolateBar")
		TNT1 A 0 A_TakeInventory("ThrowPower")
		TNT1 A 0 A_TakeInventory("ThrowPowerBig")
		BRMT EEE 1 A_Lower
		BRMT "YYZZ[[]]" 1 A_Lower
		BRMT "]" 0
		Goto Super::DeselectLoop
	Select:
		TNT1 A 0 A_JumpIfInventory("CalebLighterReadyDummy",1,"DeselectLighter")
		TNT1 A 0 A_GiveInventory("CalebUsingTNT",1)
		TNT1 A 0 A_TakeInventory("ThrowPower")
		TNT1 A 0 A_TakeInventory("ThrowPowerBig")
		TNT1 A 0 A_TakeInventory("UsingPitchfork", 1)
		//TNT1 A 0 A_JumpIfNoAmmo("ReadyAmmoless")
		BRMT AAABBBCCCDDDEEE 1 A_Raise
		BRMT E 0
		Goto Super::SelectLoop
	SwitchExplosive:
		TNT1 AAAAAAAAAAAAAAAAAAAA 0 A_Raise
		TNT1 A 1 A_Raise
		Loop
	Fire:
		TNT1 A 0 A_JumpIfInventory("RemoteTNTNoDynamite",1,1)
		Goto Hold
		TNT1 A 0 A_GiveInventory("RemoteTNTDetonate")
		TNT1 A 0 A_PlaySound("TNT/Remote",CHAN_WEAPON,1.0)
		BRM2 Q 3
		BRM2 R 2
		BRM2 S 3
		BRM2 T 2
		TNT1 A 0 A_TakeInventory("RemoteTNTDetonate")
		Goto RaisingDynamite
	Hold:
		TNT1 A 0 A_GiveInventory("CalebInterpolateBar")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",5,"Hold6")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",4,"Hold5")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",3,"Hold4")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",2,"Hold3")
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",1,"Hold2")
	Hold1:
		BRMT M 4 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_ReFire("Hold")
		Goto Throw
	Hold2:
		BRMT N 4 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_ReFire("Hold")
		Goto Throw
	Hold3:
		BRMT O 4 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_ReFire("Hold")
		Goto Throw
	Hold4:
		BRMT P 4 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_ReFire("Hold")
		Goto Throw
	Hold5:
		BRMT Q 4 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_ReFire("Hold")
		Goto Throw
	Hold6:
		BRMT R 4 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_ReFire("Hold")
		Goto Throw
		
	Flash:
		TNT1 A 0 A_GiveInventory("ThrowPower", 5)
		TNT1 A 0 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Goto FlashEnd
	FlashEnd:
		TNT1 A 0 A_GiveInventory("ThrowPowerBig", 3)
		TNT1 A 0 A_JumpIfInventory("RemoteTNTSeamlessToken",5,2)
		TNT1 A 0 A_GiveInventory("RemoteTNTSeamlessToken")
		Stop
		TNT1 A 0 A_TakeInventory("RemoteTNTSeamlessToken")
		Stop
		
	AltFire:
		TNT1 A 0 A_JumpIfInventory("RocketAmmo", 1, 1)
		TNT1 A 0 A_JumpIfInventory("RemoteTNTNoDynamite",1,"RaisingDynamite")
		TNT1 A 0 A_TakeInventory("CalebInterpolateBar")
		TNT1 A 0 A_TakeInventory("ThrowPower")
		TNT1 A 0 A_GiveInventory("SamsaraBloodRemoteAttackHandler")
		BRMT E 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		BRM2 A 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		BRM2 B 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		BRM2 C 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		BRMT F 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		BRMT F 0 A_ReFire("AltHold")
		Goto ReadyAmmoless
	AltHold:
		BRMT S 3 
		TNT1 A 0 A_ReFire(1)
		Goto ReadyAmmoless
		BRMT T 3 
		TNT1 A 0 A_ReFire(1)
		Goto ReadyAmmoless
		BRMT U 3 
		TNT1 A 0 A_ReFire(1)
		Goto ReadyAmmoless
		BRMT V 3 
		TNT1 A 0 A_ReFire(1)
		Goto ReadyAmmoless
		BRMT W 3 
		TNT1 A 0 A_ReFire(1)
		Goto ReadyAmmoless
		BRMT X 3 
		TNT1 A 0 A_ReFire("AltHold")
		Goto ReadyAmmoless
		
	Spawn:
		CLVR S -1
		Stop
	Cannot:
		TNT1 A 0 A_TakeInventory("CalebInterpolateBar")
		TNT1 A 0 A_TakeInventory("ThrowPowerBig")
		TNT1 A 0 A_TakeInventory("ThrowPower")
		Goto Cannot2
	Cannot2:
		TNT1 A 0 A_SelectWeapon("Pitchfork")
		Goto Deselect

	Throw:
		BRM2 DEFGH 1
		TNT1 A 0 A_TakeInventory("CalebInterpolateBar")
		TNT1 A 0 A_PlayWeaponSound("TNT/Throw")
		TNT1 A 0 A_GiveInventory("SamsaraBloodRemoteAttackHandler")
		BRM2 IJKLMNOP 1
		Goto ReadyAmmoless
	}
}

Actor SamsaraBloodRemoteAttackHandler : Trigger
{
	States
	{
		Pickup:
			TNT1 A 0
			TNT1 A 0 A_TakeInventory("RocketAmmo", 1, TIF_NOTAKEINFINITE)
			TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)
			TNT1 A 0 A_FireCustomMissile("PlayerRemoteTNT",0,false,8,0)
			Stop
			TNT1 A 0 A_FireCustomMissile("PlayerRemoteTNT_Coop",0,false,8,0)
			Stop
	}
}

actor PlayerRemoteTNT : PlayerTNT
{
	Damage (0)
	BounceFactor 0.5
	BounceType "Hexen"
	+BOUNCEONACTORS
	-EXPLODEONWATER
	-PUSHABLE
	States
	{
	Spawn:
		RAIR F 0
		TNT1 A 0 A_SetUserVar("user_strength",CallACS("CalebThrowStrength"))
		TNT1 A 0 ACS_NamedExecuteWithResult("CalebThrowDuration")
		TNT1 A 0 A_ChangeVelocity((5+(user_strength))*(user_strength>0)*(sqrt(velx*velx + vely*vely)/5.0),0,(((5+(user_strength/2))*(sqrt(velx*velx + vely*vely)/5.0))+((5+(user_strength))*(velz/5.0)))*(user_strength>0),CVF_RELATIVE|CVF_REPLACE)
		Goto See
	See:
		RAIR F 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR F 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR G 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR G 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR H 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR H 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR A 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR A 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR B 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR B 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR C 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR C 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR D 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR D 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR E 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		RAIR E 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target) TNT1 A 0 A_ScaleVelocity(0.9) TNT1 A 0 A_JumpIf(sqrt(velx*velx + vely*vely + velz*velz) < 2,"Stay")
		Loop
	Stay:
		RTNT A 0 A_Stop
		RTNT A 0 A_SetScale(0.9)
		RTNT AAABBB 1 A_JumpIfInventory("RemoteTNTDetonate",1,"Explode",AAPTR_Target)
		Goto Stay+1
	Death:
	XDeath:
	Crash:
		"####" "#" 1 ACS_NamedExecuteWithResult("CalebTossableResolve",reactiontime,0,1)
		Wait
	Explode:
		TNT1 A 0 ACS_NamedExecuteWithResult("CalebFloorDynamite")
		TNT1 A 0 A_SpawnItemEx("Kaboom",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_CLIENTSIDE)
		Goto Super::BlowAway
	ExplodeFloor:
		Goto Super::Death
	}
}

actor PlayerRemoteTNT_Coop : PlayerRemoteTNT
{
	Species "Player"
	+THRUSPECIES
	+DONTHARMCLASS
	+DONTHARMSPECIES
	+MTHRUSPECIES
	DamageType "DynamiteCoop"
	States
	{
	Death:
		"####" "#" 1 ACS_NamedExecuteWithResult("CalebTossableResolve",reactiontime,0,1)
		Wait
	Explode:
		TNT1 A 0 A_CheckFloor("ExplodeFloor")
		TNT1 A 0 A_SpawnItemEx("Kaboom",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_CLIENTSIDE)
		Goto BlowAway
	ExplodeFloor:
		TNT1 A 0 A_SpawnItemEx("FloorKaboom",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION|SXF_CLIENTSIDE)
		Goto BlowAway
	BlowAway:
		TNT1 A 0 A_SpawnItemEx("BlowerCoop",0,0,-2,0,0,-10,0,SXF_NOCHECKPOSITION)
		Goto Super::ExplodeSound
	}
}

actor BloodRemoteTNTDummy
{
	Radius 2
	Height 4
	+CLIENTSIDEONLY
	+NOINTERACTION
	+NOGRAVITY
	States
	{
		Spawn:
			RAIR I 2
			stop
	}
}