actor Goldeneye_KnifePickedUpX : MapCoordinate {}
actor Goldeneye_KnifePickedUpY : MapCoordinate {}
actor Goldeneye_KnifePickedUpZ : MapCoordinate {}

actor Goldeneye_ThrowingKnives : SamsaraGoldenEyeWeapon
{
    Inventory.PickupMessage "Picked up a throwing knife."
    Inventory.PickupSound "Goldeneye/KnifeSwitch"
    Weapon.SlotNumber 1
    Weapon.SlotPriority 0
    Weapon.SelectionOrder 55
    Weapon.AmmoType "Goldeneye_ThrowingKnivesAmmo"
    Weapon.AmmoGive 1
    Obituary "%o got quietly killed by %k's knife."
    Tag "Throwing Knives"
    +NOAUTOAIM
    States
    {
      Spawn:
        PIST A -1
        stop

      // Single
      Ready:
        TNT1 A 0 A_JumpIfInventory("BondWatchQueue",1,"WatchRaise")
        TNT1 A 0 A_JumpIfInventory("BondWatchToken",1,"WatchReady")
        TNT1 A 0 A_JumpIfInventory("BondAltToggle",1,"DualWield")
      ReadyStart:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,2)
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,1)
        goto ReadyNoAmmo
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",0,"ReadyRight5")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",9,"ReadyRight4")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",8,"ReadyRight3")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",7,"ReadyRight2")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",6,"ReadyRight1")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",5,"ReadyCenter")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",4,"ReadyLeft1")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",3,"ReadyLeft2")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",2,"ReadyLeft3")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",1,"ReadyLeft4")
        goto ReadyCenter

      ReadyNoAmmo:
        GE02 Z 1 A_WeaponReady
        goto ReadyNoAmmoCheck

      ReadyRight5:
        GE01 E 1 A_WeaponReady
        goto Ready

      ReadyRight4:
        GE01 D 1 A_WeaponReady
        goto Ready

      ReadyRight3:
        GE01 C 1 A_WeaponReady
        goto Ready

      ReadyRight2:
        GE01 B 1 A_WeaponReady
        goto Ready

      ReadyRight1:
        GE01 A 1 A_WeaponReady
        goto Ready

      ReadyCenter:
        GE00 A 1 A_WeaponReady
        goto Ready

      ReadyLeft1:
        GE00 B 1 A_WeaponReady
        goto Ready

      ReadyLeft2:
        GE00 C 1 A_WeaponReady
        goto Ready

      ReadyLeft3:
        GE00 D 1 A_WeaponReady
        goto Ready

      ReadyLeft4:
        GE00 E 1 A_WeaponReady
        goto Ready

      ReadyNoAmmoCheck:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReloadStart")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"ReloadStart")
        goto Ready

      Deselect:
        GE00 A 0 A_JumpIfInventory("BondDualWieldToken",1,1)
        goto DeselectLoop
        GE00 A 0 A_GunFlash("DeselectDual",GFF_NOEXTCHANGE)
      DeselectLoop:
        GE00 A 0 A_TakeInventory("BondFireDelay")
        GE00 A 0 A_TakeInventory("BondAlternateFire")
        GE00 A 0 A_TakeInventory("BondDualWieldToken")
        GE00 A 0 A_TakeInventory("BondAltToggle")
        GE00 A 0 A_TakeInventory("BondZoomToken")
        GE00 A 0 A_TakeInventory("BondZoomAmountModifyActive")
        GE00 A 0 A_TakeInventory("BondDualWieldSpamProtector")
        GE00 A 0 A_TakeInventory("BondDryFireSpamProtector1")
        GE00 A 0 A_TakeInventory("BondDryFireSpamProtector2")
        GE00 A 0 A_TakeInventory("BondAltActivationToken")
        GE00 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"DeselectLoopAmmo")
        GE00 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"DeselectLoopAmmo")
        goto DeselectLoopNoAmmo

      DeselectLoopNoAmmo:
        GE02 Z 1 A_Lower
        goto DeselectLoop

      DeselectLoopAmmo:
        GE00 A 1 A_Lower
        goto DeselectLoop

      Select:
        GE00 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,2)
        GE00 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,1)
        goto SelectDualCheck
        GE00 A 0 A_PlaySound("Goldeneye/KnifeSwitch",CHAN_7)
      SelectDualCheck:
        GE00 A 0 A_JumpIfInventory("BondDualWieldToken",1,1)
        goto SelectLoop
        GE00 A 0 A_GunFlash("SelectDual",GFF_NOEXTCHANGE)
      SelectLoop:
        GE00 A 0 A_TakeInventory("Goldeneye_UnarmedToken")
        GE00 A 0 A_TakeInventory("Goldeneye_PP7Token")
        GE00 A 0 A_GiveInventory("Goldeneye_KnifeToken")
        GE00 A 0 A_TakeInventory("Goldeneye_KF7Token")
        GE00 A 0 A_TakeInventory("Goldeneye_AutoShotgunToken")
        GE00 A 0 A_TakeInventory("Goldeneye_AR33Token")
        GE00 A 0 A_TakeInventory("Goldeneye_RocketLauncherToken")
        GE00 A 0 A_TakeInventory("Goldeneye_RCP90Token")
        GE00 A 0 A_TakeInventory("Goldeneye_LaserToken")
        GE00 A 0 A_TakeInventory("Goldeneye_GoldenGunToken")
        GE00 A 0 A_TakeInventory("Goldeneye_SniperToken")
        GE00 A 0 A_TakeInventory("Goldeneye_D5KToken")
        GE00 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"SelectLoopAmmo")
        GE00 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"SelectLoopAmmo")
        goto SelectLoopNoAmmo

      SelectLoopNoAmmo:
        GE02 Z 1 A_Raise
        goto SelectDualCheck

      SelectLoopAmmo:
        GE00 A 1 A_Raise
        goto SelectDualCheck

      Fire:
        GE02 A 0 A_JumpIfInventory("BondSecondaryToken",1,1)
        goto FireAltDualCheck
        GE02 A 0 A_JumpIfInventory("BondAltActivationToken",1,"FireAltDualCheck")
        GE02 A 0 A_TakeInventory("BondAltToggle")
        GE02 A 0 A_GiveInventory("BondAltActivationToken")
        GE02 A 0 ACS_NamedExecuteAlways("BondAltFire")
        loop

      FireAltDualCheck:
        GE02 A 0 A_JumpIfInventory("BondAltToggle",1,"DualWieldFire")
      FireCheckDualOrder:
        GE02 A 0 A_JumpIfInventory("BondDualWieldToken",1,1)
        goto FireAmmoCheck
        GE02 A 0 A_JumpIfInventory("BondHoldingToken",1,"Ready")
        GE02 A 0 A_JumpIfInventory("BondAlternateFire",1,"Ready")
        goto FireAmmoCheck

      FireAmmoCheck:
        GE02 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FireStart")
        GE02 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"FireStart")
        goto FireDry

      FireDry:
        GE02 Z 0 A_JumpIfInventory("BondDryFireSpamProtector1",1,"FireSetDualOrder")
        GE02 Z 0 ACS_NamedExecuteAlways("BondDryFireSpamBlocker_Primary")
        GE02 Z 0 A_GiveInventory("BondDryFireSpamProtector1")
        goto FireSetDualOrder

      FireStart:
        GE02 A 0 A_GiveInventory("BondFiringToken")
        GE02 A 0 A_TakeInventory("BondGunAngleFiringSingle")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",0,"FireRight5")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",9,"FireRight4")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",8,"FireRight3")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",7,"FireRight2")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",6,"FireRight1")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",5,"FireCenter")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",4,"FireLeft1")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",3,"FireLeft2")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",2,"FireLeft3")
        GE02 A 0 A_JumpIfInventory("BondGunAngle",1,"FireLeft4")
        goto FireCenter

      FireRight5:
        GE07 A 0 A_GiveInventory("BondGunAngleFiringSingle",10)
        GE07 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE07 E 0
        goto FireContinue

      FireRight4:
        GE08 A 0 A_GiveInventory("BondGunAngleFiringSingle",9)
        GE08 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE08 E 0
        goto FireContinue

      FireRight3:
        GE09 A 0 A_GiveInventory("BondGunAngleFiringSingle",8)
        GE09 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE09 E 0
        goto FireContinue

      FireRight2:
        GE10 A 0 A_GiveInventory("BondGunAngleFiringSingle",7)
        GE10 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE10 E 0
        goto FireContinue

      FireRight1:
        GE11 A 0 A_GiveInventory("BondGunAngleFiringSingle",6)
        GE11 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE11 E 0
        goto FireContinue

      FireCenter:
        GE02 A 0 A_GiveInventory("BondGunAngleFiringSingle",5)
        GE02 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE02 E 0
        goto FireContinue

      FireLeft1:
        GE06 A 0 A_GiveInventory("BondGunAngleFiringSingle",4)
        GE06 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE06 E 0
        goto FireContinue

      FireLeft2:
        GE05 A 0 A_GiveInventory("BondGunAngleFiringSingle",3)
        GE05 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE05 E 0
        goto FireContinue

      FireLeft3:
        GE04 A 0 A_GiveInventory("BondGunAngleFiringSingle",2)
        GE04 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE04 E 0
        goto FireContinue

      FireLeft4:
        GE03 A 0 A_GiveInventory("BondGunAngleFiringSingle")
        GE03 ABCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE03 E 0
        goto FireContinue

      FireContinue:
        GE02 Z 7 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE) // +2 tics from previous state
      FireHold:
        GE02 Z 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE02 Z 0 A_GiveInventory("BondHoldingToken")
        GE02 Z 0 A_ReFire("FireHold")
      FireThrow:
        GE02 Z 0 A_GiveInventory("SamsaraGoldenEyeThrowingKnivesSingleAttackHandler")
        GE02 Z 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        GE02 Z 0 A_TakeInventory("BondFiringToken")
        GE02 Z 0 A_TakeInventory("BondHoldingToken")
        GE02 Z 5 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto FireSetDualOrder

      FireSetDualOrder:
        TNT1 A 0 A_JumpIfInventory("BondDualWieldToken",1,1)
        goto FireFinish
        TNT1 A 0 A_GiveInventory("BondAlternateFire")
        goto FireFinish

      FireFinish:
        TNT1 A 0 A_TakeInventory("BondFiringToken")
        goto ReadyNoAmmoCheck

      ReloadStart:
        GE27 IHGFEDCBA 1 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
        goto Ready

      // Dual Init
      AltFire:
        TNT1 A 0 A_JumpIfInventory("BondAltActivationToken",1,"Ready")
        TNT1 A 0 A_TakeInventory("BondAltToggle")
        TNT1 A 0 A_GiveInventory("BondAltActivationToken")
        TNT1 A 0 ACS_NamedExecuteAlways("BondAltFire")
        goto Ready

      DualUnwield:
        TNT1 A 0 A_TakeInventory("BondAlternateFire")
        TNT1 A 0 A_JumpIfInventory("BondDualWieldSpamProtector",1,5)
        TNT1 A 0 A_TakeInventory("BondDualWieldToken")
        TNT1 A 0 A_TakeInventory("BondDryFireSpamProtector1")
        TNT1 A 0 A_TakeInventory("BondDryFireSpamProtector2")
        TNT1 A 0 A_GunFlash("DualLower",GFF_NOEXTCHANGE)
        TNT1 A 0 A_ZoomFactor(1)
        goto ReadyStart

      DualUnwieldFire:
        GE02 A 0 A_TakeInventory("BondAlternateFire")
        GE02 A 0 A_JumpIfInventory("BondDualWieldSpamProtector",1,5)
        GE02 A 0 A_TakeInventory("BondDualWieldToken")
        GE02 A 0 A_TakeInventory("BondDryFireSpamProtector1")
        GE02 A 0 A_TakeInventory("BondDryFireSpamProtector2")
        GE02 A 0 A_GunFlash("DualLower",GFF_NOEXTCHANGE)
        GE02 A 0 A_ZoomFactor(1)
        goto FireCheckDualOrder

      DualLower:
        TNT1 A 0 A_TakeInventory("BondHoldingToken")
        TNT1 A 0 A_TakeInventory("BondDualReloadSpamProtector")
        TNT1 A 0 A_GiveInventory("BondDualWieldSpamProtector")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"DualLowerAmmo")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"DualLowerAmmo")
        goto DualLowerNoAmmo

      DualLowerNoAmmo:
        TNT1 AAAAAAAAA 1
        goto DualLowerFinish

      DualLowerAmmo:
        GE26 ABCDEFGHI 1
        goto DualLowerFinish

      DualLowerFinish:
        TNT1 A 0 A_TakeInventory("BondDualWieldSpamProtector")
        stop

      DualWield:
        TNT1 A 0 A_TakeInventory("BondAltActivationToken")
        TNT1 A 0 A_TakeInventory("BondAltToggle")
        TNT1 A 0 A_TakeInventory("BondZoomToken")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesDualToken",1,1)
        goto ReadyStart
        TNT1 A 0 A_JumpIfInventory("BondDualWieldToken",1,"DualUnwield")
        TNT1 A 0 A_JumpIfInventory("BondDualWieldSpamProtector",1,3)
        TNT1 A 0 A_GiveInventory("BondDualWieldToken")
        TNT1 A 0 A_GunFlash("DualRaise",GFF_NOEXTCHANGE)
        TNT1 A 0 A_ZoomFactor(1)
        goto ReadyStart

      DualWieldFire:
        GE02 A 0 A_TakeInventory("BondAltActivationToken")
        GE02 A 0 A_TakeInventory("BondAltToggle")
        GE02 A 0 A_TakeInventory("BondZoomToken")
        GE02 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesDualToken",1,1)
        goto FireCheckDualOrder
        GE02 A 0 A_JumpIfInventory("BondDualWieldToken",1,"DualUnwieldFire")
        GE02 A 0 A_JumpIfInventory("BondDualWieldSpamProtector",1,3)
        GE02 A 0 A_GiveInventory("BondDualWieldToken")
        GE02 A 0 A_GunFlash("DualRaise",GFF_NOEXTCHANGE)
        GE02 A 0 A_ZoomFactor(1)
        goto FireCheckDualOrder

      DualRaise:
        TNT1 A 0 A_TakeInventory("BondHoldingToken")
        TNT1 A 0 A_TakeInventory("BondDualReloadSpamProtector")
        TNT1 A 0 A_GiveInventory("BondDualWieldSpamProtector")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"DualRaiseAmmo")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"DualRaiseAmmo")
        goto DualRaiseNoAmmo

      DualRaiseNoAmmo:
        TNT1 AAAAAAAAA 1
        goto DualRaiseFinish

      DualRaiseAmmo:
        GE26 I 1 A_PlaySound("Goldeneye/KnifeSwitch",CHAN_7)
        GE26 HGFEDCBA 1
        goto DualRaiseFinish

      DualRaiseFinish:
        TNT1 A 0 A_TakeInventory("BondDualWieldSpamProtector")
        goto ReadyStartDual

      // Dual
      ReadyDual:
        TNT1 A 0 A_JumpIfInventory("BondHoldingToken",1,"ReadyStartDual")
        TNT1 A 0 A_JumpIfInventory("BondAlternateFire",1,1)
        goto ReadyStartDual
        TNT1 A 0 A_JumpIfInventory("BondPrimaryToken",1,"FireDual")
      ReadyStartDual:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,2)
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,1)
        goto ReadyNoAmmoDual
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",0,"ReadyRight5Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",9,"ReadyRight4Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",8,"ReadyRight3Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",7,"ReadyRight2Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",6,"ReadyRight1Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",5,"ReadyCenterDual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",4,"ReadyLeft1Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",3,"ReadyLeft2Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",2,"ReadyLeft3Dual")
        TNT1 A 0 A_JumpIfInventory("BondGunAngle",1,"ReadyLeft4Dual")
        goto ReadyCenterDual

      ReadyNoAmmoDual:
        TNT1 A 1
        goto ReadyNoAmmoCheckDual

      ReadyRight5Dual:
        GE15 E 1
        goto ReadyDual

      ReadyRight4Dual:
        GE15 D 1
        goto ReadyDual

      ReadyRight3Dual:
        GE15 C 1
        goto ReadyDual

      ReadyRight2Dual:
        GE15 B 1
        goto ReadyDual

      ReadyRight1Dual:
        GE15 A 1
        goto ReadyDual

      ReadyCenterDual:
        GE14 A 1
        goto ReadyDual

      ReadyLeft1Dual:
        GE14 B 1
        goto ReadyDual

      ReadyLeft2Dual:
        GE14 C 1
        goto ReadyDual

      ReadyLeft3Dual:
        GE14 D 1
        goto ReadyDual

      ReadyLeft4Dual:
        GE14 E 1
        goto ReadyDual

      ReadyNoAmmoCheckDual:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReloadStartDual")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"ReloadStartDual")
        goto ReadyDual

      DeselectDual:
        TNT1 A 0 A_TakeInventory("BondHoldingToken")
        TNT1 A 0 A_TakeInventory("BondDualReloadSpamProtector")
        TNT1 A 0 A_TakeInventory("BondDualWieldSpamProtector")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"DeselectDualAmmo")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"DeselectDualAmmo")
        goto DeselectDualNoAmmo

      DeselectDualNoAmmo:
        TNT1 AAAAAAAAAAAAAAAA 1
        stop

      DeselectDualAmmo:
        GE26 AAAAAAAAAAAAAAAA 1
        stop

      SelectDual:
        TNT1 A 0 A_TakeInventory("BondHoldingToken")
        TNT1 A 0 A_TakeInventory("BondDualReloadSpamProtector")
        TNT1 A 0 A_TakeInventory("BondDualWieldSpamProtector")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"SelectDualAmmo")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"SelectDualAmmo")
        goto SelectDualNoAmmo

      SelectDualNoAmmo:
        TNT1 A 1
        goto ReadyStartDual

      SelectDualAmmo:
        GE26 A 1
        goto ReadyStartDual

      FireDual:
        GE16 A 0 A_JumpIfInventory("BondAlternateFire",1,"FireAmmoCheckDual")
        GE16 A 0 A_JumpIfInventory("BondHoldingToken",1,"FireAmmoCheckDual")
        goto ReadyDual

      FireAmmoCheckDual:
        GE16 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FireStartDual")
        GE16 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"FireStartDual")
        goto FireDryDual

      FireDryDual:
        TNT1 A 0 A_JumpIfInventory("BondDryFireSpamProtector2",1,"FireSetDualOrderDual")
        TNT1 A 0 ACS_NamedExecuteAlways("BondDryFireSpamBlocker_Secondary")
        TNT1 A 0 A_GiveInventory("BondDryFireSpamProtector2")
        goto FireSetDualOrderDual

      FireStartDual:
        GE16 A 0 A_GiveInventory("BondFiringToken")
        GE16 A 0 A_TakeInventory("BondGunAngleFiringDual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",0,"FireRight5Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",9,"FireRight4Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",8,"FireRight3Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",7,"FireRight2Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",6,"FireRight1Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",5,"FireCenterDual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",4,"FireLeft1Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",3,"FireLeft2Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",2,"FireLeft3Dual")
        GE16 A 0 A_JumpIfInventory("BondGunAngle",1,"FireLeft4Dual")
        goto FireCenterDual

      FireRight5Dual:
        GE21 A 2 A_GiveInventory("BondGunAngleFiringDual",10)
        GE21 BCD 2
        GE21 E 0
        goto FireDualContinue

      FireRight4Dual:
        GE22 A 2 A_GiveInventory("BondGunAngleFiringDual",9)
        GE22 BCD 2
        GE22 E 0
        goto FireDualContinue

      FireRight3Dual:
        GE23 A 2 A_GiveInventory("BondGunAngleFiringDual",8)
        GE23 BCD 2
        GE23 E 0
        goto FireDualContinue

      FireRight2Dual:
        GE24 A 2 A_GiveInventory("BondGunAngleFiringDual",7)
        GE24 BCD 2
        GE24 E 0
        goto FireDualContinue

      FireRight1Dual:
        GE25 A 2 A_GiveInventory("BondGunAngleFiringDual",6)
        GE25 BCD 2
        GE25 E 0
        goto FireDualContinue

      FireCenterDual:
        GE16 A 2 A_GiveInventory("BondGunAngleFiringDual",5)
        GE16 BCD 2
        GE16 E 0
        goto FireDualContinue

      FireLeft1Dual:
        GE20 A 2 A_GiveInventory("BondGunAngleFiringDual",4)
        GE20 BCD 2
        GE20 E 0
        goto FireDualContinue

      FireLeft2Dual:
        GE19 A 2 A_GiveInventory("BondGunAngleFiringDual",3)
        GE19 BCD 2
        GE19 E 0
        goto FireDualContinue

      FireLeft3Dual:
        GE18 A 2 A_GiveInventory("BondGunAngleFiringDual",2)
        GE18 BCD 2
        GE18 E 0
        goto FireDualContinue

      FireLeft4Dual:
        GE17 A 2 A_GiveInventory("BondGunAngleFiringDual")
        GE17 BCD 2
        GE17 E 0
        goto FireDualContinue

      FireDualContinue:
        TNT1 A 7 // +2 tics from previous state
      FireDualHold:
        TNT1 A 1
        TNT1 A 0 A_GiveInventory("BondHoldingToken")
        TNT1 A 0 A_JumpIfInventory("BondPrimaryToken",1,"FireDualHold")
      FireDualThrow:
        TNT1 A 1 A_GiveInventory("SamsaraGoldenEyeThrowingKnivesDualAttackHandler")
        TNT1 A 0 A_TakeInventory("BondFiringToken")
        TNT1 A 5 A_TakeInventory("BondHoldingToken")
        goto FireSetDualOrderDual

      FireSetDualOrderDual:
        TNT1 A 0 A_TakeInventory("BondAlternateFire")
        goto FireFinishDual

      FireFinishDual:
        TNT1 A 0 A_TakeInventory("BondFiringToken")
        goto ReadyNoAmmoCheckDual

      ReloadStartDual:
        GE26 I 1 A_GiveInventory("BondDualReloadSpamProtector")
        GE26 HGFEDCBA 1
        TNT1 A 0 A_TakeInventory("BondDualReloadSpamProtector")
        goto ReadyDual

      // Watch
      WatchLower:
        GE13 T 0 A_TakeInventory("BondWatchActivate")
        GE13 T 0 A_GiveInventory("BondWatchUIDeinit")
      WatchLowerStart:
        GE13 T 0 ACS_NamedExecuteAlways("BondWatchLookUpAndDown")
        GE13 T 12 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_DISABLESWITCH)
        GE13 SRQPONMLKJIHGFEDCBA 2 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE|WRF_DISABLESWITCH)
      WatchLowerDualCheck:
        GE13 A 0 A_JumpIfInventory("BondDualWieldToken",1,1)
        goto WatchLowerFinish
        GE13 A 0 A_GunFlash("DualRaise",GFF_NOEXTCHANGE)
        GE13 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"WatchLowerDualCheckAmmo")
        GE13 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"WatchLowerDualCheckAmmo")
        goto WatchLowerDualCheckNoAmmo

      WatchLowerDualCheckNoAmmo:
        GE02 Z 12 A_WeaponReady(WRF_NOFIRE|WRF_DISABLESWITCH)
        goto WatchLowerFinish

      WatchLowerDualCheckAmmo:
        GE00 A 12 A_WeaponReady(WRF_NOFIRE|WRF_DISABLESWITCH)
        goto WatchLowerFinish

      WatchRaise:
        GE13 A 0 A_ZoomFactor(1)
        GE13 A 0 A_TakeInventory("BondAltToggle")
        GE13 A 0 A_TakeInventory("BondZoomToken")
        GE13 A 0 A_TakeInventory("BondZoomAmountModifyActive")
        GE13 A 0 A_JumpIfInventory("BondWatchToken",1,"WatchLower")
        GE13 A 0 A_GiveInventory("BondWatchActivate")
      WatchRaiseDualCheck:
        GE13 A 0 A_JumpIfInventory("BondDualWieldToken",1,1)
        goto WatchRaiseStart
        GE13 A 0 A_GunFlash("DualLower",GFF_NOEXTCHANGE)
        GE13 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"WatchRaiseDualCheckAmmo")
        GE13 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,"WatchRaiseDualCheckAmmo")
        goto WatchRaiseDualCheckNoAmmo

      WatchRaiseDualCheckNoAmmo:
        GE02 Z 12 A_WeaponReady(WRF_NOFIRE|WRF_DISABLESWITCH)
        goto WatchRaiseStart

      WatchRaiseDualCheckAmmo:
        GE00 A 12 A_WeaponReady(WRF_NOFIRE|WRF_DISABLESWITCH)
        goto WatchRaiseStart
    }
}

// Attack handlers

actor SamsaraGoldenEyeThrowingKnivesSingleAttackHandler : Trigger
{
    States
    {
      // Ammo checking/taking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttack")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,1)
        stop
        TNT1 A 0 A_TakeInventory("Goldeneye_ThrowingKnivesAmmo",1)
        goto PickupAttack

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_PlaySound("Goldeneye/KnifeThrow",CHAN_WEAPON)
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",0,"PickupAttackRight5")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",9,"PickupAttackRight4")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",8,"PickupAttackRight3")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",7,"PickupAttackRight2")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",6,"PickupAttackRight1")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",5,"PickupAttackCenter")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",4,"PickupAttackLeft1")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",3,"PickupAttackLeft2")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",2,"PickupAttackLeft3")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringSingle",1,"PickupAttackLeft4")
        goto PickupAttackCenter

      PickupAttackRight5:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight5Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight5Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight5Coop")
      PickupAttackRight5DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-10+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight5Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-10+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight5Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight5InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight5InfiniteCoop")
      PickupAttackRight5InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-10+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight5InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-10+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight4Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight4Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight4Coop")
      PickupAttackRight4DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-8+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-8+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight4InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight4InfiniteCoop")
      PickupAttackRight4InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-8+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-8+frandom(-0.2,0.2),false,11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight3Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight3Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight3Coop")
      PickupAttackRight3DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-6+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-6+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight3InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight3InfiniteCoop")
      PickupAttackRight3InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-6+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-6+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight2Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight2Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight2Coop")
      PickupAttackRight2DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-4+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-4+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight2InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight2InfiniteCoop")
      PickupAttackRight2InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-4+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-4+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight1Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight1Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight1Coop")
      PickupAttackRight1DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-2+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-2+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight1InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight1InfiniteCoop")
      PickupAttackRight1InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-2+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-2+frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenter:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackCenterInfinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCenterCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCenterCoop")
      PickupAttackCenterDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenterCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenterInfinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCenterInfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCenterInfiniteCoop")
      PickupAttackCenterInfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenterInfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",frandom(-0.2,0.2),false,12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft1Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft1Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft1Coop")
      PickupAttackLeft1DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",3+frandom(-0.2,0.2),false,10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",3+frandom(-0.2,0.2),false,10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft1InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft1InfiniteCoop")
      PickupAttackLeft1InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",3+frandom(-0.2,0.2),false,10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",3+frandom(-0.2,0.2),false,10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft2Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft2Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft2Coop")
      PickupAttackLeft2DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",7+frandom(-0.2,0.2),false,8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",7+frandom(-0.2,0.2),false,8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft2InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft2InfiniteCoop")
      PickupAttackLeft2InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",7+frandom(-0.2,0.2),false,8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",7+frandom(-0.2,0.2),false,8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft3Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft3Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft3Coop")
      PickupAttackLeft3DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",11+frandom(-0.2,0.2),false,4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",11+frandom(-0.2,0.2),false,4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft3InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft3InfiniteCoop")
      PickupAttackLeft3InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",11+frandom(-0.2,0.2),false,4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",11+frandom(-0.2,0.2),false,4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft4Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft4Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft4Coop")
      PickupAttackLeft4DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft4InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft4InfiniteCoop")
      PickupAttackLeft4InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop
    }
}

actor SamsaraGoldenEyeThrowingKnivesDualAttackHandler : Trigger
{
    States
    {
      // Ammo checking/taking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttack")
        TNT1 A 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",1,1)
        stop
        TNT1 A 0 A_TakeInventory("Goldeneye_ThrowingKnivesAmmo",1)
        goto PickupAttack

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_PlaySound("Goldeneye/KnifeThrow",CHAN_WEAPON)
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",0,"PickupAttackRight5")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",9,"PickupAttackRight4")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",8,"PickupAttackRight3")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",7,"PickupAttackRight2")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",6,"PickupAttackRight1")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",5,"PickupAttackCenter")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",4,"PickupAttackLeft1")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",3,"PickupAttackLeft2")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",2,"PickupAttackLeft3")
        TNT1 A 0 A_JumpIfInventory("BondGunAngleFiringDual",1,"PickupAttackLeft4")
        goto PickupAttackCenter

      PickupAttackRight5:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight5Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight5Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight5Coop")
      PickupAttackRight5DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-10+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight5Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-10+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight5Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight5InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight5InfiniteCoop")
      PickupAttackRight5InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-10+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight5InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-10+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight4Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight4Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight4Coop")
      PickupAttackRight4DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-8+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-8+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight4InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight4InfiniteCoop")
      PickupAttackRight4InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-8+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight4InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-8+frandom(-0.2,0.2),false,-11,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight3Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight3Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight3Coop")
      PickupAttackRight3DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-6+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-6+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight3InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight3InfiniteCoop")
      PickupAttackRight3InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-6+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight3InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-6+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight2Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight2Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight2Coop")
      PickupAttackRight2DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-4+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-4+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight2InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight2InfiniteCoop")
      PickupAttackRight2InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-4+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight2InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-4+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackRight1Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight1Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight1Coop")
      PickupAttackRight1DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",-2+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",-2+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRight1InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRight1InfiniteCoop")
      PickupAttackRight1InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",-2+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackRight1InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",-2+frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenter:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackCenterInfinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCenterCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCenterCoop")
      PickupAttackCenterDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenterCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenterInfinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCenterInfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCenterInfiniteCoop")
      PickupAttackCenterInfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackCenterInfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",frandom(-0.2,0.2),false,-12,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft1Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft1Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft1Coop")
      PickupAttackLeft1DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",3+frandom(-0.2,0.2),false,-10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",3+frandom(-0.2,0.2),false,-10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft1InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft1InfiniteCoop")
      PickupAttackLeft1InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",3+frandom(-0.2,0.2),false,-10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft1InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",3+frandom(-0.2,0.2),false,-10,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft2Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft2Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft2Coop")
      PickupAttackLeft2DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",7+frandom(-0.2,0.2),false,-8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",7+frandom(-0.2,0.2),false,-8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft2InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft2InfiniteCoop")
      PickupAttackLeft2InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",7+frandom(-0.2,0.2),false,-8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft2InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",7+frandom(-0.2,0.2),false,-8,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft3Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft3Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft3Coop")
      PickupAttackLeft3DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",11+frandom(-0.2,0.2),false,-4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",11+frandom(-0.2,0.2),false,-4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft3InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft3InfiniteCoop")
      PickupAttackLeft3InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",11+frandom(-0.2,0.2),false,-4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft3InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",11+frandom(-0.2,0.2),false,-4,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttackLeft4Infinite")
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft4Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft4Coop")
      PickupAttackLeft4DM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectile",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4Coop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileCoop",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4Infinite:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeft4InfiniteCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeft4InfiniteCoop")
      PickupAttackLeft4InfiniteDM:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfinite",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop

      PickupAttackLeft4InfiniteCoop:
        TNT1 A 0 A_FireCustomMissile("Goldeneye_KnifeProjectileInfiniteCoop",15+frandom(-0.2,0.2),false,0,0,0,frandom(-0.2,0.2))
        stop
    }
}

actor Goldeneye_ThrowingKnivesAmmo : Ammo
{
    Inventory.Icon "AMSMO0"
    Inventory.Amount 1
    Inventory.MaxAmount 6
    Ammo.BackpackAmount 3
    Ammo.BackpackMaxAmount 12
    Tag "Throwing Knives"
}

actor Goldeneye_KnifeProjectile
{
    var int user_pitch;
    var int user_damage;
    Projectile
    Radius 6
    Height 8
    Speed 20
    Damage (50)
    Gravity 0.33
    BounceType "Doom"
    BounceFactor 0.1
    WallBounceFactor 0.1
    Scale 0.5
    +BOUNCEONACTORS
    +HITTRACER
    +ISMONSTER
    +MOVEWITHSECTOR
    +NODAMAGETHRUST
    +NOEXTREMEDEATH
    -NOGRAVITY
    +USEBOUNCESTATE
    States
    {
      Spawn:
        GE00 A 0
        GE00 A 0 A_PlaySound("Goldeneye/KnifeThrow",CHAN_VOICE,1.0,true)
        GE00 A 0 A_SetUserVar("user_pitch",CallACS("BondThrownKnifePitch"))
        GE00 A 0 A_SetPitch(user_pitch-90)
      SpawnLoop:
        GE00 A 0 A_JumpIf(velx == 0 || vely == 0, "Death")
        GE00 A 1 A_SetPitch(pitch+15,SPF_INTERPOLATE)
        loop

      Bounce:
        GE00 A 0 A_PlaySound("silence",CHAN_VOICE)
        GE00 A 0 A_StopSound(CHAN_VOICE)
        GE00 A 0 A_PlaySound("Goldeneye/KnifeCollide",CHAN_VOICE)
        goto SpawnLoop

      Bounce.Actor:
        GE00 A 0 A_PlaySound("silence",CHAN_VOICE)
        GE00 A 0 A_StopSound(CHAN_VOICE)
        GE00 A 0 A_PlaySound("Goldeneye/HitBody",CHAN_VOICE)
        GE00 A 0 A_SetUserVar("user_damage",50)
        GE00 A 0 A_Explode(CallACS("BondHitBox", user_damage),8,0,false,8)
        goto SpawnLoop

      Death:
        GE00 A 0 A_ChangeFlag("THRUACTORS",true)
      DeathLoseInertia:
        GE00 A 0 A_JumpIfCloser(24,"Remove")
        GE00 A 1 A_SetPitch(pitch+(15/abs(sqrt(velx*2+vely*2)-5)+1),SPF_INTERPOLATE)
        GE00 A 0 A_CheckFloor("DeathStart")
        loop

      DeathStart:
        GE00 B 0 A_PlaySound("silence",CHAN_VOICE)
        GE00 B 0 A_StopSound(CHAN_VOICE)
        GE00 B 0 A_PlaySound("Goldeneye/KnifeCollide",CHAN_VOICE)
        GE00 B 0 A_SetPitch(0)
        GE00 B 0 A_SetAngle(angle-90)
      DeathLoop:
        GE00 B 0 A_JumpIfInventory("Goldeneye_ThrowingKnivesAmmo",0,2,AAPTR_TARGET)
        GE00 B 0 A_JumpIfCloser(24,"Remove")
        GE00 B 1
        loop

      Remove:
        TNT1 A 0 A_GiveInventory("Goldeneye_KnifePickup",1,AAPTR_TARGET)
        stop
    }
}

actor Goldeneye_KnifeProjectileCoop : Goldeneye_KnifeProjectile
{
    Species "Player"
    +THRUSPECIES
}

actor Goldeneye_KnifeProjectileInfinite : Goldeneye_KnifeProjectile 
{
    States
    {
      Death:
        GE00 A 0 A_ChangeFlag("THRUACTORS",true)
      DeathLoseInertia:
        GE00 A 1 A_SetPitch(pitch+(15/abs(sqrt(velx*2+vely*2)-5)+1),SPF_INTERPOLATE)
        GE00 A 0 A_CheckFloor("DeathStart")
        loop

      DeathStart:
        GE00 B 0 A_PlaySound("silence",CHAN_VOICE)
        GE00 B 0 A_StopSound(CHAN_VOICE)
        GE00 B 0 A_PlaySound("Goldeneye/KnifeCollide",CHAN_VOICE)
        GE00 B 0 A_SetPitch(0)
        GE00 B 0 A_SetAngle(angle-90)
      DeathLoop:
        GE00 B 1 A_FadeOut(0.04)
        loop
    }
}

actor Goldeneye_KnifeProjectileInfiniteCoop : Goldeneye_KnifeProjectileInfinite
{
    Species "Player"
    +THRUSPECIES
}

actor Goldeneye_KnifePickup : Trigger
{
    States
    {
      Pickup:
        TNT1 A 0 A_PlaySound("Goldeneye/KnifeSwitch",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 A_GiveInventory("Goldeneye_ThrowingKnivesAmmo",1)
        stop
    }
}
