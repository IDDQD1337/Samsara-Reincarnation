Actor DeusEx_FlameThrowerMagazine : Ammo
{
	+INVENTORY.IGNORESKILL
	Inventory.Amount 1
	Inventory.MaxAmount 100 
}


Actor DeusEx_FlameThrower : DeusExWeapon // horrifically overpowered. will have to rethink later.
{
	Weapon.SelectionOrder 1600
	Weapon.SlotNumber 6
	Weapon.SlotPriority 1
	Weapon.AmmoType1 "DeusEx_FlameThrowerMagazine"
	Weapon.AmmoUse1 1
	Weapon.AmmoType2 "Cell"
	Weapon.AmmoUse2 0
	Weapon.AmmoGive1 0
	Weapon.AmmoGive2 100
	Tag "FlameThrower"
	Weapon.UpSound "DeusEx/FlameThrower/Select"
	Inventory.PickupMessage "You found a FlameThrower."
	Obituary "%o was burned to a crisp with %k's FlameThrower."
	States
	{
		Spawn:
			DX03 A -1
			Stop
		Select:
			TNT1 AAAAAAAAAAAAAAAAAAAA 0 A_Raise
			TNT1 A 1 A_Raise
			loop
	    Ready:
			//DX00 B 0 A_JumpIfInventory("DeusEx_HeavyWeaponSkill", 2, 2)
			DX00 B 0 A_GunFlash("ReadyFlame",GFF_NOEXTCHANGE)
			DX00 B 0 A_GiveInventory("DeusEX_FlameThrowerEquipped", 1) //ACS_NamedExecuteAlways("DeusEx_Decorate", 0, 3)		
			DX00 BCDEFGHI 3
			DX00 A 0 A_TakeInventory("DeusEx_Reloading", 1)
			Goto ReadyLoop
		ReadyFlame:
			DX03 ABCDEFGH 3 Bright
			Stop
		ReadyLoop:
			DX00 A 0 A_TakeInventory("DeusEx_FlamethrowerFiring",1)
			DX00 A 0 A_GunFlash("ReadyLoopFlame",GFF_NOEXTCHANGE)
			DX00 AAAAAAAAAAAAAAAAAAAAAAAA 1 A_WeaponReady(WRF_ALLOWRELOAD) 
			DX00 A 0 A_Jump(96, "Idle1", "Idle2")
			Loop
		ReadyLoopFlame:
			DX02 ABCDEFGH 3 Bright
			Loop
		Idle1:
			DX00 A 6 A_GunFlash("Idle1Flame",GFF_NOEXTCHANGE)
			DX01 IJKLMNOP 6 A_WeaponReady(WRF_ALLOWRELOAD)
			Goto ReadyLoop
		Idle1Flame:
			"####" "#" 6 Bright
			DX04 ABCDEFGH 6 Bright
			Stop
		Idle2:
			DX00 A 6 A_GunFlash("Idle2Flame",GFF_NOEXTCHANGE)
			DX01 QRSTUVWX 6 A_WeaponReady(WRF_ALLOWRELOAD)
			Goto ReadyLoop
		Idle2Flame:
			"####" "#" 6 Bright
			DX05 ABCDEFGH 6 Bright
			Stop
		Fire:
			DX00 J 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1)
			Goto FireReload
			DX00 J 0 A_GiveInventory("DeusEx_FlamethrowerFiring",1)
			DX00 J 0 ACS_NamedExecuteWithResult("DeusExFlamethrowerHandler")
		Fire2:
			DX00 J 0 A_GunFlash("FireFlame",GFF_NOEXTCHANGE)
			DX00 J 0 A_AlertMonsters(1000)
			DX00 J 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1) 
			Goto FireReload
			DX00 J 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 K 0 A_Refire(1)
			Goto FireFinishTransition
			DX00 K 0 A_AlertMonsters(1000)
			DX00 K 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1) 
			Goto FireReload
			DX00 K 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 L 0 A_Refire(1)
			Goto FireFinishTransition
			DX00 L 0 A_AlertMonsters(1000)
			DX00 L 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1) 
			Goto FireReload
			DX00 L 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 M 0 A_Refire(1)
			Goto FireFinishTransition
			DX00 M 0 A_AlertMonsters(1000)
			DX00 M 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1)
			Goto FireReload
			DX00 M 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 N 0 A_Refire(1)
			Goto FireFinishTransition
			DX00 N 0 A_AlertMonsters(1000)
			DX00 N 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1) 
			Goto FireReload
			DX00 N 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 O 0 A_Refire(1)
			Goto FireFinishTransition
			DX00 O 0 A_AlertMonsters(1000)
			DX00 O 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1) 
			Goto FireReload
			DX00 O 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 P 0 A_Refire(1)
			Goto FireFinishTransition
			DX00 P 0 A_AlertMonsters(1000)
			DX00 P 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1) 
			Goto FireReload
			DX00 P 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 Q 0 A_Refire(1)
			Goto FireFinishTransition
			DX00 Q 0 A_AlertMonsters(1000)
			DX00 Q 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 1, 1) 
			Goto FireReload
			DX00 Q 3 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			DX00 J 0 A_Refire("Fire2")
			Goto FireFinishTransition
		FireFlame:
			DX07 ABCDEFGH 3 Bright
			DX07 A 0
			Stop
		FireFinishTransition:
			"####" "#" 3
			Goto ReadyLoop
		FireReload:
			"####" "#" 3
			DX00 A 0 A_GunFlash("ReadyLoopFlame",GFF_NOEXTCHANGE)
			DX00 A 0 A_TakeInventory("DeusEx_FlamethrowerFiring",1)
			DX00 A 0 A_PlaySound("DeusEx/DryFire", CHAN_WEAPON)
			DX00 A 3
			DX00 A 1 A_ClearRefire
			Goto Reload
		Reload:
			DX00 R 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine", 0, "ReadyLoop")
			DX00 R 0 A_JumpIfInventory("Cell", 1, "ReloadSuccess")
			Goto ReadyLoop
		ReloadSuccess:
			DX00 R 0 A_GunFlash("ReloadFlame",GFF_NOEXTCHANGE)
			DX00 R 0 A_GiveInventory("DeusEx_Reloading", 1)
			DX00 R 4 A_PlaySound("DeusEx/Flamethrower/Reload1", CHAN_WEAPON)
			DX00 ST 4 A_WeaponReady(WRF_NOFIRE)
			DX00 U 0 A_JumpIfInventory("DeusEx_HeavyWeaponSkill", 4, "ReloadAmmo")
			DX00 U 0 A_JumpIfInventory("DeusEx_HeavyWeaponSkill", 3, 16)
			DX00 U 0 A_JumpIfInventory("DeusEx_HeavyWeaponSkill", 2, 8)
			DX00 "UVWXYZ[UVWXYZ[UVWXYZ[" 4 A_WeaponReady(WRF_NOFIRE)
			Goto ReloadAmmo
		ReloadAmmo:
			DX00 "\" 0 A_JumpIfInventory("DeusEx_FlameThrowerMagazine",0,"ReloadFinish")
			DX00 "\" 0 A_JumpIfInventory("Cell",1,1)
			goto ReloadFinish
			DX00 "\" 0 A_GiveInventory("DeusEx_FlameThrowerMagazine",2)
			DX00 "\" 0 A_TakeInventory("Cell",1,TIF_NOTAKEINFINITE)
			loop
		ReloadFinish:
			DX00 "\" 0 A_PlaySound("DeusEx/Flamethrower/Reload2", CHAN_WEAPON)
			DX00 "\" 0 A_TakeInventory("DeusEx_Reloading", 1)
			DX00 "\]" 4
			DX01 AB 4
			Goto ReadyLoop
		ReloadFlame:
			DX08 ABC 4 Bright
			DX08 D 0 A_JumpIfInventory("DeusEx_HeavyWeaponSkill", 4, 24)
			DX08 D 0 A_JumpIfInventory("DeusEx_HeavyWeaponSkill", 3, 16)
			DX08 D 0 A_JumpIfInventory("DeusEx_HeavyWeaponSkill", 2, 8)
			DX08 DEFGHIJDEFGHIJDEFGHIJ 4 Bright
			DX08 KLMN 4 Bright
			Stop
		Deselect:
			DX01 C 4 A_GunFlash("DeselectFlame",GFF_NOEXTCHANGE)
			DX01 C 0 A_TakeInventory("DeusEx_FlamethrowerFiring",1)
			DX01 C 0 A_GiveInventory("DeusEx_Reloading", 1)
			DX01 CDEFGH 4
			TNT1 A 4 A_TakeInventory("DeusEX_FlamethrowerEquipped", 999) //ACS_NamedExecuteAlways("DeusEx_Decorate", 0, 4)
			Goto Super::InstantDeselect
		DeselectFlame:
			"####" "#" 4 Bright
			DX06 ABCDEF 4 Bright
			Stop
	}
}

Actor DeusEx_FlamethrowerFiring : Boolean {}
Actor DeusEx_FlamethrowerIsOnFire : Boolean {}
Actor DeusEx_FlamethrowerOnFireCounter : Counter { Inventory.MaxAmount 1050 }

Actor DeusEx_FlamethrowerFireHandler : Trigger
{
	States
	{
		Pickup:
			TNT1 A 0 A_TakeInventory("DeusEx_FlameThrowerMagazine",1,TIF_NOTAKEINFINITE)
			TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"FireCoop")
			TNT1 A 0 A_JumpIfInventory("DMModeOn",1,"FireDM")
		Firing:
			TNT1 A 0 A_FireCustomMissile("DeusEx_Fireball", frandom(-3.0,3.0), 1, 16, 16, frandom(-3.0,3.0))
			Stop
		FireCoop:
			TNT1 A 0 A_FireCustomMissile("DeusEx_FireballCoop", frandom(-3.0,3.0), 1, 16, 16, frandom(-3.0,3.0))
			Stop
		FireDM:
			TNT1 A 0 A_FireCustomMissile("DeusEx_FireballDM", frandom(-3.0,3.0), 1, 16, 16, 0, frandom(-3.0,3.0))
			Stop
	}
}

Actor DeusEx_FireBall
{
	PROJECTILE
	Radius 6
	Height 5
	Speed 12
	Damage (CallACS("DeusEx_WeaponSkillDamage", 5, 5))
	PoisonDamageType "DeusExFlamed"
	PoisonDamage 5, 30, 35 //can't scale up poison damage =(
	RenderStyle Add
	Alpha 0.0
//	+RIPPER
	+BLOODLESSIMPACT
	+FORCERADIUSDMG
	+HITTRACER
	DamageType "DeusExFlamed"
	Scale 0.25
	States
	{
		Spawn:
			TNT1 A 4
			DX03 A 0 A_SetScale(scaleX+0.125) DX03 A 2 BRIGHT A_FadeIn(0.125)
			DX03 B 0 A_SetScale(scaleX+0.125) DX03 B 2 BRIGHT A_FadeIn(0.125)
			DX03 CDEFGHABCDEFGH 2 BRIGHT
			Stop
		XDeath:
			TNT1 A 0 ACS_NamedExecuteWithResult("DeusExIgnite")
			TNT1 A 0 A_Explode(CallACS("DeusEx_WeaponSkillDamage", 5, 5),12,!XF_HURTSOURCE,0,12)
		Crash:
		Death:
			DX03 ABCDEFGH 2 BRIGHT A_FadeOut(0.03125)
			Stop
	}
}

Actor DeusEx_BurnEffect
{
	Height 4
	Radius 2
	Renderstyle Add
	+NOGRAVITY
	+NOINTERACTION
	States
	{
		Spawn:
			DX08 A 0
			DX08 A 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 A 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 B 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 B 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 C 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 C 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 D 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 D 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 E 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 E 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 F 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 F 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 G 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 G 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 H 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 H 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 I 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 I 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 J 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 J 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 K 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 K 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 L 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 L 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 M 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 M 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 N 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 N 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 O 0 A_PlaySound("DeusEx/Burn",CHAN_5,1.0,true)
		SpawnLoop:
			DX08 O 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 O 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 P 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 P 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 Q 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 Q 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 R 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 R 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 S 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 S 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 T 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 T 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 U 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 U 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			DX08 V 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 V 2 A_JumpIf(CallACS("DeusExIsMasterDead")==1,"Remove")
			Loop
		Remove:
			DX08 K 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 KK 1 A_Fadeout(0.05)
			DX08 L 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 LL 1 A_Fadeout(0.05)
			DX08 M 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 MM 1 A_Fadeout(0.05)
			DX08 N 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 NN 1 A_Fadeout(0.05)
			DX08 M 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 MM 1 A_Fadeout(0.05)
			DX08 L 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 LL 1 A_Fadeout(0.05)
			DX08 K 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 KK 1 A_Fadeout(0.05)
			DX08 L 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 LL 1 A_Fadeout(0.05)
			DX08 M 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 MM 1 A_Fadeout(0.05)
			DX08 N 0 A_SpawnItemEx("DeusEx_FlameSmokeCreator",0,0,0,frandom(-1.0,-0.25),0,frandom(0.25,1.0)) DX08 NN 1 A_Fadeout(0.05)
			DX08 N 0 A_StopSound(CHAN_5)
			Stop
	}
}

Actor DeusEx_FlameSmokeCreator
{
	Height 4
	Radius 2
	Renderstyle Add
	+NOGRAVITY
	+NOINTERACTION
	States
	{
		Spawn:
			DX09 A 0
			DX09 A 0 A_SpawnItemEx("DeusEx_Smoke",0,0,0,frandom(-1.0,1.0),0,frandom(1.0,3.0)) 
			DX09 ABCDEFGH 2 Bright A_Fadeout(0.125)
			Stop
	}
}

Actor DeusEx_FireBallCoop : DeusEx_FireBall { Species "Player" +THRUSPECIES }

Actor DeusEx_FireBallDM : DeusEx_FireBall { PoisonDamage 0, 0, 0 }