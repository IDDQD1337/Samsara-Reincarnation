Actor DeusEx_CombatKnife : DeusExWeapon
{
	Weapon.SelectionOrder 2000
	Weapon.SlotNumber 0
	Weapon.SlotPriority 1
	+WEAPON.MELEEWEAPON
	+WEAPON.WIMPY_WEAPON
//	+WEAPON.NOAUTOFIRE
	Tag "Combat Knife"
	Weapon.UpSound "DeusEx/Knife/Select"
	Inventory.PickupMessage "You found a Combat Knife."
	Obituary "%o was shanked with %o's Combat Knife."
	States
	{
		Spawn:
			DX99 A -1
			Stop
		Select:
			TNT1 AAAAAAAAAAAAAAAAAAAA 0 A_Raise
			TNT1 A 1 A_Raise
			loop
		Ready:
			DX00 B 0 A_GiveInventory("DeusEx_KnifeEquipped", 1)
			DX00 BCD 5
			DX00 A 0 A_TakeInventory("DeusEx_Reloading", 1)
		ReadyLoop:
			DX00 A 1 A_WeaponReady 	DX00 A 0 A_Jump(4,"Idle1","Idle2","Idle3")
			Loop
		Idle1:
			DX01 IJKL 5 A_WeaponReady
			Goto ReadyLoop
		Idle2:
			DX01 MNOPQRST 5 A_WeaponReady
			Goto ReadyLoop
		Idle3:
			DX01 UVWX 5 A_WeaponReady
			Goto ReadyLoop
		Fire:
			DX00 A 0 A_Jump(256, "Attack1", "Attack2", "Attack3")
			Goto Attack1
		Attack1:
			DX00 E 0 A_GiveInventory("DeusEx_Firing",1)
			DX00 E 0 A_PlaySound("DeusEx/Knife/Fire", CHAN_WEAPON)
			DX00 E 0 A_JumpIfInventory("DeusEx_LowTechSkill", 4, "Attack1_Master")
			DX00 E 0 A_JumpIfInventory("DeusEx_LowTechSkill", 3, "Attack1_Adv")
			DX00 E 0 A_JumpIfInventory("DeusEx_LowTechSkill", 2, "Attack1_Pro")
			DX00 E 0 A_JumpIfInventory("DeusEx_LowTechSkill", 1, "Attack1_Trained")
			DX00 EFGHI 3
			DX00 J 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 JKL 3
			Goto AttackResolve
		Attack1_Trained:
			DX00 EF 3
			DX00 G 2
			DX00 HI 3
			DX00 J 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 J 3
			DX00 K 2
			DX00 L 3
			Goto AttackResolve
		Attack1_Pro:
			DX00 E 3
			DX00 FG 2
			DX00 HI 3
			DX00 J 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 J 3
			DX00 KL 2
			Goto AttackResolve
		Attack1_Adv:
			DX00 EFG 2
			DX00 HI 3
			DX00 J 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 JKL 2
			Goto AttackResolve
		Attack1_Master:
			DX00 EFGHI 2
			DX00 J 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 JKL 2
			Goto AttackResolve
		Attack2:
			DX00 M 0 A_PlaySound("DeusEx/Knife/Fire", CHAN_WEAPON)
			DX00 M 0 A_JumpIfInventory("DeusEx_LowTechSkill", 4, "Attack2_Master")
			DX00 M 0 A_JumpIfInventory("DeusEx_LowTechSkill", 3, "Attack2_Adv")
			DX00 M 0 A_JumpIfInventory("DeusEx_LowTechSkill", 2, "Attack2_Pro")
			DX00 M 0 A_JumpIfInventory("DeusEx_LowTechSkill", 1, "Attack2_Trained")
			DX00 MNOPQRS 3
			DX00 U 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 UVWX 3
			Goto AttackResolve
		Attack2_Trained:
			DX00 MNO 3
			DX00 P 2
			DX00 QRS 3
			DX00 U 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 UV 3
			DX00 W 2
			DX00 X 3
			Goto AttackResolve
		Attack2_Pro:
			DX00 MN 3
			DX00 OPQ 2
			DX00 RS 3
			DX00 U 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 U 3
			DX00 VW 2
			DX00 X 3
			Goto AttackResolve
		Attack2_Adv:
			DX00 NOPQ 2
			DX00 RS 3
			DX00 U 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 UVW 2
			DX00 X 3
			Goto AttackResolve
		Attack2_Master:
			DX00 NOPQRS 2
			DX00 U 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX00 UVWX 2
			Goto AttackResolve
		Attack3:
			DX00 Y 0 A_PlaySound("DeusEx/Knife/Fire", CHAN_WEAPON)
			DX00 U 0 A_JumpIfInventory("DeusEx_LowTechSkill", 4, "Attack3_Master")
			DX00 U 0 A_JumpIfInventory("DeusEx_LowTechSkill", 3, "Attack3_Adv")
			DX00 U 0 A_JumpIfInventory("DeusEx_LowTechSkill", 2, "Attack3_Pro")
			DX00 U 0 A_JumpIfInventory("DeusEx_LowTechSkill", 1, "Attack3_Trained")
			DX00 "YZ[\]" 3
			DX01 A 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX01 ABC 3
			Goto AttackResolve
		Attack3_Trained:
			DX00 Y 3
			DX00 Z 2
			DX00 "[\]" 3
			DX01 A 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX01 A 3
			DX01 B 2
			DX01 C 3
			Goto AttackResolve
		Attack3_Pro:
			DX00 YZ 2
			DX00 "[\]" 3
			DX01 A 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX01 A 3
			DX01 BC 2
			Goto AttackResolve
		Attack3_Adv:
			DX00 "YZ[" 2
			DX00 "\]" 3
			DX01 A 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX01 ABC 2
			Goto AttackResolve
		Attack3_Master:
			DX00 "YZ[\]" 2
			DX01 A 0 A_GiveInventory("SamsaraDeusExKnifeAttackHandler")
			DX01 ABC 2
			Goto AttackResolve
		AttackResolve:
			DX00 A 0
			Goto ReadyLoop
		Deselect:
			DX01 D 0 A_TakeInventory("DeusEx_KnifeEquipped", 1)
			DX01 D 0 A_GiveInventory("DeusEx_Reloading", 1)
			DX01 DEFGH 2
			Goto InstantDeselect
		InstantDeselect:
			TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
			TNT1 A 1 A_Lower
			Wait
	}
}

Actor DeusEx_KnifeMissile : DeusExBullet
{
	Damage(CallACS("DeusEx_WeaponSkillDamage", 2, 10))
	Speed 32
	Decal none
	DamageType "DeusExMelee"
	States
	{
		Spawn:
			TNT1 A 0 NODELAY
			TNT1 A 1 
			Stop
		Crash:
			TNT1 A 0 A_PlaySound("DeusEx/Knife/HitSoft", CHAN_BODY)
			TNT1 A 1 A_Explode(CallACS("DeusEx_BackDamage",CallACS("DeusEx_WeaponSkillDamage", 2, 10)),8,!XF_HURTSOURCE,0,8)
			Stop
		Death:
			TNT1 A 1 A_PlaySound("DeusEx/Knife/HitHard", CHAN_BODY)
			Stop
		XDeath:
			TNT1 A 0 A_PlaySound("DeusEx/Knife/HitFlesh", CHAN_BODY)
			TNT1 A 0 A_Explode(CallACS("DeusEx_BackDamage",CallACS("DeusEx_WeaponSkillDamage", 2, 10)),8,!XF_HURTSOURCE,0,8)
			TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_BloodGenerator_Offsets")
			TNT1 A 1 A_GiveInventory("DeusEx_BloodGenerator",1,AAPTR_TRACER)
			stop
	}
}

Actor DeusEx_KnifeMissileCoop : DeusEx_KnifeMissile { Species "Player" +THRUSPECIES }

Actor SamsaraDeusExKnifeAttackHandler : Trigger
{
	States
	{
		Pickup:
			TNT1 A 0
			TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCoop")
			TNT1 A 0 A_FireCustomMissile("DeusEx_KnifeMissile", 0, 0, 0)
			Stop
		PickupAttackCoop:
			TNT1 A 0 A_FireCustomMissile("DeusEx_KnifeMissileCoop", 0, 0, 0)
			Stop
	}
}
