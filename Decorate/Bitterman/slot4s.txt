Actor Q2ETFRifle : Q2Weapon
{
	Tag "ETF Rifle"
	Inventory.PickupMessage "ETF Rifle"
	Weapon.AmmoGive 50
	Weapon.AmmoType Q2Flechettes
	Weapon.AmmoUse 1
	Weapon.SlotNumber 4
    Weapon.SlotPriority 1
	Weapon.SelectionOrder 500
	Inventory.RestrictedTo "Bitterman"		
	States
	{
	Spawn:
		Q2WP A -1
		Stop
	Select:
		TNT1 A 0 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory(Q2WeaponIndex)
		TNT1 A 0 A_GiveInventory(Q2WeaponIndex,10)
		ETF0 ABCDE 4
		Goto Ready+1
	Deselect:
//		ETF0 U 2
		ETF1 IJKL 3
		Goto InstantDeselect
	InstantDeselect:
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
		TNT1 A 1 A_Lower
		Wait
	Ready:
		TNT1 A 0 A_Jump(24,2)
		ETF0 H 1 A_WeaponReady
		Loop
		ETF0 "HIJKLMNOPQRSTUVWXYZ[\]" 5 A_WeaponReady
		ETF1 ABCDEFGH 5 A_WeaponReady
		Goto Ready+1
	Fire:
		ETF0 F 0 A_JumpIfInventory("CoopModeOn", 1, "CoopFire")
		ETF0 F 0 A_JumpIfInventory(PowerSilencer,1,"SilentFire")
		ETF0 F 0 A_AlertMonsters
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_AlertMonsters
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	SilentFire:
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	CoopFire:
		ETF0 F 0 A_JumpIfInventory(PowerSilencer,1,"SilentCoopFire")
		ETF0 F 0 A_AlertMonsters
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 F 0 A_Jump(256,2)
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfInventory(PowerSilencer,1,4)
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_AlertMonsters
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON)
		ETF0 G 0 A_Jump(256,2)
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	SilentCoopFire:
		ETF0 F 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 F 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,8,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 F 0 A_GunFlash
		ETF0 F 0 A_JumpIf(CallACS("Q2ETFRifleShake",1), 1)
		ETF0 F 1
		ETF0 G 2
		ETF0 G 0 A_JumpIfNoAmmo("Ready")
		ETF0 G 0 A_PlaySound("Q2Weapons/ETFFire",CHAN_WEAPON,0.25,0,3)
		ETF0 G 0 A_FireCustomMissile(Q2ETFFlechette_Coop,0,1,4,4)
		TNT1 A 0 A_FireCustomMissile(Q2WeaponFlash,0,0)
		ETF0 G 0 A_GunFlash
		ETF0 G 0 A_JumpIf(CallACS("Q2ETFRifleShake",2), 1)
		ETF0 G 1
		ETF0 F 2
		Goto Ready
	Flash:
		TNT1 A 1 A_Light2
		Goto LightDone
	}
}
Actor Q2ETFFlechette : FastProjectile
{
	Radius 3
	Height 6
	Speed 32
	Damage (14)
	MissileHeight 8
	DeathSound "Q2Weapons/LaserHit"
	DamageType "BittermanDamage"
	+BLOODSPLATTER
	+HITTRACER
	Decal BlasterScorch
	Scale 0.5
	States
	{
	Spawn:
		NULL A 1 Bright  A_PlaySound("Q2Weapons/LaserFly",CHAN_VOICE,0.5,1)
		Loop
	Death:
		TNT1 A 0 A_SpawnItem(FlechetteProjectileImpact)
		TNT1 A 3
		TNT1 A 3 
		TNT1 A 3 
		TNT1 A 3 
		Stop
	XDeath:
		TNT1 A 0 A_JumpIf(CallACS("Q2FlechetteShieldPierce"),"DeathPierceShield")
		TNT1 A 5
		Stop
	DeathPierceShield:
		TNT1 A 0 A_CustomMissile("Q2ETFFlechettePierce",0,0,0,CMF_AIMDIRECTION,pitch)
		TNT1 A 5
		stop
	}
}
Actor Q2ETFFlechettePierce : Q2ETFFlechette
{
	+THRUSPECIES
	DamageType "BittermanDamage"
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_JumpIf(CallACS("Q2FlechetteRetrieveSpecies"),1)
			TNT1 A 0 A_TransferPointer(AAPTR_Target,AAPTR_Default,AAPTR_Target,AAPTR_Target)
			NULL A 1 Bright  A_PlaySound("Q2Weapons/LaserFly",CHAN_VOICE,0.5,1)
			Loop
	}
}
Actor Q2ETFFlechette_Coop : Q2ETFFlechette	{ Species "Player" +THRUSPECIES }
Actor FlechetteProjectileImpact : Q2BulletPuff
{
	DamageType "BittermanDamage"
	States
	{
	Spawn:
		TNT1 AAAAAAAAAAAAA 0 A_SpawnItemEx(FlechetteParticle,FRandom(0,12),0,FRandom(-8,15),FRandom(0,0.5),0,FRandom(-1,-0.1),Random(1,360))
		Stop
	}
}
Actor FlechetteParticle : Q2BulletPuffParticle 
{ 
	//Translation "80:111=192:196" 
	States
	{
	Spawn:
		P007 ABCDEFGH 0 A_Jump(64,"Fade")
		Loop
	Fade:
		"----" A 5
		"----" A 1 A_FadeOut
		Wait
	}
}