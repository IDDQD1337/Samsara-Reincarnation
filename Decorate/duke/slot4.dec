actor DukeRipperFiringSequence : Counter { Inventory.MaxAmount 2 }

actor "Chaingun Cannon" : DukeWeapon
{
	Weapon.SlotNumber 4
	Weapon.SelectionOrder 700
	Weapon.AmmoUse 1
	Weapon.AmmoGive 50
	Weapon.AmmoType "Clip"
	Obituary "$SAMSARA_DUKE_OB_SLOT4"
	Inventory.Pickupmessage "You got the Ripper Chaingun Cannon!"
	Inventory.PickupSound "duke/weaponget"
	weapon.upsound ""
//  scale 0.7
	+NOALERT
	+INVENTORY.UNDROPPABLE
	Tag "Chaingun Cannon"
	States
	{
	  Spawn:
		CHGP A -1
		Stop

	  Ready:
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"ReadyA")
		TNT1 A 0 A_JumpIfInventory("DukeReady",1,"IntroTaunt")
		TNT1 A 0 A_JumpIfInventory("DukeWaiting",15,"WaitingTaunt")
		TNT1 A 0 A_JumpIfInventory("DukeGiveMoney",1,"GiveMoney")
		TNT1 A 0 A_JumpIfInventory("DukeStomp", 1, "Stomp")
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, 4)
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, 2)
		DKCH A 1 A_WeaponReady
		Loop
		DKCH J 1 A_WeaponReady
		Loop
		D6M5 A 1 A_WeaponReady
		Loop

	  Deselect:
		TNT1 A 0 A_GiveInventory("BlankFlash",1)
		TNT1 A 0 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_TakeInventory("BlankFlash",1)
		DKCH A 0 A_JumpIfInventory("DukeClassMode", 2, "Deselect64")
		DKCH A 0 A_JumpIfInventory("DukeLABToken", 1, "DeselectLAB")
		Goto Super::Deselect
	  Deselect64:
		D6M5 A 0
		Goto Super::Deselect
	  DeselectLAB:
		DKCH J 0
		Goto Super::Deselect

	  Select:
		TNT1 A 0 A_JumpIfInventory("DukeReady",1,"IntroTaunt1")
		TNT1 A 0 A_GiveInventory("BlankFlash",1)
		TNT1 A 0 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_TakeInventory("BlankFlash",1)
		DKCH A 0 A_JumpIfInventory("DukeClassMode", 2, "Select64")
		DKCH A 0 A_PlayWeaponSound("duke/weaponget")
		DKCH A 0 A_JumpIfInventory("DukeLABToken", 1, "SelectLAB")
		Goto Super::Select
	  Select64:
		TNT1 A 0 A_PlayWeaponSound("duke64/wepselect")
		D6M5 A 0
		Goto Super::Select
	  SelectLAB:
		DKCH J 0
		Goto Super::Select
	  
	  Fire:
		TNT1 A 0 A_JumpIfInventory("DukeStomp", 1, "Stomp")
		TNT1 A 0 A_GiveInventory("DBSHOT",60)
		TNT1 A 0 A_GunFlash
		Goto ReadyA
		
	  Flash:
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"FlashB")
		TNT1 A 0 A_JumpIfInventory("BlankFlash",1,"FlashBlank")
		DKCH A 6 A_JumpIfInventory("DukeLABToken", 1, 1)
		stop
		DKCH J 6
		stop
	  FlashBlank:
		TNT1 A 1
		stop
	  FlashB:
		TNT1 A 0 A_JumpIfInventory("DukeRipperFiringSequence",2,"FireRight")
		TNT1 A 0 A_JumpIfInventory("DukeRipperFiringSequence",1,"FireLeft")
		Goto FireMiddle
	  FireLeft:
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_Light1
		TNT1 A 0 A_TakeInventory("Clip",1,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, "FireLeftLAB")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuff", FBF_NORANDOM)
		Goto FireLeftEnd
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffCoop", FBF_NORANDOM)
		Goto FireLeftEnd
	  FireLeftEnd:
		TNT1 A 0 A_TakeInventory("DukeWaiting",15)
		TNT1 A 0 A_PlayWeaponSound("duke/chaingun")
		TNT1 A 0 A_FireCustomMissile("ShellCasingSpawner3",0,0,6)
		TNT1 A 0 A_GiveInventory("DukeRipperFiringSequence",1)
		DKCH H 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKCH BC 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKCH D 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKCH A 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop
	  FireLeftLAB:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffBeach", FBF_NORANDOM)
		Goto FireLeftLABEnd
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffBeachCoop", FBF_NORANDOM)
		Goto FireLeftLABEnd
	  FireLeftLABEnd:
		TNT1 A 0 A_TakeInventory("DukeWaiting",15)
		TNT1 A 0 A_PlayWeaponSound("duke/chaingun2")
		TNT1 A 0 A_GiveInventory("DukeRipperFiringSequence",1)
		DKCH L 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKCH LM 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKCH U 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKCH T 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		stop
	  FireMiddle:
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_Light1
		TNT1 A 0 A_TakeInventory("Clip",1,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, "FireMiddleLAB")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuff", FBF_NORANDOM)
		Goto FireMiddleEnd
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffCoop", FBF_NORANDOM)
		Goto FireMiddleEnd
	  FireMiddleEnd:
		TNT1 A 0 A_TakeInventory("DukeWaiting",15)
		TNT1 A 0 A_PlayWeaponSound("duke/chaingun")
		TNT1 A 0 A_FireCustomMissile("ShellCasingSpawner3",0,0,6)
		TNT1 A 0 A_GiveInventory("DukeRipperFiringSequence",1)
		DKCH I 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKCH EF 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKCH G 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKCH A 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop
	  FireMiddleLAB:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffBeach", FBF_NORANDOM)
		Goto FireMiddleLABEnd
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffBeachCoop", FBF_NORANDOM)
		Goto FireMiddleLABEnd
	  FireMiddleLABEnd:
		TNT1 A 0 A_TakeInventory("DukeWaiting",15)
		TNT1 A 0 A_PlayWeaponSound("duke/chaingun2")
		TNT1 A 0 A_GiveInventory("DukeRipperFiringSequence",1)
		DKCH N 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKCH NO 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKCH P 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKCH T 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		stop
	  FireRight:
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_Light1
		TNT1 A 0 A_TakeInventory("Clip",1,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, "FireRightLAB")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuff", FBF_NORANDOM)
		Goto FireRightEnd
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffCoop", FBF_NORANDOM)
		Goto FireRightEnd
	  FireRightEnd:
		TNT1 A 0 A_TakeInventory("DukeWaiting",15)
		TNT1 A 0 A_PlayWeaponSound("duke/chaingun")
		TNT1 A 0 A_FireCustomMissile("ShellCasingSpawner3",0,0,6)
		TNT1 A 0 A_TakeInventory("DukeRipperFiringSequence",9)
		DKCH H 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKCH BC 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKCH D 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKCH A 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop
	  FireRightLAB:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,2)
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffBeach", FBF_NORANDOM)
		Goto FireRightLABEnd
		TNT1 A 0 A_FireBullets(5.5,2.5,-1,15,"DukeBulletPuffBeachCoop", FBF_NORANDOM)
		Goto FireRightLABEnd
	  FireRightLABEnd:
		TNT1 A 0 A_TakeInventory("DukeWaiting",15)
		TNT1 A 0 A_PlayWeaponSound("duke/chaingun2")
		TNT1 A 0 A_TakeInventory("DukeRipperFiringSequence",9)
		DKCH Q 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKCH QR 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKCH S 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKCH T 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop

	  AltFire:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "NoAltFireForDuke64")
		Goto Super::Altfire

	  AltFlash:
		DKCH A 8 A_JumpIfInventory("DukeLABToken", 1, 1)
		stop
		DKCH J 8
		stop
		
	  NoAltFireForDuke64:
		TNT1 A 0
		goto Ready

	  TauntWeaponSound:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "TauntWeaponSound64")
		TNT1 A 0 A_PlayWeaponSound("duke/weaponget")
		Goto Select
		
	  TauntWeaponSound64:
		TNT1 A 0 A_PlayWeaponSound("duke64/wepselect")
		Goto Select

	  IntroTaunt:
		DKCH A 0 A_JumpIfInventory("DukeClassMode", 2, "IntroTaunt64")
		DKCH A 0 A_JumpIfInventory("DukeLABToken", 1, "IntroTauntLAB")
		Goto Super::IntroTaunt
	  IntroTaunt64:
		D6M5 A 0
		Goto Super::IntroTaunt
	  IntroTauntLAB:
		DKCH J 0
		Goto Super::IntroTaunt

	  WaitingTaunt:
		DKCH A 0 A_JumpIfInventory("DukeClassMode", 2, "WaitingTaunt64")
		DKCH A 0 A_JumpIfInventory("DukeLABToken", 1, "WaitingTauntLAB")
		Goto Super::WaitingTaunt
	  WaitingTaunt64:
		D6M5 A 0
		Goto Super::WaitingTaunt
	  WaitingTauntLAB:
		DKCH J 0
		Goto Super::WaitingTaunt

	  GiveMoney:
		DKCH A 0 A_JumpIfInventory("DukeClassMode", 2, "GiveMoney64")
		DKCH A 0 A_JumpIfInventory("DukeLABToken", 1, "GiveMoneyLAB")
		Goto Super::GiveMoney
	  GiveMoney64:
		D6M5 A 0
		Goto Super::GiveMoney
	  GiveMoneyLAB:
		DKCH J 0
		Goto Super::GiveMoney
	}
}

actor DukeRipperBullet : DukePistolBullet
{
	+THRUGHOST
	+NOTIMEFREEZE
	Obituary "$SAMSARA_DUKE_OB_SLOT4"
	Damage (15)// Original was (9)
	DamageType "DukeDamage"
}

actor DukeRipperBulletCoop : DukePistolBullet
{
	Obituary "$SAMSARA_DUKE_OB_SLOT4"
	Damage (15)
	+THRUGHOST
	+THRUSPECIES
	+NOTIMEFREEZE
	Species "Player"
	DamageType "DukeDamage"
}

actor DukeRipperBulletBeach : DukePistolBulletBeach
{
	+THRUGHOST
	+NOTIMEFREEZE
	Obituary "$SAMSARA_DUKE_OB_SLOT4"
	Damage (15)// Original was (9)
	DamageType "DukeDamage"
}

actor DukeRipperBulletBeachCoop : DukePistolBulletBeach
{
	Obituary "$SAMSARA_DUKE_OB_SLOT4"
	Damage (15)
	+THRUGHOST
	+THRUSPECIES
	+NOTIMEFREEZE
	Species "Player"
	DamageType "DukeDamage"
}

actor ShellCasingSpawner3 : FastProjectile
{
	Radius 6
	Height 6
	Projectile
	Damage 0
	Speed 5
	SeeSound "none"
	DeathSound "none"
	Decal "none"
	+CLIENTSIDEONLY
	States
	{
	  Spawn:
		TNT1 A 1
		TNT1 A 1 A_SpawnItemEx("DukeCasing1",0,-3,4,random(1,3),0,random(1,2),random(-85,-90),0)
		Stop
	}
}

ACTOR FireFrameCounter : Inventory { Inventory.MaxAmount 3 }

actor ShellCasingSpawnerR : ShellCasingSpawner
{
    States
    {
      Spawn:
        TNT1 A 1
        TNT1 A 1 A_SpawnItemEx("DukeCasing1",0,3,4,random(-1,-2),0,random(2,3),random(85,90),0)
        Stop
    }
}

actor ShellCasingSpawnerL : ShellCasingSpawnerR
{
    States
    {
      Spawn:
        TNT1 A 1
        TNT1 A 1 A_SpawnItemEx("DukeCasing1",0,3,4,random(1,2),0,random(2,3),random(85,90),0)
        Stop
    }
}