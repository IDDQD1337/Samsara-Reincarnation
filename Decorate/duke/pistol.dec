actor PistolFire : Boolean {}
actor PistolReload : Boolean {}
actor BlankFlash : Boolean {}
actor Duke64UsingDumDums : Boolean { }

actor "Glock 17" : DukeWeapon
{
	Weapon.SlotNumber 1
	Weapon.SelectionOrder 1900
	Weapon.AmmoType "DukePistolReload"
	Weapon.AmmoUse 1
	Obituary "$SAMSARA_DUKE_OB_PISTOL"
	DamageType "DukePistol"
	+WEAPON.WIMPY_WEAPON
	+WEAPON.AMMO_OPTIONAL
	+NOALERT
	+INVENTORY.UNDROPPABLE
	Inventory.Pickupmessage "You got the M1911 Pistol!"
	Inventory.PickupSound "duke/weaponget"
	Weapon.UpSound ""
	Tag "Glock 17"
	States
	{
	  ReadyB:
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireA1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireA2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireA3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireA4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireA5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireA6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireA7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireA8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireA9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireA10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireA11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireA12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireA13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireA14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireA15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireA16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireA17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireA18")
		TNT1 A 0 A_JumpIfInventory("DukeReady",1,"IntroTaunt")
		TNT1 A 0 A_JumpIfInventory("DukeWaiting",15,"WaitingTaunt")
		TNT1 A 1 A_WeaponReady(WRF_NOPRIMARY|WRF_NOSWITCH|WRF_NOBOB)
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"ReadyB")
		Goto Ready
	  Ready:
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"ReadyA")
		TNT1 A 0 A_JumpIfInventory("DukeReady",1,"IntroTaunt")
		TNT1 A 0 A_JumpIfInventory("DukeWaiting",15,"WaitingTaunt")
		TNT1 A 0 A_JumpIfInventory("DukeGiveMoney",1,"GiveMoney")
		TNT1 A 0 A_JumpIfInventory("DukeStomp", 1, "Stomp")
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",0,"ReadyModernReloadable")
	  ReadyNonReloadable:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "ReadyNonReloadable64")
		TNT1 A 0 A_JumpIfInventory("DukeLABToken",1,"ReadyNonReloadableLAB")
		DKPS A 1 A_WeaponReady
	  ReadyAmmoCheck:
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"ReadyAmmoCheckReloadable")
		goto Ready

	  ReadyNonReloadable64:
		D6PS A 1 A_WeaponReady
		goto ReadyAmmoCheck
	  ReadyNonReloadableLAB:
		DKPS J 1 A_WeaponReady
		goto ReadyAmmoCheck

	  ReadyModernReloadable:
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",0,"ReadyNonReloadable")
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"ReadyModernReloadableReserve")
	  ReadyModernReloadableCanReload:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "ReadyModernReloadableCanReload64")
		TNT1 A 0 A_JumpIfInventory("DukeLABToken",1,"ReadyModernReloadableCanReloadLAB")
		DKPS A 1 A_WeaponReady(WRF_ALLOWRELOAD)
		goto ReadyAmmoCheck

	  ReadyModernReloadableCanReload64:
		D6PS A 1 A_WeaponReady(WRF_ALLOWRELOAD)
		goto ReadyAmmoCheck
	  ReadyModernReloadableCanReloadLAB:
		DKPS J 1 A_WeaponReady(WRF_ALLOWRELOAD)
		goto ReadyAmmoCheck

	  ReadyModernReloadableReserve:
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,2)
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"ReadyModernReloadableCanReload")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"ReadyModernReloadableCanReload")
		goto ReadyNonReloadable

	  ReadyAmmoCheckReloadable:
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,"Ready")
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",1,"Ready")
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,1)
		goto Reload
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"Reload")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"Reload")
		goto Ready

	  Deselect:
		TNT1 A 0 A_TakeInventory("PistolReload",1)
		TNT1 A 0 A_GiveInventory("BlankFlash",1)
		TNT1 A 0 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_TakeInventory("BlankFlash",1)
		DKPS A 0 A_JumpIfInventory("DukeClassMode", 2, "Deselect64")
		DKPS A 0 A_JumpIfInventory("DukeLABToken", 1, "DeselectLAB")
		Goto Super::Deselect
	  Deselect64:
		D6PS A 0
		Goto Super::Deselect
	  DeselectLAB:
		DKPS J 0
		Goto Super::Deselect

	  Select:
		TNT1 A 0 A_TakeInventory("PistolReload",1)
		TNT1 A 0 A_GiveInventory("BlankFlash",1)
		TNT1 A 0 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_TakeInventory("BlankFlash",1)
		TNT1 A 0 A_JumpIfInventory("DukeReady",1,"IntroTaunt1")
		DKPS A 0 A_JumpIfInventory("DukeClassMode", 2, "Select64")
		DKPS A 0 A_PlayWeaponSound("duke/m1911up")
		DKPS A 0 A_JumpIfInventory("DukeLABToken", 1, "SelectLAB")
		Goto Super::Select
	  Select64:
		TNT1 A 0 A_PlayWeaponSound("duke64/brhipup")
		D6PS A 0
		Goto Super::Select
	  SelectLAB:
		DKPS J 0
		Goto Super::Select

	  Fire:
		TNT1 A 0 A_JumpIfInventory("DukeStomp", 1, "Stomp")
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"FireReloadable")
	  FireNonReloadable:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,1)
		goto FireSecond
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FireSecond")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"FireSecond")
		goto Nothing

	  FireReloadable:
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,"FireSecond")
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",1,"FireSecond")
	  FireReloadableDryCheck:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,1)
		goto Reload
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"Reload")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"Reload")
		goto Nothing

	  FireSecond:
		DKPS A 0 A_JumpIfInventory("DukeClassMode", 2, "FireSecond64")
		TNT1 A 0 A_GiveInventory("DBSHOT",20)
		TNT1 A 0 A_GunFlash
		Goto ReadyA
		
	  FireSecond64:
		TNT1 A 0 A_GiveInventory("DBSHOT",20)
		TNT1 A 0 A_GunFlash
		TNT1 A 0 A_Jump(256,"FlashFire64_1","FlashFire64_2","FlashFire64_3","FlashFire64_4")
	  FlashFire64_1:
		D6YF A 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH) //A_GunFlash
		Goto FlashFire64Mid
	  FlashFire64_2:
		D6YF B 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH) //A_GunFlash
		Goto FlashFire64Mid
	  FlashFire64_3:
		D6YF C 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH) //A_GunFlash
		Goto FlashFire64Mid
	  FlashFire64_4:
		D6YF D 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH) //A_GunFlash
	  FlashFire64Mid:
		TNT1 A 0 A_GiveInventory("SamsaraDukePistol64AttackHandler")
		TNT1 A 0 ACS_NamedExecuteAlways("SamsaraRecoil", 0, 1, 1, 2)
		TNT1 A 0 A_Jump(256,"FlashFire64Mid_1","FlashFire64Mid_2","FlashFire64Mid_3","FlashFire64Mid_4")
	  FlashFire64Mid_1:
		D6Y2 A 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Goto FlashFire64End
	  FlashFire64Mid_2:
		D6Y2 B 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Goto FlashFire64End
	  FlashFire64Mid_3:
		D6Y2 C 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Goto FlashFire64End
	  FlashFire64Mid_4:
		D6Y2 D 1 Bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	  FlashFire64End:
		D6PS A 3 A_FireCustomMissile("ShellCasingSpawner",0,0,5)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		Goto ReadyA

	  Reload:
		TNT1 A 0 A_GiveInventory("PistolReload",1)
		TNT1 A 0 A_GiveInventory("DBSHOT",30)
		TNT1 A 0 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireB1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireB2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireB3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireB4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireB5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireB6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireB7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireB8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireB9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireB10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireB11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireB12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireB13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireB14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireB15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireB16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireB17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireB18")
		Goto ReadyB

	  Flash:
		TNT1 A 0 A_JumpIfInventory("PistolReload",1,"FlashReload")
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"FlashFire")
		TNT1 A 0 A_JumpIfInventory("BlankFlash",1,"FlashBlank")
		DKPS A 8 A_JumpIfInventory("DukeLABToken", 1, 1)
		stop
		DKPS J 8
		stop
	  FlashBlank:
		TNT1 A 1
		stop
	  FlashFire:
		TNT1 A 0 A_TakeInventory("DukeWaiting",15)
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,"FlashFire64")
		TNT1 A 0 A_JumpIfInventory("DukeLABToken",1,"FlashFireLAB")
		DKPS A 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	  FlashFireCasingSpawnerCheck:
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"FlashFireCasingSpawnerReloadable")
	  FlashFireCasingSpawnerNonReloadable:
        TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,1)
        goto FlashFireCasingSpawner
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FlashFireCasingSpawner")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"FlashFireCasingSpawner")
	  FlashFireAttack:
		TNT1 A 0 A_GiveInventory("SamsaraDukePistolAttackHandler")
		TNT1 A 0 A_Light1
		DKPS B 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKPS C 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKPS A 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKPS A 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop

	  FlashFireCasingSpawnerReloadable:
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,"FlashFireCasingSpawner")
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",1,"FlashFireCasingSpawner")
		goto FlashFireAttack

	  FlashFireCasingSpawner:
		TNT1 A 0 A_FireCustomMissile("ShellCasingSpawner",0,false,5)
		goto FlashFireAttack

	  FlashFireLAB:
		DKPS J 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_GiveInventory("SamsaraDukePistolLABAttackHandler")
		TNT1 A 0 A_Light1
		DKPS K 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DKPS L 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DKPS J 2 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DKPS J 3 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop
		
	  FlashFire64:
		D6PS B 1 Bright A_Light1
		D6PS Z 1 Bright A_Light1
		TNT1 A 0 A_Light0
		D6PS A 5 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop

	  FlashReload:
		TNT1 A 0 A_TakeInventory("PistolReload",9)
		DKPS D 3 A_JumpIfInventory("DukeClassMode",2,"FlashReload64")
		TNT1 A 0 A_PlayWeaponSound("duke/m1911reload")
		DKPS D 3 A_JumpIfInventory("DukeLABToken",1,"FlashReloadLAB")
		DKPS E 4
		DKPS F 6
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"ReloadAmmo")
	  FlashReloadFinish:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,"FlashReloadFinish64")
		TNT1 A 0 A_JumpIfInventory("DukeLABToken",1,"FlashReloadFinishLAB")
		DKPS GH 3
		DKPS ID 2
		DKPS A 1
		DKPS A 4 A_TakeInventory("DBSHOT",99)
		Stop

	  FlashReloadLAB:
		DKPS M 3
		DKPS N 4
		DKPS O 6
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"ReloadAmmo")
		goto FlashReloadFinish
		
	  FlashReload64:
		D6PS C 6 A_PlaySound("duke64/brhipreload",5)
		D6PS DEFG 1
		D6PS H 2
		D6PS IJKLM 1
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"ReloadAmmo")
		goto FlashReloadFinish

	  FlashReloadFinishLAB:
		DKPS PQ 3
		DKPS RM 2
		DKPS J 1
		DKPS J 4 A_TakeInventory("DBSHOT",99)
		Stop
		
	  FlashReloadFinish64:
		D6PS N 4
		D6PS O 2
		D6PS P 3 A_TakeInventory("DBSHOT",99)
		Stop

	  ReloadAmmo:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,"ReloadAmmoReserve")
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",0,"FlashReloadFinish")
		TNT1 A 0 A_GiveInventory("DukePistolReload")
		loop

	  ReloadAmmoReserve:
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",0,"FlashReloadFinish")
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,2)
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,2)
		TNT1 A 0 A_JumpIfInventory("Clip",1,1)
		goto FlashReloadFinish
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,2)
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,2)
		TNT1 A 0 A_TakeInventory("Clip",1)
		TNT1 A 0 A_GiveInventory("DukePistolReload")
		goto ReloadAmmo

	  BlankReady:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode",2,"BlankReady64")
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, "BlankReadyLAB")
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireA1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireA2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireA3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireA4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireA5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireA6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireA7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireA8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireA9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireA10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireA11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireA12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireA13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireA14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireA15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireA16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireA17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireA18")
		DKPS A 1
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireA1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireA2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireA3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireA4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireA5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireA6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireA7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireA8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireA9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireA10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireA11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireA12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireA13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireA14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireA15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireA16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireA17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireA18")
		DKPS A 1
		DKPS A 0 A_WeaponReady
		goto Ready
	  BlankReadyLAB:
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireA1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireA2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireA3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireA4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireA5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireA6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireA7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireA8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireA9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireA10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireA11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireA12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireA13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireA14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireA15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireA16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireA17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireA18")
		DKPS J 1
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireA1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireA2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireA3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireA4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireA5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireA6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireA7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireA8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireA9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireA10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireA11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireA12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireA13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireA14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireA15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireA16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireA17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireA18")
		DKPS J 1
		DKPS J 0 A_WeaponReady
		goto Ready
	  BlankReady64:
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireA1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireA2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireA3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireA4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireA5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireA6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireA7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireA8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireA9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireA10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireA11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireA12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireA13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireA14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireA15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireA16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireA17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireA18")
		D6PS A 1
		TNT1 A 0 A_JumpIfInventory("DB1",1,"AltFireA1")
		TNT1 A 0 A_JumpIfInventory("DB2",1,"AltFireA2")
		TNT1 A 0 A_JumpIfInventory("DB3",1,"AltFireA3")
		TNT1 A 0 A_JumpIfInventory("DB4",1,"AltFireA4")
		TNT1 A 0 A_JumpIfInventory("DB5",1,"AltFireA5")
		TNT1 A 0 A_JumpIfInventory("DB6",1,"AltFireA6")
		TNT1 A 0 A_JumpIfInventory("DB7",1,"AltFireA7")
		TNT1 A 0 A_JumpIfInventory("DB8",1,"AltFireA8")
		TNT1 A 0 A_JumpIfInventory("DB9",1,"AltFireA9")
		TNT1 A 0 A_JumpIfInventory("DB10",1,"AltFireA10")
		TNT1 A 0 A_JumpIfInventory("DB11",1,"AltFireA11")
		TNT1 A 0 A_JumpIfInventory("DB12",1,"AltFireA12")
		TNT1 A 0 A_JumpIfInventory("DB13",1,"AltFireA13")
		TNT1 A 0 A_JumpIfInventory("DB14",1,"AltFireA14")
		TNT1 A 0 A_JumpIfInventory("DB15",1,"AltFireA15")
		TNT1 A 0 A_JumpIfInventory("DB16",1,"AltFireA16")
		TNT1 A 0 A_JumpIfInventory("DB17",1,"AltFireA17")
		TNT1 A 0 A_JumpIfInventory("DB18",1,"AltFireA18")
		D6PS A 1
		D6PS A 0 A_WeaponReady
		goto Ready

	  AltFire:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "NoAltFireForDuke64") // For now, disable alt ammo until it's implemented
		//TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "Duke64SwitchAmmo")
		Goto Super::AltFire

	  AltFlash:
		DKPS A 2 A_JumpIfInventory("DukeLABToken", 1, 1)
		stop
		DKPS J 2
		stop
		
	  NoAltFireForDuke64:
		TNT1 A 0
		goto Ready

	  Duke64SwitchAmmo:
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"Ready")
		TNT1 A 0 A_JumpIfInventory("Duke64UsingDumDums",1,"Duke64SwitchAmmo2")
		TNT1 A 0 A_GiveInventory("Duke64UsingDumDums",1)
		Goto Duke64SwitchAmmoAnim
	  Duke64SwitchAmmo2:
		TNT1 A 0 A_TakeInventory("Duke64UsingDumDums",1)
	  Duke64SwitchAmmoAnim:
		TNT1 A 0 A_PlayWeaponSound("duke64/wepselect")
		D6PS QRSTUVW 1
		TNT1 A 1
		D6PS WVUTSRQ 1
		goto Ready

	  TauntWeaponSound:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "TauntWeaponSound64")
		TNT1 A 0 A_PlayWeaponSound("duke/m1911up")
		Goto Select
		
	  TauntWeaponSound64:
		TNT1 A 0 A_PlayWeaponSound("duke64/brhipup")
		Goto Select

	  IntroTaunt:
		DKPS A 0 A_JumpIfInventory("DukeClassMode", 2, "IntroTaunt64")
		DKPS A 0 A_JumpIfInventory("DukeLABToken", 1, "IntroTauntLAB")
		Goto Super::IntroTaunt
	  IntroTaunt64:
		D6PS A 0
		Goto Super::IntroTaunt
	  IntroTauntLAB:
		DKPS J 0
		Goto Super::IntroTaunt

	  WaitingTaunt:
		DKPS A 0 A_JumpIfInventory("DukeClassMode", 2, "WaitingTaunt64")
		DKPS A 0 A_JumpIfInventory("DukeLABToken", 1, "WaitingTauntLAB")
		Goto Super::WaitingTaunt
	  WaitingTaunt64:
		D6PS A 0
		Goto Super::WaitingTaunt
	  WaitingTauntLAB:
		DKPS J 0
		Goto Super::WaitingTaunt
		
	  GiveMoney:
		DKPS A 0 A_JumpIfInventory("DukeClassMode", 2, "GiveMoney64")
		DKPS A 0 A_JumpIfInventory("DukeLABToken", 1, "GiveMoneyLAB")
		Goto Super::GiveMoney
	  GiveMoney64:
		D6PS A 0
		Goto Super::GiveMoney
	  GiveMoneyLAB:
		DKPS J 0
		Goto Super::GiveMoney

	  Nothing:
		TNT1 A 0 A_SelectWeapon("Mighty Boot")
		goto Deselect
	}
}

actor SamsaraDukePistolAttackHandler : Trigger
{
	States
	{
	  // Ammo check stuff
	  Pickup:
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"PickupCheckAmmoReloadable")
	  PickupCheckAmmoNonReloadable:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,1)
		goto PickupAttack
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupTakeAmmoNonReloadable")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"PickupTakeAmmoNonReloadable")
		stop

	  PickupCheckAmmoReloadable:
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,"PickupAttack")
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",1,"PickupTakeAmmoReloadable")
		stop

	  // Ammo taking stuff
	  PickupTakeAmmoNonReloadable:
		TNT1 A 0 A_TakeInventory("Clip",1,TIF_NOTAKEINFINITE)
		goto PickupAttack

	  PickupTakeAmmoReloadable:
		TNT1 A 0 A_TakeInventory("DukePistolReload",1)
		goto PickupAttack

	  // Attack stuff
	  PickupAttack:
		TNT1 A 0 A_PlaySound("duke/m1911",CHAN_WEAPON)
		TNT1 A 0 A_JumpIfTargetInLOS("PickupAttackAccurate")
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCoop")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCoop")
	  PickupAttackDM:
		TNT1 A 0 A_FireBullets(4,3,-1,7,"DukePistolPuff",FBF_NORANDOM|FBF_NOFLASH)
		stop

	  PickupAttackCoop:
		TNT1 A 0 A_FireBullets(4,3,-1,7,"DukePistolPuffCoop",FBF_NORANDOM|FBF_NOFLASH)
		stop

	  PickupAttackAccurate:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackAccurateCoop")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackAccurateCoop")
	  PickupAttackAccurateDM:
		TNT1 A 0 A_FireBullets(0,0,-1,7,"DukePistolPuff",FBF_NORANDOM|FBF_NOFLASH)
		stop

	  PickupAttackAccurateCoop:
		TNT1 A 0 A_FireBullets(0,0,-1,7,"DukePistolPuffCoop",FBF_NORANDOM|FBF_NOFLASH)
		stop
	}
}

actor SamsaraDukePistolLABAttackHandler : Trigger
{
	States
	{
	  // Ammo check stuff
	  Pickup:
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"PickupCheckAmmoReloadable")
	  PickupCheckAmmoNonReloadable:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,1)
		goto PickupAttack
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupTakeAmmoNonReloadable")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"PickupTakeAmmoNonReloadable")
		stop

	  PickupCheckAmmoReloadable:
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,"PickupAttack")
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",1,"PickupTakeAmmoReloadable")
		stop

	  // Ammo taking stuff
	  PickupTakeAmmoNonReloadable:
		TNT1 A 0 A_TakeInventory("Clip",1,TIF_NOTAKEINFINITE)
		goto PickupAttack

	  PickupTakeAmmoReloadable:
		TNT1 A 0 A_TakeInventory("DukePistolReload",1)
		goto PickupAttack

	  // Attack stuff
	  PickupAttack:
		TNT1 A 0 A_PlaySound("duke/m19112",CHAN_WEAPON)
		TNT1 A 0 A_JumpIfTargetInLOS("PickupAttackAccurate")
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCoop")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCoop")
	  PickupAttackDM:
		TNT1 A 0 A_FireBullets(4,3,-1,7,"DukePistolPuffBeach",FBF_NORANDOM|FBF_NOFLASH)
		stop

	  PickupAttackCoop:
		TNT1 A 0 A_FireBullets(4,3,-1,7,"DukePistolPuffBeachCoop",FBF_NORANDOM|FBF_NOFLASH)
		stop

	  PickupAttackAccurate:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackAccurateCoop")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackAccurateCoop")
	  PickupAttackAccurateDM:
		TNT1 A 0 A_FireBullets(0,0,-1,7,"DukePistolPuffBeach",FBF_NORANDOM|FBF_NOFLASH)
		stop

	  PickupAttackAccurateCoop:
		TNT1 A 0 A_FireBullets(0,0,-1,7,"DukePistolPuffBeachCoop",FBF_NORANDOM|FBF_NOFLASH)
		stop
	}
}

actor SamsaraDukePistol64AttackHandler : Trigger
{
	States
	{
	  // Ammo check stuff
	  Pickup:
		TNT1 A 0 A_JumpIfInventory("SamsaraReloadMode",1,"PickupCheckAmmoReloadable")
	  PickupCheckAmmoNonReloadable:
		TNT1 A 0 A_JumpIfInventory("PistolModeOn",1,1)
		goto PickupAttack
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupTakeAmmoNonReloadable")
		TNT1 A 0 A_JumpIfInventory("Clip",1,"PickupTakeAmmoNonReloadable")
		stop

	  PickupCheckAmmoReloadable:
		TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",0,"PickupAttack")
		TNT1 A 0 A_JumpIfInventory("DukePistolReload",1,"PickupTakeAmmoReloadable")
		stop

	  // Ammo taking stuff
	  PickupTakeAmmoNonReloadable:
		TNT1 A 0 A_TakeInventory("Clip",1,TIF_NOTAKEINFINITE)
		goto PickupAttack

	  PickupTakeAmmoReloadable:
		TNT1 A 0 A_TakeInventory("DukePistolReload",1)
		goto PickupAttack

	  // Attack stuff
	  PickupAttack:
		TNT1 A 0 A_PlayWeaponSound("duke64/brhip")
		TNT1 A 0 A_JumpIfInventory("Duke64UsingDumDums",1,"PickupAttackDumDum")
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCoop")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCoop")
	  PickupAttackDM:
		TNT1 A 0 A_FireBullets(4,3,-1,random(7,10),"Duke64PistolPuff", FBF_NORANDOM|FBF_NOFLASH)
		stop

	  PickupAttackCoop:
		TNT1 A 0 A_FireBullets(4,3,-1,random(7,10),"Duke64PistolPuffCoop", FBF_NORANDOM|FBF_NOFLASH)
		stop
		
	  PickupAttackDumDum:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackDumDumCoop")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackDumDumCoop")
	  PickupAttackDumDumDM:
		TNT1 A 0 A_FireBullets(4,3,-1,random(75,79),"Duke64PistolPuff", FBF_NORANDOM)
		stop

	  PickupAttackDumDumCoop:
		TNT1 A 0 A_FireBullets(4,3,-1,random(75,79),"Duke64PistolPuffCoop", FBF_NORANDOM)
		stop
	}
}

actor DukePistolReload : Ammo
{
	Inventory.MaxAmount 12
	+IGNORESKILL
}

actor DukePistolBullet : FastProjectile
{
	Damage (7)
	Radius 1
	Height 1
	Speed 320
	Projectile
	Obituary "$SAMSARA_DUKE_OB_PISTOL"
	DamageType "DukePistol"
	Renderstyle "Normal"
	+BLOODSPLATTER
	+NOTIMEFREEZE
	Alpha 1.0
	Decal DukeBulletchip
	States
	{
	  Spawn:
		TNT1 A 1
		loop

	  Crash:
	  Death:
		TNT1 A 0
		TNT1 A 1 A_SpawnItem("DukePistolPuff")
		//TNT1 A 1 A_SpawnItem("DukeBootPuff")
		stop

	  XDeath:
		TNT1 A 1
		stop
	}
}

actor DukePistolBulletCoop : DukePistolBullet
{
	+THRUSPECIES
	+NOTIMEFREEZE
	Species "Player"
}

actor DukePistolBulletBeach : DukePistolBullet
{
	Decal DukeBeachSquirt
	States
	{
	  Spawn:
		TNT1 A 1
		loop

	  Crash:
	  Death:
		TNT1 A 0
		TNT1 A 1 A_SpawnItem("DukeBulletPuffBeach")
		//TNT1 A 1 A_SpawnItem("DukeBootPuff")
		stop

	  XDeath:
		TNT1 A 1
		stop
	}
}

actor DukePistolBulletBeachCoop : DukePistolBulletBeach
{
	+THRUSPECIES
	+NOTIMEFREEZE
	Species "Player"
}

actor Duke64PistolPuff : BulletPuff
{
    Alpha 1
    DamageType "DukePistol"
    Scale 0.25
    VSpeed 0
    -SOLID
	Decal DukeBulletchip
    States
    {
      Spawn:
        TNT1 A 0
        TNT1 A 0 A_Jump(224,2)
        TNT1 A 0 A_PlaySound("duke64/ricochet")
        D6RC ABC 2 BRIGHT Light("BPUFF1")
		D6RC DEFG 2 BRIGHT Light("BPUFF2")
        Stop
	}
}

actor Duke64PistolPuffCoop : Duke64PistolPuff
{
	+THRUSPECIES
	+NOTIMEFREEZE
	Species "Player"
}

actor ShellCasingSpawner : FastProjectile
{
	Radius 6
	Height 6
	Projectile
	Damage 0
	Speed 5
	SeeSound "none"
	DeathSound "none"
	Decal "none"
	+CLIENTSIDEONLY
	States
	{
	  Spawn:
		TNT1 A 1
		TNT1 A 1 A_SpawnItemEx("DukeCasing1",0,3,4,random(3,5),0,random(-1,3),random(85,90),0)
		Stop
	}
}

actor DukeCasing1
{
	Speed 1
	Scale 0.07
	Gravity 0.8
	-SOLID
	+MISSILE
	+MOVEWITHSECTOR
	+CLIENTSIDEONLY
	+NOBLOCKMAP
	+NOTELEPORT
	States
	{
	  Spawn:
		TNT1 A 0 A_Jump(255,"Spawn1","Spawn2")
		TNT1 A 1
		loop

	  Spawn1:
		PISX A -1 BRIGHT
		Stop

	  Spawn2:
		PISX B -1 BRIGHT
		Stop

	  Death:
		TNT1 A 1
		Stop
	}
}

actor DukePistolPuff : DukeBulletPuff
{
	DamageType "DukePistol"
}
actor DukePistolPuffCoop : DukePistolPuff
{
	+THRUSPECIES
	+MTHRUSPECIES
	Species "Player"
}
actor DukePistolPuffBeach : DukeBulletPuffBeach
{
	DamageType "DukePistol"
}
actor DukePistolPuffBeachCoop : DukePistolPuffBeach
{
	+THRUSPECIES
	+MTHRUSPECIES
	Species "Player"
}