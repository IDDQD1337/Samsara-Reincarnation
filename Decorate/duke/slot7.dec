actor DevastatorSide: Boolean {}

actor "Devastator Weapon" : DukeWeapon
{
	Weapon.SelectionOrder 2800
	Weapon.AmmoUse 2
	Weapon.AmmoGive 30 // Originally 15, increased because of the double ammo usage.
	Weapon.AmmoType "Cell"
	//Obituary "%k devastated %o."

	Inventory.Pickupmessage "You got the Devastator!"
	Inventory.PickupSound "duke/weaponget"
	Weapon.UpSound "duke/weaponget"
//  Scale 0.9
	+NOALERT
	+INVENTORY.UNDROPPABLE
	+WEAPON.BFG
	+WEAPON.EXPLOSIVE
	Tag "Devastator"
	States
	{
	  Spawn:
		DEVP A -1
		Stop

	  Ready:
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"ReadyA")
		TNT1 A 0 A_JumpIfInventory("DukeReady",1,"IntroTaunt")
		TNT1 A 0 A_JumpIfInventory("DukeWaiting",15,"WaitingTaunt")
		TNT1 A 0 A_JumpIfInventory("DukeGiveMoney",1,"GiveMoney")
		TNT1 A 0 A_JumpIfInventory("DukeStomp", 1, "Stomp")
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, 2)
		DDEV A 1 A_WeaponReady
		Loop
		DDEV N 1 A_WeaponReady
		Loop

	  Deselect:
		TNT1 A 0 A_GiveInventory("BlankFlash",1)
		TNT1 A 0 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_TakeInventory("BlankFlash",1)
		DDEV A 0 A_JumpIfInventory("DukeLABToken", 1, "DeselectLAB")
		Goto Super::Deselect
	  DeselectLAB:
		DDEV N 0
		Goto Super::Deselect

	  Select:
		TNT1 A 0 A_JumpIfInventory("DukeReady",1,"IntroTaunt1")
		TNT1 A 0 A_GiveInventory("BlankFlash",1)
		TNT1 A 0 A_GunFlash("Flash",GFF_NOEXTCHANGE)
		TNT1 A 0 A_TakeInventory("BlankFlash",1)
		DDEV A 0 A_JumpIfInventory("DukeLABToken", 1, "SelectLAB")
		Goto Super::Select
	  SelectLAB:
		DDEV N 0
		Goto Super::Select

	  Fire:
		TNT1 A 0 A_TakeInventory("DukeWaiting", 15)
		TNT1 A 0 A_JumpIfInventory("DukeStomp", 1, "Stomp")
		TNT1 A 0 A_GiveInventory("DBSHOT",30)
		TNT1 A 0 A_GunFlash
		Goto ReadyA

	  Flash:
		TNT1 A 0 A_JumpIfInventory("DBSHOT",1,"FireRight")
		stop
	  FireRight:
		TNT1 A 0 A_AlertMonsters
		TNT1 A 0 A_JumpIfInventory("DevastatorSide", 1, "FireLeft")
		TNT1 A 0 A_GiveInventory("DevastatorSide", 1)
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, "FireRightLAB")
		DDEV H 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",1)
		TNT1 A 0 A_Light1
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "FireRightCoop")
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocket",random(-280,280)/100.00,0,5,0,0,random(-100,100)/100.00)
		DDEV I 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV J 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocket",random(-280,280)/100.00,0,6,2,0,random(-100,100)/100.00)
		Goto FireRightEnd
	  FireRightCoop:
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketCoop",random(-280,280)/100.00,0,5,0,0,random(-100,100)/100.00)
		DDEV I 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV J 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketCoop",random(-280,280)/100.00,0,6,2,0,random(-100,100)/100.00)
		Goto FireRightEnd
	  FireRightEnd:
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire")
		DDEV J 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DDEV KLM 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DDEV A 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop
	  FireRightLAB:
		DDEV U 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",1)
		TNT1 A 0 A_Light1
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot2",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire2")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "FireRightLABCoop")
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeach",random(-280,280)/100.00,0,5,0,0,random(-100,100)/100.00)
		DDEV V 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV W 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeach",random(-280,280)/100.00,0,6,2,0,random(-100,100)/100.00)
		Goto FireRightLABEnd
	  FireRightLABCoop:
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeachCoop",random(-280,280)/100.00,0,5,0,0,random(-100,100)/100.00)
		DDEV V 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV W 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeachCoop",random(-280,280)/100.00,0,6,2,0,random(-100,100)/100.00)
		Goto FireRightLABEnd
	  FireRightLABEnd:
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot2",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire2")
		DDEV W 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DDEV XYZ 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DDEV N 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop
	  FireLeft:
		TNT1 A 0 A_TakeInventory("DevastatorSide", 1)
		TNT1 A 0 A_JumpIfInventory("DukeLABToken", 1, "FireLeftLAB")
		DDEV B 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",1)
		TNT1 A 0 A_Light1
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "FireLeftCoop")
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocket",random(-280,280)/100.00,0,-5,0,0,random(-100,100)/100.00)
		DDEV C 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV D 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocket",random(-280,280)/100.00,0,-6,2,0,random(-100,100)/100.00)
		Goto FireLeftEnd
	  FireLeftCoop:
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketCoop",random(-280,280)/100.00,0,-5,0,0,random(-100,100)/100.00)
		DDEV C 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV D 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketCoop",random(-280,280)/100.00,0,-6,2,0,random(-100,100)/100.00)
		Goto FireLeftEnd
	  FireLeftEnd:
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire")
		DDEV D 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DDEV EFG 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DDEV A 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop
	  FireLeftLAB:
		DDEV O 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",1)
		TNT1 A 0 A_Light1
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot2",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire2")
		TNT1 A 0 A_JumpIfInventory("CoopModeOn", 1, "FireLeftLABCoop")
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeach",random(-280,280)/100.00,0,-5,0,0,random(-100,100)/100.00)
		DDEV P 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV Q 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeach",random(-280,280)/100.00,0,-6,2,0,random(-100,100)/100.00)
		Goto FireLeftLABEnd
	  FireLeftLABCoop:
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeachCoop",random(-280,280)/100.00,0,-5,0,0,random(-100,100)/100.00)
		DDEV P 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_Light0
		DDEV Q 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_FireCustomMissile("DukeDevastatorRocketBeachCoop",random(-280,280)/100.00,0,-6,2,0,random(-100,100)/100.00)
		Goto FireLeftLABEnd
	  FireLeftLABEnd:
		TNT1 A 0 A_TakeInventory("Cell",2,TIF_NOTAKEINFINITE)
		TNT1 A 0 A_PlaySound("duke/freezeshot2",CHAN_5)
		TNT1 A 0 A_PlayWeaponSound("duke/rocketfire2")
		DDEV Q 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		DDEV RST 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		TNT1 A 0 A_TakeInventory("DBSHOT",99)
		DDEV N 1 BRIGHT A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
		Stop

	  AltFire:
		TNT1 A 0 A_JumpIfInventory("DukeClassMode", 2, "NoAltFireForDuke64")
		Goto Super::AltFire

	  AltFlash:
		DDEV A 2 A_JumpIfInventory("DukeLABToken", 1, 2)
		Stop
		DDEV N 2
		Stop

	  NoAltFireForDuke64:
		TNT1 A 0
		goto Ready

	  TauntWeaponSound:
		TNT1 A 0 A_PlayWeaponSound("duke/weaponget")
		Goto Select

	  IntroTaunt:
		DDEV A 0 A_JumpIfInventory("DukeLABToken", 1, "IntroTauntLAB")
		Goto Super::IntroTaunt
	  IntroTauntLAB:
		DDEV N 0
		Goto Super::IntroTaunt

	  WaitingTaunt:
		DDEV A 0 A_JumpIfInventory("DukeLABToken", 1, "WaitingTauntLAB")
		Goto Super::WaitingTaunt
	  WaitingTauntLAB:
		DDEV N 0
		Goto Super::WaitingTaunt

	  GiveMoney:
		DDEV A 0 A_JumpIfInventory("DukeLABToken", 1, "GiveMoneyLAB")
		Goto Super::GiveMoney
	  GiveMoneyLAB:
		DDEV N 0
		Goto Super::GiveMoney
	}
}

actor DukeDevastatorRocket
{
	Radius 3
	Height 2
	Speed 38
	Damage (0)
	Projectile
	Obituary "$SAMSARA_DUKE_OB_SLOT7"
	Scale 0.2
	Decal DoomImpScorch
	DamageType "DukeExplosive"
	+FORCERADIUSDMG
	States
	{
		Spawn:
			RPGX A 1 BRIGHT
			loop

		XDeath:
		Crash:
			TNT1 A 0 A_Explode(38, 90, 0)

		Death:
			TNT1 A 0 A_Explode(38, 90)
			TNT1 A 0 A_PlaySoundEx("duke/explosion2", CHAN_WEAPON, 0, -1)
			TNT1 A 0 A_PlaySound("duke/explosion", 5, 1.0, 0, ATTN_NORM)
			TNT1 A 1 A_SpawnItemEx("DevastatorExplosion",0,0,0,0,0,0,0,160)
			Stop
	}
}

actor DukeDevastatorRocketCoop : DukeDevastatorRocket { +THRUSPECIES Species "Player" }

actor DukeDevastatorRocketBeach : DukeDevastatorRocket
{
	States
	{
	  Spawn:
		RPGX W 1 BRIGHT
		loop
	}
}

actor DukeDevastatorRocketBeachCoop : DukeDevastatorRocketBeach { +THRUSPECIES Species "Player" }

actor DevastatorExplosion : RPGExplosion { Scale 0.1 +CLIENTSIDEONLY }
