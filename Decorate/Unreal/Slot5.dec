actor SamsaraUnrealEightballRocketsLoaded : Counter { Inventory.MaxAmount 6 }
actor SamsaraUnrealEightballPrimaryRing : Boolean {}
actor SamsaraUnrealEightballSecondaryFiring : Boolean {}
actor Unreal_TargetLocked : Boolean {}
actor Unreal_EightballLockTimer : Counter { Inventory.MaxAmount 21 }
actor SamsaraUnrealEightballLockDisabled : Boolean {}
actor SamsaraUnrealEightballLockSoundRepeat : Counter { Inventory.MaxAmount 21 }
actor Unreal_RepeatCount : Counter { Inventory.MaxAmount 4 }

Actor Unreal_EightBall : UnrealWeapon
{
	Weapon.SlotNumber 5
	Weapon.SelectionOrder 1700
	Weapon.AmmoType "RocketAmmo"
	Weapon.AmmoGive 6
	Weapon.AmmoUse 1
	Tag "8-Ball Launcher"
	Inventory.PickupMessage "You got the Eightball gun."
	Obituary "%o was smacked down multiple times by %k's Eightball."
    +ALT_USES_BOTH // only one ammo type with same ammo amount use, so this makes alt fire behave as intended
	+EXPLOSIVE
	+NOALERT
	States
	{
		Spawn:
			UN00 A 10 Bright
			UN00 A 10
			loop

		ReadyActual:
			UN03 A 0 A_TakeInventory("SamsaraUnrealEightballLockDisabled")
			UN03 A 0 A_GunFlash("ReadyActualTarget",GFF_NOEXTCHANGE)
			UN03 A 0 A_TakeInventory("SamsaraUnrealEightballRocketsLoaded")
			UN03 A 2 A_WeaponReady
			loop

		ReadyActualTarget:
			TNT1 A 2 A_GiveInventory("SamsaraUnrealEightballTargetingHandler")
			stop

		Deselect:
            UN02 A 0 A_GunFlash("DeselectTargetClear",GFF_NOEXTCHANGE)
			UN02 A 0 A_TakeInventory("Unreal_EightBallSelected")
			UN02 A 0 A_TakeInventory("SamsaraUnrealEightballLockDisabled")
			UN02 A 0 A_TakeInventory("Unreal_EightballLockTimer")
			UN02 A 0 A_TakeInventory("Unreal_TargetLocked")
            UN02 A 0 A_TakeInventory("SamsaraUnrealEightballLockSoundRepeat")
			UN02 A 2 A_JumpIfHealthLower(1,"DeselectInstant")
			UN02 BCDE 2
			goto DeselectInstant

        DeselectTargetClear:
            TNT1 A 0
            stop

		Ready: // our "Select" state
			UN01 A 0 A_GiveInventory("Unreal_EightBallSelected")
            UN01 A 0 A_PlaySound("Unreal/Eightball/Select")
			UN01 A 0 A_TakeInventory("SamsaraUnrealEightballLockDisabled")
			UN01 A 0 A_TakeInventory("Unreal_EightballLockTimer")
			UN01 A 0 A_TakeInventory("Unreal_TargetLocked")
            UN01 A 0 A_TakeInventory("SamsaraUnrealEightballLockSoundRepeat")
			UN01 ABCDEFGH 2 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
			goto ReadyActual

        // [tv50] thank you I hate this
        Fire:
            UN04 A 0 A_TakeInventory("SamsaraUnrealEightballSecondaryFiring")
            UN04 A 0 A_TakeInventory("SamsaraUnrealEightballPrimaryRing")
            UN04 A 0 A_TakeInventory("SamsaraUnrealEightballLockDisabled")
            goto ChargeInit

        AltFire:
            UN04 A 0 A_GiveInventory("SamsaraUnrealEightballSecondaryFiring")
            UN04 A 0 A_GiveInventory("SamsaraUnrealEightballLockDisabled")
            UN04 A 0 A_TakeInventory("Unreal_EightballLockTimer")
            UN04 A 0 A_TakeInventory("Unreal_TargetLocked")
            UN04 A 0 A_TakeInventory("SamsaraUnrealEightballLockSoundRepeat")
            goto ChargeInit

        ChargeInit:
			UN04 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,2)
			UN04 A 0 A_JumpIfInventory("RocketAmmo",2,1)
            goto ChargeFinishDesyncHack
			UN04 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",5,"ChargeFinishDesyncHack")
            UN04 A 0 A_GiveInventory("SamsaraUnrealEightballChargeGiver")
			UN04 A 0 A_GunFlash("ChargeTarget",GFF_NOEXTCHANGE)
        ChargeModeCheck:
            UN04 A 0 A_JumpIfInventory("SamsaraUnrealEightballSecondaryFiring",1,"AltFireCharge")
            goto FireCharge

        // [tv50] this code is REALLY lucky to even exist AND work reliably with the interpolation
		FireCharge:
            UN04 A 0 A_PlaySound("Unreal/Eightball/Load")
			UN04 A 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 B 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 B 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 C 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 C 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 D 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 D 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 E 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 E 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 F 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 F 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 G 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 G 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 H 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 H 0 A_PlaySound("Unreal/Eightball/Barrel",CHAN_BODY,0.5)
			UN04 H 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 I 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 I 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 J 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 J 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 K 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 K 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 L 0 A_JumpIfInventory("SynthFireLeft",1,1)
            goto ChargeFinish
			UN04 L 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
            UN04 L 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeReFire
            UN04 L 0 A_GiveInventory("SamsaraUnrealEightballPrimaryRing")
            goto ChargeReFire

		AltFireCharge:
            UN04 A 0 A_PlaySound("Unreal/Eightball/Load")
			UN04 A 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 B 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 B 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 C 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 C 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 D 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 D 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 E 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 E 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 F 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 F 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 G 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 G 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 H 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 H 0 A_PlaySound("Unreal/Eightball/Barrel",CHAN_BODY,0.5)
			UN04 H 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 I 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 I 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 J 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 J 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 K 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 K 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 L 0 A_JumpIfInventory("SynthFireRight",1,1)
            goto ChargeFinish
			UN04 L 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
            goto ChargeReFire

		ChargeTarget:
			TNT1 AAAAAAAAAAAA 2 A_GiveInventory("SamsaraUnrealEightballTargetingHandler")
			stop

        ChargeReFire:
			UN04 L 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,2)
			UN04 L 0 A_JumpIfInventory("RocketAmmo",1,1)
            goto ChargeFinish
			UN04 L 0 A_ReFire("ChargeInit")
			goto ChargeFinish

        ChargeFinishDesyncHack:
            UN04 L 0 A_GiveInventory("SamsaraUnrealEightballChargeGiver")
        ChargeFinish:
            UN04 L 0 A_ClearReFire
            UN04 L 0 A_GunFlash("ChargeFinishTargetClear",GFF_NOEXTCHANGE)
            goto ChargeRelease

		ChargeFinishTargetClear:
			TNT1 A 0
			stop

		ChargeRelease:
            UN05 A 0 A_GiveInventory("SamsaraUnrealEightballLockDisabled")
			UN05 A 0 A_AlertMonsters
            UN05 A 0 A_JumpIfInventory("SamsaraUnrealEightballSecondaryFiring",1,2)
			UN05 A 0 A_GiveInventory("SamsaraUnrealEightballPrimaryAttackHandler")
            goto ChargeReleaseContinue
			UN05 A 0 A_GiveInventory("SamsaraUnrealEightballSecondaryAttackHandler")
            goto ChargeReleaseContinue

        ChargeReleaseContinue:
			UN05 A 3 Bright A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN05 BCD 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
            TNT1 A 0 A_CheckReload
            TNT1 A 0 A_PlaySound("Unreal/Eightball/Load")
			UN04 ABCDEFG 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
			UN04 H 0 A_PlaySound("Unreal/Eightball/Barrel",CHAN_BODY,0.5)
			UN04 HIJKL 2 A_WeaponReady(WRF_NOSWITCH|WRF_NOFIRE)
            UN03 A 0 A_CheckReload
			goto ReadyActual
	}
}

actor SamsaraUnrealEightballChargeGiver : Trigger
{
    States
    {
      // Ammo checking/taking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",0,"PickupStop")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupGiveCharge")
        TNT1 A 0 A_JumpIfInventory("RocketAmmo",1,1)
        stop
        TNT1 A 0 A_TakeInventory("RocketAmmo",1)
        goto PickupGiveCharge

      // Charge giving stuff
      PickupGiveCharge:
        TNT1 A 0 A_GiveInventory("SamsaraUnrealEightballRocketsLoaded")
        stop
    }
}

actor SamsaraUnrealEightballPrimaryAttackHandler : Trigger
{
    States
    {
      // Charge checking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",1,"PickupAttack")
        goto PickupFinish

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_PlaySound("Unreal/Eightball/Fire",CHAN_WEAPON)
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballPrimaryRing",1,"PickupAttackRing")
      // Spread
      PickupAttackSpread:
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",0,"PickupAttackSpreadCharged6")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",5,"PickupAttackSpreadCharged5")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",4,"PickupAttackSpreadCharged4")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",3,"PickupAttackSpreadCharged3")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",2,"PickupAttackSpreadCharged2")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",1,"PickupAttackSpreadCharged1")
        goto PickupFinish

      // 1 charge
      PickupAttackSpreadCharged1:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackSpreadCharged1Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackSpreadCharged1Coop")
      PickupAttackSpreadCharged1DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged1DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,7)
        goto PickupEffects

      PickupAttackSpreadCharged1DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,7)
        goto PickupEffects

      PickupAttackSpreadCharged1Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged1CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,7)
        goto PickupEffects

      PickupAttackSpreadCharged1CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,7)
        goto PickupEffects

      // 2 charges
      PickupAttackSpreadCharged2:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackSpreadCharged2Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackSpreadCharged2Coop")
      PickupAttackSpreadCharged2DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged2DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",7,false,-7)
        goto PickupEffects

      PickupAttackSpreadCharged2DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",7,false,-7)
        goto PickupEffects

      PickupAttackSpreadCharged2Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged2CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",7,false,-7)
        goto PickupEffects

      PickupAttackSpreadCharged2CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",7,false,-7)
        goto PickupEffects

      // 3 charges
      PickupAttackSpreadCharged3:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackSpreadCharged3Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackSpreadCharged3Coop")
      PickupAttackSpreadCharged3DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged3DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",14,false,-14)
        goto PickupEffects

      PickupAttackSpreadCharged3DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",14,false,-14)
        goto PickupEffects

      PickupAttackSpreadCharged3Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged3CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",14,false,-14)
        goto PickupEffects

      PickupAttackSpreadCharged3CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",14,false,-14)
        goto PickupEffects

      // 4 charges
      PickupAttackSpreadCharged4:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackSpreadCharged4Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackSpreadCharged4Coop")
      PickupAttackSpreadCharged4DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged4DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,-7)
        goto PickupEffects

      PickupAttackSpreadCharged4DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,-7)
        goto PickupEffects

      PickupAttackSpreadCharged4Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged4CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,-7)
        goto PickupEffects

      PickupAttackSpreadCharged4CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,-7)
        goto PickupEffects

      // 5 charges
      PickupAttackSpreadCharged5:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackSpreadCharged5Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackSpreadCharged5Coop")
      PickupAttackSpreadCharged5DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged5DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",-7,false,7)
        goto PickupEffects

      PickupAttackSpreadCharged5DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",-7,false,7)
        goto PickupEffects

      PickupAttackSpreadCharged5Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged5CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",-7,false,7)
        goto PickupEffects

      PickupAttackSpreadCharged5CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",-7,false,7)
        goto PickupEffects

      // 6 charges
      PickupAttackSpreadCharged6:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackSpreadCharged6Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackSpreadCharged6Coop")
      PickupAttackSpreadCharged6DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged6DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",-7,false,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",-14,false,14)
        goto PickupEffects

      PickupAttackSpreadCharged6DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",-7,false,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",-14,false,14)
        goto PickupEffects

      PickupAttackSpreadCharged6Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackSpreadCharged6CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",-7,false,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",-14,false,14)
        goto PickupEffects

      PickupAttackSpreadCharged6CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",7,false,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",14,false,-14)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,-7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",-7,false,7)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",-14,false,14)
        goto PickupEffects

      // Ring
      PickupAttackRing:
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",0,"PickupAttackRingCharged6")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",5,"PickupAttackRingCharged5")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",4,"PickupAttackRingCharged4")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",3,"PickupAttackRingCharged3")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",2,"PickupAttackRingCharged2")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",1,"PickupAttackRingCharged1")
        goto PickupFinish

      // 1 charge
      PickupAttackRingCharged1:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRingCharged1Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRingCharged1Coop")
      PickupAttackRingCharged1DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged1DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,8)
        goto PickupEffects

      PickupAttackRingCharged1DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,8)
        goto PickupEffects

      PickupAttackRingCharged1Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged1CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,8)
        goto PickupEffects

      PickupAttackRingCharged1CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,8)
        goto PickupEffects

      // 2 charges
      PickupAttackRingCharged2:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRingCharged2Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRingCharged2Coop")
      PickupAttackRingCharged2DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged2DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4,4)
        goto PickupEffects

      PickupAttackRingCharged2DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4,4)
        goto PickupEffects

      PickupAttackRingCharged2Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged2CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4,4)
        goto PickupEffects

      PickupAttackRingCharged2CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4,4)
        goto PickupEffects

      // 3 charges
      PickupAttackRingCharged3:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRingCharged3Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRingCharged3Coop")
      PickupAttackRingCharged3DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged3DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4)
        goto PickupEffects

      PickupAttackRingCharged3DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4)
        goto PickupEffects

      PickupAttackRingCharged3Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged3CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4)
        goto PickupEffects

      PickupAttackRingCharged3CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4)
        goto PickupEffects

      // 4 charges
      PickupAttackRingCharged4:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRingCharged4Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRingCharged4Coop")
      PickupAttackRingCharged4DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged4DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,-8)
        goto PickupEffects

      PickupAttackRingCharged4DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,-8)
        goto PickupEffects

      PickupAttackRingCharged4Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged4CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,-8)
        goto PickupEffects

      PickupAttackRingCharged4CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,-8)
        goto PickupEffects

      // 5 charges
      PickupAttackRingCharged5:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRingCharged5Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRingCharged5Coop")
      PickupAttackRingCharged5DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged5DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,4,-4)
        goto PickupEffects

      PickupAttackRingCharged5DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,4,-4)
        goto PickupEffects

      PickupAttackRingCharged5Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged5CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,4,-4)
        goto PickupEffects

      PickupAttackRingCharged5CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,4,-4)
        goto PickupEffects

      // 6 charges
      PickupAttackRingCharged6:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRingCharged6Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRingCharged6Coop")
      PickupAttackRingCharged6DM:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged6DMHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,4,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocket",0,false,4)
        goto PickupEffects

      PickupAttackRingCharged6DMHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,4,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHoming",0,false,4)
        goto PickupEffects

      PickupAttackRingCharged6Coop:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupAttackRingCharged6CoopHoming")
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,4,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketCoop",0,false,4)
        goto PickupEffects

      PickupAttackRingCharged6CoopHoming:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,4,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballRocketHomingCoop",0,false,4)
        goto PickupEffects

      // Effects stuff
      PickupEffects:
        TNT1 A 0 ACS_NamedExecuteWithResult("Unreal_Recoil")
        TNT1 A 0 A_JumpIfInventory("WeaponFlashesAreDisabled",1,"PickupFinish")
        TNT1 A 0 A_SetBlend("E3BE2A",0.1,10)
        goto PickupFinish

      // Finishing stuff
      PickupFinish:
        TNT1 A 0 A_TakeInventory("Unreal_EightballLockTimer")
        TNT1 A 0 A_TakeInventory("Unreal_TargetLocked")
        TNT1 A 0 A_TakeInventory("SamsaraUnrealEightballLockSoundRepeat")
        stop
    }
}

actor SamsaraUnrealEightballSecondaryAttackHandler : Trigger
{
    States
    {
      // Charge checking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",1,"PickupAttack")
        goto PickupFinish

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_PlaySound("Unreal/Eightball/AltFire",CHAN_WEAPON)
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",0,"PickupAttackCharged6")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",5,"PickupAttackCharged5")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",4,"PickupAttackCharged4")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",3,"PickupAttackCharged3")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",2,"PickupAttackCharged2")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballRocketsLoaded",1,"PickupAttackCharged1")
        goto PickupFinish

      // 1 charge
      PickupAttackCharged1:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCharged1Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCharged1Coop")
      PickupAttackCharged1DM:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,8)
        goto PickupEffects

      PickupAttackCharged1Coop:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,8)
        goto PickupEffects

      // 2 charges
      PickupAttackCharged2:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCharged2Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCharged2Coop")
      PickupAttackCharged2DM:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4,4)
        goto PickupEffects

      PickupAttackCharged2Coop:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4,4)
        goto PickupEffects

      // 3 charges
      PickupAttackCharged3:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCharged3Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCharged3Coop")
      PickupAttackCharged3DM:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4)
        goto PickupEffects

      PickupAttackCharged3Coop:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4)
        goto PickupEffects

      // 4 charges
      PickupAttackCharged4:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCharged4Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCharged4Coop")
      PickupAttackCharged4DM:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,-8)
        goto PickupEffects

      PickupAttackCharged4Coop:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,-8)
        goto PickupEffects

      // 5 charges
      PickupAttackCharged5:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCharged5Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCharged5Coop")
      PickupAttackCharged5DM:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",-4,false,4,-4)
        goto PickupEffects

      PickupAttackCharged5Coop:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",-4,false,4,-4)
        goto PickupEffects

      // 6 charges
      PickupAttackCharged6:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackCharged6Coop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackCharged6Coop")
      PickupAttackCharged6DM:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",4,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",-4,false,4,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenade",-4,false,4)
        goto PickupEffects

      PickupAttackCharged6Coop:
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4,4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",4,false,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",0,false,0,-8)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",-4,false,4,-4)
        TNT1 A 0 A_FireCustomMissile("Unreal_EightballGrenadeCoop",-4,false,4)
        goto PickupEffects

      // Effects stuff
      PickupEffects:
        TNT1 A 0 ACS_NamedExecuteWithResult("Unreal_Recoil")
        TNT1 A 0 A_JumpIfInventory("WeaponFlashesAreDisabled",1,"PickupFinish")
        TNT1 A 0 A_SetBlend("E3BE2A",0.1,10)
        goto PickupFinish

      // Finishing stuff
      PickupFinish:
        TNT1 A 0 A_TakeInventory("Unreal_EightballLockTimer")
        TNT1 A 0 A_TakeInventory("Unreal_TargetLocked")
        TNT1 A 0 A_TakeInventory("SamsaraUnrealEightballLockSoundRepeat")
        stop
    }
}

Actor Unreal_EightballRocket
{
	Projectile
	Speed 18
	Radius 4
	Height 4
	Damage (85)
	+FORCERADIUSDMG
	DeathSound "Unreal/Flak/Explode2"
	ActiveSound "Unreal/Rocket/Fly"
	DamageType "UnrealExplosive"
	States
	{
		Spawn:
			UN00 A 0 NoDelay A_LoopActiveSound
			UN00 AB 2
		SpawnLoop:
			UN00 C 0 A_LoopActiveSound
			UN00 C 0 A_SeekerMissile(90,90,SMF_PRECISE)
			UN00 C 0 A_SpawnItemEx("UnrealSmoke",-32*cos(pitch)-32*sin(-pitch),0,32*sin(-pitch)-32*cos(pitch),0,0,0)
			UN00 C 1 A_SpawnItemEx("UnrealSmoke",-64*cos(pitch)-32*sin(-pitch),0,64*sin(-pitch)-32*cos(pitch),0,0,0)
			Loop

		Death:
			TNT1 A 0 A_Explode(85, 200)
			TNT1 A 0 A_SpawnItemEX("Unreal_EightballExplosiveEffect", 0,0,0,0,0,0,0, SXF_NOCHECKPOSITION)
			TNT1 A 5
			Stop
	}
}

Actor Unreal_EightballRocketCoop : Unreal_EightballRocket { +THRUSPECIES Species "Player" }

actor Unreal_EightballRocketHoming : Unreal_EightballRocket { +SEEKERMISSILE }

actor Unreal_EightballRocketHomingCoop : Unreal_EightballRocketHoming
{
    Species "Player"
    +THRUSPECIES
}

Actor Unreal_EightballGrenade
{
	Projectile
	-NOGRAVITY
	+BOUNCEONWALLS
	+BOUNCEONCEILINGS
	+BOUNCEONFLOORS
	+FORCERADIUSDMG
	BounceCount 3
	BounceType Grenade
	Speed 12
	Gravity 0.33
	Damage (100)
	Radius 4
	Height 4
	//DeathSound "Unreal/Flak/Explode2"
	BounceSound "Unreal/Grenade/Bounce"
	DamageType "UnrealExplosive"
	Var Int User_Angle;
	States
	{
		Spawn:
			TNT1 A 0 NoDelay A_Jump(128,3)
			TNT1 A 0 A_SetUserVar(User_Angle,Random(1,6))
			UN00 A 0 ThrustThingZ(0,11,0,1)
			Goto SpawnLoop
			TNT1 A 0 A_SetUserVar(User_Angle,Random(-6,-1))	
			UN00 A 0 ThrustThingZ(0,11,0,1)
		SpawnLoop:
			TNT1 A 0 A_SetAngle(Angle+User_Angle)
			UN00 A 0 A_SetPitch(Pitch-15)
			UN00 A 1 A_SpawnItemEx("UnrealSmoke",0,0,0,0,0,0)
			Loop
		Death:
			TNT1 A 0 A_PlaySound("Unreal/Flak/Explode2",CHAN_VOICE)
			TNT1 A 0 A_Explode(100, 200)
			TNT1 A 0 A_SpawnItemEX("Unreal_EightballExplosiveEffect", 0,0,0,0,0,0,0, SXF_NOCHECKPOSITION)
			TNT1 A 5
			Stop
	}
}

Actor Unreal_EightballGrenadeCoop : Unreal_EightballGrenade { +THRUSPECIES Species "Player" }

actor SamsaraUnrealEightballTargetingHandler : Trigger
{
    States
    {
      // Targeting stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupCoop")
      PickupDM:
        TNT1 A 0 A_FireBullets(0,0,1,0,"Unreal_EightballTargeterPuff",FBF_NORANDOM|FBF_EXPLICITANGLE|FBF_NOFLASH)
        stop

      PickupCoop:
        TNT1 A 0 A_FireBullets(0,0,1,0,"Unreal_EightballTargeterPuffCoop",FBF_NORANDOM|FBF_EXPLICITANGLE|FBF_NOFLASH)
        stop
    }
}

actor Unreal_EightballTargeterPuff
{
    Radius 1
    Height 1
    +ALWAYSPUFF
    +BLOODLESSIMPACT
    +DONTBLAST
    +DONTSPLASH
    +FIXMAPTHINGPOS
    +NOBLOCKMAP
    +NOGRAVITY
    +NOTIMEFREEZE
    +NOTRIGGER
    +PUFFGETSOWNER
    +PUFFONACTORS
    +SKYEXPLODE
    States
    {
      // aiming at shootable?
      Spawn:
      XDeath:
      Melee:
        TNT1 A 0
      AimedLockCheck:
        TNT1 A 0 A_JumpIfInTargetInventory("SamsaraUnrealEightballLockDisabled",1,"Crash")
      AimedStart:
        TNT1 A 0 A_GiveToTarget("Unreal_EightballLockTimer")
        TNT1 A 1 A_JumpIfInTargetInventory("Unreal_EightballLockTimer",0,"AimedLockOn")
        stop

      AimedLockOn:
        TNT1 A 0 A_GiveToTarget("Unreal_LockOnSound")
        TNT1 A 1 A_GiveToTarget("Unreal_TargetLocked")
        stop

      // not aiming at shootable? firing?
      Crash:
        TNT1 A 0
      NotAimedStart:
        TNT1 A 0 A_TakeFromTarget("Unreal_EightballLockTimer",2)
        TNT1 A 0 A_JumpIfInTargetInventory("Unreal_EightballLockTimer",1,1)
        goto NotAimedLockOff
        TNT1 A 1
        stop

      NotAimedLockOff:
        TNT1 A 0 A_GiveToTarget("Unreal_LockOffSound")
        TNT1 A 1 A_TakeFromTarget("Unreal_TargetLocked")
        stop
    }
}

actor Unreal_EightballTargeterPuffCoop : Unreal_EightballTargeterPuff { +MTHRUSPECIES }

actor Unreal_LockOnSound : Trigger
{
    States
    {
      Pickup:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,"PickupSoundRepeatCheck")
        TNT1 A 0 ACS_NamedExecuteAlways("Unreal_EightballReticle", 0)
        goto PickupPlaySound

      PickupSoundRepeatCheck: // [tv50] lazy method
        TNT1 A 0 A_GiveInventory("SamsaraUnrealEightballLockSoundRepeat")
        TNT1 A 0 A_JumpIfInventory("SamsaraUnrealEightballLockSoundRepeat",0,"PickupPlaySound")
        stop

      PickupPlaySound:
        TNT1 A 0 A_PlaySound("Unreal/Eightball/LockOn",CHAN_6)
        TNT1 A 0 A_TakeInventory("SamsaraUnrealEightballLockSoundRepeat")
        stop
    }
}

Actor Unreal_LockOffSound : Trigger
{
    States
    {
      Pickup:
        TNT1 A 0 A_JumpIfInventory("Unreal_TargetLocked",1,1)
        stop
        TNT1 A 0 A_PlaySound("Unreal/Eightball/LockOff",CHAN_6)
        TNT1 A 0 A_TakeInventory("SamsaraUnrealEightballLockSoundRepeat")
        stop
    }
}

actor Unreal_SeekerActor
{
	-NOGRAVITY
	-FLOAT
	+NOCLIP
	+NOBLOCKMAP
	+NODAMAGETHRUST
	+BLOODLESSIMPACT
	+SEEKERMISSILE
	+PAINLESS
	Projectile
	Speed 1
	Damage (0)
	Mass 300
	Scale 0.6
	Radius 0
	height 0
	States
	{
		Spawn:
			//TNT1 A 0 A_JumpIfInventory("Unreal_RepeatCount", 0, "End")
			TNT1 A 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 A 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 B 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 B 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 C 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 C 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 D 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 D 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 E 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 E 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 F 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 F 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 G 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 G 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 H 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 H 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 I 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 I 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 J 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 J 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 K 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 K 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 L 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 L 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 M 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 M 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 N 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 N 1 Bright A_Fire(30) //A_Warp(AAPTR_TRACER, 5, 0, 32, 0, WARPF_ABSOLUTEPOSITION|WARPF_NOCHECKPOSITION)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 A 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 A 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 B 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 B 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 C 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 C 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 D 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 D 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 E 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 E 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 F 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 F 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 G 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 G 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 H 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 H 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 I 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 I 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 J 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 J 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 A 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 A 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 B 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 B 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 C 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 C 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 D 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 D 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 E 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 E 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 F 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 F 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 G 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 G 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 H 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 H 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 I 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 I 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 J 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 J 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 K 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 K 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 L 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 L 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 M 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 M 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 N 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 N 1 Bright A_Fire(30) //A_Warp(AAPTR_TRACER, 5, 0, 32, 0, WARPF_ABSOLUTEPOSITION|WARPF_NOCHECKPOSITION)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 A 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 A 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 B 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 B 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 C 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 C 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 D 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 D 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 E 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 E 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 F 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 F 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 G 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 G 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 H 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 H 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 I 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 I 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			TNT1 J 0 Bright A_SeekerMissile(90,90,3,256)
			TNT1 J 1 Bright A_Fire(30)
			TNT1 A 0 Bright ACS_NamedExecute("getLaserCoords",0,x,y,z)
			//TNT1 A 0 A_GiveInventory("Unreal_RepeatCount", 1)
			TNT1 A 5
			Stop
	}
}
