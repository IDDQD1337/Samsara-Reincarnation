actor DoomguyBerserker: Trigger
{
    States
    {
      // Classic
      Pickup:
        TNT1 A 0 A_GiveInventory("Doom64UnmakerArtifact")
		TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupDoomStronghold")
        TNT1 A 0 A_JumpIfInventory("Doom64Mode",1,"PickupDoom64")
      PickupBerserkSwitchCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 44) == 0, "PickupBerserkFinish")
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 44) == 1, 1)
        goto PickupBerserkSwitch
        TNT1 A 0 A_JumpIfInventory("PowerStrength",1,"PickupBerserkFinish")
      PickupBerserkSwitch:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraBerserkFistSwitchHack") //A_SelectWeapon(" Fist ")
      PickupBerserkFinish:
        TNT1 A 0 A_GiveInventory("PowerStrength")
        TNT1 AAAA 0 A_GiveInventory("Medikit") //HealThing(100,0)
        stop

      // Doom 64
      PickupDoom64:
        TNT1 A 0 A_SetBlend("FF0000",0.15,105)
        goto PickupBerserkSwitchCheck

      // Stronghold
	  PickupDoomStronghold:
		TNT1 A 0 A_Jump(128,"PickupBerserkSwitchCheck")
		TNT1 A 0 A_GiveInventory("DGStrHasWPK", 1)
		TNT1 A 0 A_GiveInventory("SamsaraDoomguyStrWeaponPowerItem")
		stop
    }
}

actor Doom64GuyBerserk: DoomguyBerserker {}

actor DGStrHasWPK : Inventory { Inventory.MaxAmount 3 +UNDROPPABLE -INVBAR }

/*
actor SamsaraDoomguyStrWeaponPowerItem : PowerupGiver
{
    Scale 0.75
    Inventory.PickupMessage "Picked up a weapon powerup kit."
    Inventory.PickupSound "doomguy/itemget"
    Inventory.Icon "POWIA0"
    Inventory.MaxAmount 3
    Powerup.Type "WeaponLevel2"
    Powerup.Duration -60
    Powerup.Color "80 00 FF", 0.1
    Tag "Weapon Powerup Kit"
    States
    {
      Spawn:
        POWP A -1 Bright
        stop
    }
}
*/

actor SamsaraDoomguyStrWeaponPowerItem : CustomInventory
{
    Scale 0.75
    Inventory.PickupMessage "Picked up a weapon powerup kit."
    Inventory.PickupSound "doomguy/itemget"
    Inventory.Icon "POWIA0"
    Inventory.MaxAmount 3
    Inventory.RestrictedTo "DoomguyPlayer"
    Tag "Weapon Powerup Kit"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Spawn:
        POWP A -1 Bright
        stop

      Use:
        TNT1 A 0 A_JumpIfInventory("SamsaraDoomguyStrWeaponPower",1,"UseFail")
		TNT1 A 0 A_JumpIfInventory("SamsaraDoomguyStrWeaponPowerPerma",1,"UseFail2")
		TNT1 A 0 A_TakeInventory("DGStrHasWPK", 1)
        TNT1 A 0 A_GiveInventory("SamsaraDoomguyStrWeaponPower")
        stop
	  UseFail:
        TNT1 A 1
        TNT1 A 0 A_Print("$STRWEAPONPOWERUPKITCOOLDOWN")
        fail
	  UseFail2:
        TNT1 A 1
        TNT1 A 0 A_Print("$STRWEAPONPOWERUPKITCOOLDOWN2")
        fail
    }
}

actor SamsaraDoomguyStrWeaponPower : Powerup
{
    Powerup.Duration -60
    Powerup.Color "80 00 FF", 0.1
}

actor SamsaraDoomguyStrWeaponPowerPerma : inventory { -INVBAR +INVENTORY.UNDROPPABLE inventory.maxamount 1 }
