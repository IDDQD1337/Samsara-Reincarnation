ACTOR "  Crossbow  " : StrifeCrossbow
{
	Weapon.Kickback 100
	+INVENTORY.UNDROPPABLE
	+Weapon.NOALERT
	Inventory.PickUpSound "strife/weaponget"
	Weapon.SelectionOrder 1200
	Weapon.AmmoUse1 0
	Weapon.AmmoUse2 0
	Weapon.AmmoGive1 8
	Weapon.AmmoGive2 0
	Weapon.AmmoType1 "Shell"
	Weapon.AmmoType2 "StrifePoisonAmmo"
	Weapon.SlotNumber 2
	Inventory.PickupMessage "You picked up the Crossbow."
	Weapon.SisterWeapon ""
	Obituary "%k \cishocked\c- %o \ciwith an electric bolt."
	Inventory.RestrictedTo "StrifeguyPlayer"
	Tag "Crossbow"
	States
	{
	Spawn:
		SXBW A -1
		Stop
	Ready:
		SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"ReadyPoison")
		SBOW A 0 A_ShowElectricFlash
		SBOW A 1 A_WeaponReady
		Wait
	Deselect:
		SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"DeselectPoison")
		SBOW A 1 A_Lower
		Loop
	Select:
		SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"SelectPoison")
		SBOW A 1 A_Raise
		Loop
	Fire:
		SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"FirePoison")
		SBOW A 0 A_JumpIfInventory("Shell", 1, "FireElec")
		Goto Ready
	FireElec:
		SBOW B 3 A_ClearFlash
		SBOW B 0 A_TakeInventory("Shell", 1, TIF_NOTAKEINFINITE)
		SBOW B 0 A_PlayWeaponSound("strife/xbowfire")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",10,"FireElec.Accuracy100")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",8,"FireElec.Accuracy80")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",6,"FireElec.Accuracy60")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",4,"FireElec.Accuracy40")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",2,"FireElec.Accuracy20")
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-280,280)/100.00,1,0,0,0)
		Goto FireElecEnd
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-280,280)/100.00,1,0,0,0)
		Goto FireElecEnd
	FireElec.Accuracy20:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-140,140)/100.00,1,0,0,0)
		Goto FireElecEnd
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-140,140)/100.00,1,0,0,0)
		Goto FireElecEnd
	FireElec.Accuracy40:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-70,70)/100.00,1,0,0,0)
		Goto FireElecEnd
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-70,70)/100.00,1,0,0,0)
		Goto FireElecEnd
	FireElec.Accuracy60:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-35,35)/100.00,1,0,0,0)
		Goto FireElecEnd
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-35,35)/100.00,1,0,0,0)
		Goto FireElecEnd
	FireElec.Accuracy80:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",random(-17,17)/1000.00,1,0,0,0)
		Goto FireElecEnd
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",random(-17,17)/1000.00,1,0,0,0)
		Goto FireElecEnd
	FireElec.Accuracy100:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt",0,1,0,0,0)
		Goto FireElecEnd
		SBOW B 6 A_FireCustomMissile("StrifeElectricBolt2",0,1,0,0,0)
		Goto FireElecEnd
	FireElecEnd:
		SBOW C 4
		SBOW D 6
		SBOW E 3
		SBOW F 4
		SBOW G 0 A_ShowElectricFlash
		SBOW G 5 A_CheckReload
		Goto Ready+2
	AltFire:
		SBOW A 0 A_JumpIfInventory("CrossbowMode",1,"AltFirePoison")
		SBOW A 0 A_ClearFlash
		SBOW AAAAAAAAAAAA 1 A_Lower
		SBOW A 0 A_GiveInventory("CrossbowMode",1)
		SBOW HHHHHHHHHHHH 1 A_Raise
		Goto Ready
	AltFirePoison:
		SBOW HHHHHHHHHHHH 1 A_Lower
		SBOW H 0 A_TakeInventory("CrossbowMode",1)
		SBOW AAAAAAAAAAAA 1 A_Raise
		Goto Ready
	Flash:
		SBOW KLM 5 bright
		Loop
	ReadyPoison:
		SBOW H 1 A_WeaponReady
		Loop
	DeselectPoison:
		SBOW H 1 A_Lower
		Loop
	SelectPoison:
		SBOW H 1 A_Raise
		Loop
	FirePoison:
		SBOW H 0 A_JumpIfInventory("StrifePoisonAmmo",1,1)
		Goto AltFirePoison
		SBOW H 3
		SBOW B 0 A_TakeInventory("StrifePoisonAmmo", 1, TIF_NOTAKEINFINITE)
		SBOW B 0 A_PlayWeaponSound("strife/xbowfire")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",10,"FirePoison.Accuracy100")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",8,"FirePoison.Accuracy80")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",6,"FirePoison.Accuracy60")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",4,"FirePoison.Accuracy40")
		SBOW B 0 A_JumpIfInventory("AccuracyUpgrade2",2,"FirePoison.Accuracy20")
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-280,280)/100.00,1,0,0,0)
		Goto FirePoisonEnd
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-280,280)/100.00,1,0,0,0)
		Goto FirePoisonEnd
	FirePoison.Accuracy20:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-140,140)/100.00,1,0,0,0)
		Goto FirePoisonEnd
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-140,140)/100.00,1,0,0,0)
		Goto FirePoisonEnd
	FirePoison.Accuracy40:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-70,70)/100.00,1,0,0,0)
		Goto FirePoisonEnd
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-70,70)/100.00,1,0,0,0)
		Goto FirePoisonEnd
	FirePoison.Accuracy60:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-35,35)/100.00,1,0,0,0)
		Goto FirePoisonEnd
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-35,35)/100.00,1,0,0,0)
		Goto FirePoisonEnd
	FirePoison.Accuracy80:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",random(-17,17)/1000.00,1,0,0,0)
		Goto FirePoisonEnd
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",random(-17,17)/1000.00,1,0,0,0)
		Goto FirePoisonEnd
	FirePoison.Accuracy100:
		SBOW B 0 A_JumpIfInventory("CoopModeOn",1,2)
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt",0,1,0,0,0)
		Goto FirePoisonEnd
		SBOW B 6 A_FireCustomMissile("StrifePoisonBolt2",0,1,0,0,0)
		Goto FirePoisonEnd
	FirePoisonEnd:
		SBOW C 4
		SBOW D 6
		SBOW E 3
		SBOW I 4
		SBOW J 5 A_CheckReload
		Goto Ready
	}
}

actor StrifePoisonAmmo : Ammo
{
    Inventory.MaxAmount 25
    Ammo.BackpackAmount 2
    Ammo.BackpackMaxAmount 50
    Inventory.Icon "AMSMP0"
    Tag "Poison Bolts"
}

ACTOR StrifeElectricBolt : ElectricBolt
{
	Damage (random(1,4)*20) // was 10
	Damagetype "ElectricBolt"
	Projectile
	-STRIFEDAMAGE
	+DROPOFF
	Decal "CrossbowScorch2"
	SeeSound "strife/punchswing"
	DeathSound "strife/xbowhit"
	Obituary "%k \cishocked\c- %o \ciwith an electric bolt."
	States
	{
	Spawn:
		SRW1 A 10 A_LoopActiveSound
		Loop
	Death:
		ZAP1 A 3 bright A_AlertMonsters
		ZAP1 BCDEFE 3 bright
		ZAP1 DCB 2 bright
		ZAP1 A 1 bright
		Stop
	}
}

actor StrifeElectricBolt2 : StrifeElectricBolt { +THRUSPECIES Species "Player" }

actor StrifePoisonBolt : CStaffMissile
{
	Speed 40
	Radius 10
	Height 10
	+THRUGHOST
	+BLOODSPLATTER
	+FORCERADIUSDMG
//	+ADDITIVEPOISONDAMAGE
//	+ADDITIVEPOISONDURATION
	Damage (random(1,4)*50)//was 500
	Damagetype "PoisonBolt"
//	PoisonDamage 2,1
	Projectile
	MaxStepHeight 4
	SeeSound "strife/punchswing"
	//ActiveSound "strife/punchswing"
	DeathSound ""
	Renderstyle Normal
	Obituary "%k \cipierced\c- %o \ciwith a poison bolt."
	States
	{
	Spawn:
		SRW2 A 10 A_LoopActiveSound
		Loop
	XDeath:
		SRW2 A 1 A_Explode(100, 10,0,false,10)
		Stop
	Crash:
	Death:
		SRW2 A 1
		Stop
	}
}

actor StrifePoisonBolt2 : StrifePoisonBolt { +THRUSPECIES Species "Player" }
actor CrossbowMode : Inventory { -INVBAR +INVENTORY.UNDROPPABLE inventory.maxamount 1 }