Actor "Phase Repeater" : Weapon
{
  Weapon.SelectionOrder 1700
  Weapon.SlotNumber 4 
  weapon.BobStyle normal
  weapon.BobRangeX 1.2
  weapon.BobRangeY 0.5
  weapon.BobSpeed 2.0  
  Weapon.AmmoUse 2
  Weapon.AmmoGive 60
  Weapon.AmmoType "Clip"
  Weapon.AmmoUse2 0
  Weapon.AmmoGive2 0  
  Weapon.AmmoType2 "DisruptorHiFreq"  
  +WEAPON.AMMO_OPTIONAL
  +WEAPON.ALT_AMMO_OPTIONAL 
  +WEAPON.NOALERT
  Obituary "%o was got phased by %k."
  Inventory.PickupMessage "You got a Phase Repeater!"
  Inventory.RestrictedTo "DisruptorPlayer"
  Tag "Phase Repeater"
  States
  {
  Spawn:
    SQ72 U -1
    Stop

  // Normal
  Ready:
	TNT1 A 0 A_JumpIfInventory("DisruptorMode", 1, "ReadyRed")
    SQ74 AAAABBBBCCCCDDDDEEEEFFFF 1 A_WeaponReady
    Loop

  Deselect:
	TNT1 A 0 A_JumpIfInventory("DisruptorMode", 1, "DeselectRed")
	TNT1 A 0 A_Lower
    SQ74 A 1 A_Lower
	Loop

  Select:
	TNT1 A 0 A_JumpIfInventory("DisruptorMode", 1, "SelectRed")  
	TNT1 A 0 A_Raise
    SQ74 A 1 A_Raise
    Loop

  Fire:
	TNT1 A 0 A_JumpIfInventory("DisruptorMode", 1, "FireRed")
    TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FireStart")
    TNT1 A 0 A_JumpIfInventory("Clip",2,"FireStart")
    goto NoAmmoSwitch
  FireStart:
	TNT1 A 0 A_AlertMonsters
  FireContinue:
	TNT1 A 0 A_GiveInventory("SamsaraDisruptorPhaseRepeaterAttackHandler")
  FireFinish:
	TNT1 A 0 A_JumpIfInventory("DisruptorShit2",3,"FireAnimMiddle2")
	TNT1 A 0 A_JumpIfInventory("DisruptorShit2",2,"FireAnimRight")
	TNT1 A 0 A_JumpIfInventory("DisruptorShit2",1,"FireAnimMiddle")
	goto FireAnimLeft

  FireAnimLeft:
	SQ74 G 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ74 GH 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_GiveInventory("DisruptorShit2",1)
	SQ74 H 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_Refire
	SQ74 H 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
    Goto Ready

  FireAnimMiddle:
	SQ74 I 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ74 IJ 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_GiveInventory("DisruptorShit2",1)
	SQ74 J 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_Refire
	SQ74 J 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	Goto Ready

  FireAnimRight:
	SQ74 K 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ74 KL 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_GiveInventory("DisruptorShit2",1)
	SQ74 L 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
 	TNT1 A 0 A_Refire
	SQ74 L 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
    Goto Ready

  FireAnimMiddle2:
	SQ74 I 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ74 IJ 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_TakeInventory("DisruptorShit2",3)
	SQ74 J 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_Refire
	SQ74 J 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	Goto Ready

  AltFire:
	TNT1 A 0 A_JumpIfInventory("DisruptorMode", 1, 4)
	SQ70 EE 5 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH|WRF_NOSECONDARY)
	SQ70 E 0 A_GiveInventory("DisruptorMode", 1)
	goto ReadyRed
  	SQ74 AA 5 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH|WRF_NOSECONDARY)
	SQ74 A 0 A_TakeInventory("DisruptorMode")
	goto Ready

  // High Frequency
  ReadyRed:
    SQ70 EEEEDDDDCCCCBBBBAAAALLLL 1 A_WeaponReady
    Loop

  DeselectRed:
	TNT1 A 0 A_Lower
    SQ70 E 1 A_Lower
	Loop

  SelectRed:
	TNT1 A 0 A_Raise
    SQ70 E 1 A_Raise
    Loop

  FireRed:
    TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"FireRedStart")
    TNT1 A 0 A_JumpIfInventory("Clip",2,"FireRedStart")
    goto NoAmmoSwitchRed
  FireRedStart:
	TNT1 A 0 A_AlertMonsters
  FireRedContinue:
	TNT1 A 0 A_GiveInventory("SamsaraDisruptorPhaseRepeaterHiFreqAttackHandler")
  FireRedFinish:
	TNT1 A 0 A_JumpIfInventory("DisruptorShit2",3,"FireRedAnimMiddle2")
	TNT1 A 0 A_JumpIfInventory("DisruptorShit2",2,"FireRedAnimRight")
	TNT1 A 0 A_JumpIfInventory("DisruptorShit2",1,"FireRedAnimMiddle")
	goto FireRedAnimLeft

  FireRedAnimLeft:
	SQ70 F 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ70 FG 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_GiveInventory("DisruptorShit2",1)
	SQ70 G 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_Refire
	SQ70 G 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
    Goto Ready

  FireRedAnimMiddle:
	SQ70 H 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ70 HI 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_GiveInventory("DisruptorShit2",1)
	SQ70 I 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_Refire
	SQ70 I 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	Goto Ready

  FireRedAnimRight:
	SQ70 J 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ70 JK 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_GiveInventory("DisruptorShit2",1)
	SQ70 K 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
 	TNT1 A 0 A_Refire
	SQ70 K 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
    Goto Ready

  FireRedAnimMiddle2:
	SQ70 H 1 bright A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	SQ70 HI 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
	TNT1 A 0 A_TakeInventory("DisruptorShit2",3)
	SQ70 I 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
 	TNT1 A 0 A_Refire
	SQ70 I 1 A_WeaponReady(WRF_NOFIRE|WRF_NOSWITCH)
    Goto Ready

  NoAmmoSwitch:
    TNT1 A 0 A_ClearReFire
    TNT1 A 0 A_SelectWeapon(" 18mm Semi ")
    goto Deselect

  NoAmmoSwitchRed:
    TNT1 A 0 A_ClearReFire
    goto AltFire	
	}
}

actor SamsaraDisruptorPhaseRepeaterAttackHandler : Trigger
{
    States
    {
      // Ammo checking/taking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttack")
        TNT1 A 0 A_JumpIfInventory("Clip",2,1)
        stop
        TNT1 A 0 A_TakeInventory("Clip",2)
        goto PickupAttack

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_PlaySound("Disruptor/GreenLaser",CHAN_WEAPON)
        TNT1 A 0 A_JumpIfInventory("DisruptorShit2",3,"PickupAttackMiddle")
		TNT1 A 0 A_JumpIfInventory("DisruptorShit2",2,"PickupAttackRight")
		TNT1 A 0 A_JumpIfInventory("DisruptorShit2",1,"PickupAttackMiddle")
      // Left
      PickupAttackLeft:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeftCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeftCoop")
      PickupAttackLeftDM:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_1",7,1,0,0)
        stop

      PickupAttackLeftCoop:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_2",7,1,0,0)
        stop

      // Middle
      PickupAttackMiddle:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackMiddleCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackMiddleCoop")
      PickupAttackMiddleDM:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_1",0,1,0,0)
        stop

      PickupAttackMiddleCoop:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_2",0,1,0,0)
        stop

      // Right
      PickupAttackRight:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRightCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRightCoop")
      PickupAttackRightDM:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_1",-7,1,0,0)
        stop

      PickupAttackRightCoop:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_2",-7,1,0,0)
        stop
    }
}

actor SamsaraDisruptorPhaseRepeaterHiFreqAttackHandler : Trigger
{
    States
    {
      // Ammo checking/taking stuff
      Pickup:
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteAmmo",1,"PickupAttack")
        TNT1 A 0 A_JumpIfInventory("DisruptorHiFreq",1,1)
        stop
        TNT1 A 0 A_TakeInventory("DisruptorHiFreq",1)
        goto PickupAttack

      // Attack stuff
      PickupAttack:
        TNT1 A 0 A_PlaySound("Disruptor/GreenLaser",CHAN_WEAPON)
        TNT1 A 0 A_JumpIfInventory("DisruptorShit2",3,"PickupAttackMiddle")
		TNT1 A 0 A_JumpIfInventory("DisruptorShit2",2,"PickupAttackRight")
		TNT1 A 0 A_JumpIfInventory("DisruptorShit2",1,"PickupAttackMiddle")
      // Left
      PickupAttackLeft:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackLeftCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackLeftCoop")
      PickupAttackLeftDM:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_12",7,1,0,0)
        stop

      PickupAttackLeftCoop:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_22",7,1,0,0)
        stop

      // Middle
      PickupAttackMiddle:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackMiddleCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackMiddleCoop")
      PickupAttackMiddleDM:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_12",0,1,0,0)
        stop

      PickupAttackMiddleCoop:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_22",0,1,0,0)
        stop

      // Right
      PickupAttackRight:
		TNT1 A 0 A_JumpIfInventory("SPModeOn",1,"PickupAttackRightCoop")
        TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"PickupAttackRightCoop")
      PickupAttackRightDM:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_12",-7,1,0,0)
        stop

      PickupAttackRightCoop:
        TNT1 A 0 A_FireCustomMissile("DisruptorGP_22",-7,1,0,0)
        stop
    }
}

Actor DisruptorGP_12 : DisruptorGP_1
{
	Obituary "%o ate %k's spicy shit"
	Radius 6
	Damage (0)	
//	+SPECIALFIREDAMAGE //WHY NOT? No.
	+THRUACTORS
	+FORCERADIUSDMG
	+FORCEXYBILLBOARD
	States
	{
	Spawn:
		SQ99 D 0 
		SQ99 DDEEFFGGHHIIJJKK 1 bright A_GiveInventory("DisruptorGP_12_Predictor")//ACS_NamedExecuteWithResult("Samsara_ProjectilePredictor",1)//A_Explode(Random(20,30), 6, !XF_HURTSOURCE, false, 6)
		Loop
	Death:
		SQ99 LMNOPQRSTUVW 3 Bright
		SQ99 XYZ 2 Bright
		stop
	XDeath:
    Crash:
//		TNT1 A 0 A_Explode(Random(20,30), 30, !XF_HURTSOURCE, false, 30)
		SQ98 QRSTUVWXYZ 3 Bright 
		SQ99 ABC 2 Bright 	  
		stop			  
	}
}

Actor DisruptorGP_12_Predictor : Trigger
{
	States
	{
		Pickup:
			TNT1 A 0 A_SetArg(0,sqrt(velx*velx + vely*vely)*1000/sqrt(velx*velx + vely*vely + velz*velz))
			TNT1 A 0 A_SetArg(1,velz*1000/sqrt(velx*velx + vely*vely + velz*velz))
			TNT1 A 0 A_SetArg(2,sqrt(velx*velx + vely*vely + velz*velz)/2)
			TNT1 A 0 A_SetMass(-args[2])
		PickupLoop:
			TNT1 A 0 A_JumpIf(mass >= args[2],"PickupFinish")
			TNT1 A 0 A_SpawnItemEx("DisruptorGP_12_Explosion",args[0]/1000.0*mass,0,args[1]/1000.0*mass,0,0,0,0,SXF_TRANSFERPOINTERS)
			TNT1 A 0 A_SetMass(mass+radius)
			Loop
		PickupFinish:
			TNT1 A 0
			Stop
	}
}

Actor DisruptorGP_12_Explosion
{
	Projectile
	Height 2
	Radius 1
	Speed 0
	Obituary "%o ate %k's spicy shit"
	+NOINTERACTION
	+FORCERADIUSDMG
	+NODAMAGETHRUST
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 1 A_Explode(Random(1,2), 6, !XF_HURTSOURCE, false, 6)
			Stop
	}
}

Actor DisruptorGP_22 : DisruptorGP_12 { Species "Player" +THRUSPECIES }
actor DisruptorShit2 : inventory { inventory.amount 1 inventory.maxamount 3 }