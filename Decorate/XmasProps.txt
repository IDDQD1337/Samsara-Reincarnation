Actor SnowGenerator
{
	Height 1
	Radius 1
	+NOBLOCKMAP
	+NOINTERACTION
	+CLIENTSIDEONLY
	+SPAWNCEILING
	+NOGRAVITY
	+NOCLIP
	-SOLID
	Vspeed 64
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_JumpIf(ceilingz - floorz == 0, 2)
			TNT1 A 0 A_JumpIf(CallACS("Samsara_XMAS_SnowGenerator") == true, "SpawnVertical")
			TNT1 A 0
			stop
		SpawnVertical:
			TNT1 A 1 A_CheckCeiling("StopMomentum")
			Loop
		StopMomentum:
			//TNT1 A 0 Sector_SetFade(0, 224, 224, 224)
			TNT1 A 0 A_ChangeVelocity(0,0,0,CVF_REPLACE)
			Goto SpawnSnow
		SpawnSnow:
			TNT1 A 0 A_JumpIf(CallACS("Samsara_XMAS_SnowCheck") == true, 1)
			Goto StopSnow
			TNT1 A 80 A_SpawnItemEx("Samsara_XMAS_Snow", 0, 0, 0, random(-1, 1), random(-1, 1), -1, 0, SXF_NOCHECKPOSITION|SXF_CLIENTSIDE)
			Loop
		StopSnow:
			TNT1 A 0
			stop
	}
}

Actor Samsara_XMAS_Snow
{
	+NOBLOCKMAP
	+NOCLIP
	+CLIENTSIDEONLY
	+NOINTERACTION
	RenderStyle Translucent
	Projectile
	Alpha 0.0
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_Jump(256, "Spawn1", "Spawn2", "Spawn3", "Spawn4")
			Goto Spawn1
		Spawn1:	
			XMA3 AAAAAAAAA 2 A_FadeIn(0.1)
			Goto SpawnLoop1
		SpawnLoop1:
			XMA3 A 2 A_CheckFloor("Remove1")
			Loop
		Remove1:
			XMA3 AAAAAAAAA 2 A_FadeOut(0.1)
			stop
		Spawn2:	
			XMA3 BBBBBBBBB 2 A_FadeIn(0.1)
			Goto SpawnLoop2
		SpawnLoop2:
			XMA3 B 2 A_CheckFloor("Remove2")
			Loop
		Remove2:
			XMA3 BBBBBBBBB 2 A_FadeOut(0.1)
			stop
		Spawn3:
			XMA3 CCCCCCCCC 2 A_FadeIn(0.1)
			Goto SpawnLoop3
		SpawnLoop3:
			XMA3 C 2 A_CheckFloor("Remove3")
			Loop
		Remove3:
			XMA3 CCCCCCCCC 2 A_FadeOut(0.1)
			stop
		Spawn4:
			XMA3 DDDDDDDDD 2 A_FadeIn(0.1)
			Goto SpawnLoop4
		SpawnLoop4:
			XMA3 D 2 A_CheckFloor("Remove4")
			Loop
		Remove4:
			XMA3 DDDDDDDDD 2 A_FadeOut(0.1)
			stop
	}
}

Actor XMasGift
{
	Height 24
	Radius 12
	Scale 0.25
	+SPECIAL
	States
	{
		Spawn:
			TNT1 A 0
			TNT1 A 0 A_Jump(256,"Box1","Box2","Box3","Box4","Box5")
		Box1:
			XMA4 A 5
			Goto SpawnLoop
		Box2:
			XMA5 A 5
			Goto SpawnLoop
		Box3:
			XMA6 A 5
			Goto SpawnLoop
		Box4:
			XMA7 A 5
			Goto SpawnLoop
		Box5:
			XMA8 A 5
			Goto SpawnLoop
		SpawnLoop:
			"####" A 2
			"####" A 2 A_CheckRange(28,"SpawnLoop")
		Open:
			"####" A 0 A_PlaySound("Samsara/OpenPresent",CHAN_5)
			"####" BC 2
			"####" D 0 ACS_NamedExecuteWithResult("Samsara_PinataHandler",health,accuracy,score,mass)
			"####" DEFGHIJ 2
			"####" J 350
			"####" J 1 A_Fadeout(0.05)
			wait
	}
}

Actor SamsaraXmasCoal : CustomInventory
{
	Inventory.PickupSound "Samsara/Naughty"
	Inventory.PickupMessage "You were naughty! Lump of coal for you!"
	Scale 0.1
	States
	{
		Spawn:
			XMA8 K -1
			Stop
		Pickup:
			TNT1 A 0 Thing_Damage(0,1)
			Stop
	}
}