Actor HLSqueakSpawned : HLBoolean {}
Actor HLSqueakHitWall : HLBoolean {}
Actor HLSqueakIsEvil : HLBoolean {}
Actor HLSqueak
{
	MONSTER
	-SOLID
	-TELESTOMP
	-TELEPORT
	-COUNTKILL
	+FRIENDLY
	+FLOORCLIP
	+THRUSPECIES
	+DROPOFF
	+LOOKALLAROUND
	+NEVERFAST
	Species "Squeak"
	ReactionTime 500
	Gravity 0.8
	Health 150
	Radius 9
	Height 15
	Mass 50
	Speed 7
	Tag "Snark"
	SeeSound "halflife/squeak_active"
	ActiveSound "halflife/squeak_active"
	DeathSound "halflife/squeak_die"
	Obituary "%o was killed by a squeak."
	BloodColor "99 FF 33"
	states
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 A_JumpIfInventory("HLSqueakSpawned",1,"SpawnDeploy")
		TNT1 A 0 A_GiveInventory("HLSqueakSpawned",1)
		TNT1 A 0 A_PlaySound("halflife/squeak_deploy",CHAN_BODY)
		HL03 ABCDEFGH 2 A_Recoil(-1)
		goto SpawnDeploy
	SpawnDeploy:
		TNT1 A 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
		TNT1 A 0 A_CountDown
		HL00 ABCD 1 A_Recoil(-1)
		HL00 E 0 A_CustomMissile("HLSqueakCheckHitObject",3,0,0,CMF_AIMDIRECTION,0)
		HL00 EFGH 1 A_Recoil(-1)
		HL00 I 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
		HL00 I 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
		HL00 IJKL 1 A_Recoil(-1)
		HL00 M 0 A_CustomMissile("HLSqueakCheckHitObject",3,0,0,CMF_AIMDIRECTION,0)
		HL00 MNOP 1 A_Recoil(-1)
		HL00 A 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
		loop
	SpawnFlip:
		TNT1 A 0 A_SetAngle(angle+180)
		TNT1 A 0 A_ChangeFlag("FRIENDLY",0)
		TNT1 A 0 A_GiveInventory("HLSqueakIsEvil",1)
		TNT1 A 0 A_TakeInventory("HLSqueakHitWall",999)
		goto SpawnDeploy
	See:
		HL02 ABCDEFGH 1 A_Chase
		HL02 A 0 A_ChangeFlag("FRIENDLY",0)
		TNT1 A 0 A_GiveInventory("HLSqueakIsEvil",1)
		TNT1 A 0 A_CountDown
		loop
	Melee:
		TNT1 A 0 A_JumpIfInventory("HLSqueakIsEvil",1,2)
		TNT1 A 0 A_ChangeFlag("FRIENDLY",1) //Keep seeking targets if enemy successfully attacked
		HL00 A 0 A_FaceTarget
		HL00 A 0 A_CustomMeleeAttack(random(10,15),"halflife/squeak_attack","halflife/squeak_attack","HLSqueak",1)
		HL00 A 0 A_Stop
		HL00 ABCD 1 ThrustThingZ(0,7,0,1)
		HL00 EFGHIJKLM 1 A_Recoil(random(10.0,15.0)/10.0)
		HL00 A 0 A_CountDown
		goto See
	Death:
	XDeath:
		TNT1 A 0 A_Scream
		TNT1 A 5 A_SpawnItemEx("HLSqueakSplat",0,0,0,0,0,0,0,SXF_CLIENTSIDE)
		stop
	}
}

Actor HLSqueakCoop : HLSqueak
{
	Species "Player"
	+DONTHARMCLASS
	+DONTHARMSPECIES
	+MTHRUSPECIES
	ReactionTime 2450	
	Speed 14	
	Health 1550	
	states
	{
	Spawn:
		TNT1 A 0
		TNT1 A 0 A_JumpIfInventory("HLSqueakSpawned",1,"SpawnDeploy")
		TNT1 A 0 A_GiveInventory("HLSqueakSpawned",1)
		TNT1 A 0 A_PlaySound("halflife/squeak_deploy",CHAN_BODY)
		HL03 ABCDEFGH 2 A_Recoil(-1)
		goto SpawnDeploy
	SpawnDeploy:
		TNT1 A 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
		TNT1 A 0 A_CountDown
		HL00 ABCD 1 A_Recoil(-1)
		HL00 E 0 A_CustomMissile("HLSqueakCheckHitObjectCoop",3,0,0,CMF_AIMDIRECTION,0)
		HL00 EFGH 1 A_Recoil(-1)
		HL00 I 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
		HL00 I 0 A_LookEx(LOF_NOSOUNDCHECK,0,512)
		HL00 IJKL 1 A_Recoil(-1)
		HL00 M 0 A_CustomMissile("HLSqueakCheckHitObjectCoop",3,0,0,CMF_AIMDIRECTION,0)
		HL00 MNOP 1 A_Recoil(-1)
		HL00 A 0 A_JumpIfInventory("HLSqueakHitWall",1,"SpawnFlip")
		loop
	SpawnFlip:
		TNT1 A 0 A_SetAngle(angle+180)
		TNT1 A 0 A_TakeInventory("HLSqueakHitWall",999)
		goto SpawnDeploy
	See:
		HL02 ABCDEFGH 1 A_Chase
		HL02 A 0 A_CountDown
		loop
	Melee:
		HL00 A 0 A_FaceTarget
		HL00 A 0 A_CustomMeleeAttack(random(10,15),"halflife/squeak_attack","halflife/squeak_attack","HLSqueak",1)
		HL00 A 0 A_Stop
		HL00 ABCD 1 ThrustThingZ(0,7,0,1)
		HL00 EFGHIJKLM 1 A_Recoil(random(10.0,15.0)/10.0)
		HL00 A 0 A_CountDown
		goto See
	Death:
	XDeath:
		TNT1 A 0 A_Scream
		TNT1 A 1 A_SpawnItemEx("HLSqueakSplat",0,0,0,0,0,0,0,SXF_CLIENTSIDE)
		stop
	}
}

Actor HLSqueakSplat
{
	+CLIENTSIDEONLY
	+NOINTERACTION
	-SOLID
	+NOBLOCKMAP
	scale 0.75
	states
	{
	Spawn:
		HGB9 ABCDEFGHIJ 1
		stop
	}
}

Actor HLSqueakCheckHitObject : BulletPuff
{
	Radius 4
	height 6
	Speed 30
	PROJECTILE
	+PUFFGETSOWNER
	+PUFFONACTORS
	+BLOODLESSIMPACT
	+NOBLOODDECALS
	+THRUSPECIES
	species "Squeak"
	States
	{
	Spawn:
		TNT1 A 1
		stop
	Death:
		TNT1 A 3 A_GiveToTarget("HLSqueakHitWall", 1)
		Stop
	}
}

Actor HLSqueakCheckHitObjectCoop : HLSqueakCheckHitObject
{
	species "Player"
	+THRUSPECIES
	+DONTHARMCLASS
	+DONTHARMSPECIES
	+MTHRUSPECIES
}

Actor freeman_uniqueselected : Inventory
{
	Inventory.MaxAmount 1
	+INVENTORY.IGNORESKILL
	+INVENTORY.UNDROPPABLE
	-INVENTORY.INVBAR
}

Actor freeman_holdscope : Inventory
{
	Inventory.MaxAmount 8
	+INVENTORY.IGNORESKILL
	+INVENTORY.UNDROPPABLE
	-INVENTORY.INVBAR
}

Actor "HL Squeaks" : HLWeapon
{
	Weapon.Slotnumber 9
	Weapon.SelectionOrder 1600
	Inventory.Pickupmessage "You found some squeaks!"
	Inventory.Pickupsound "halflife/weaponpickup"
	Weapon.AmmoType "HLSqueakAmmo"
	Weapon.AmmoGive 5
	Weapon.AmmoUse 1
	Tag "Squeaks"
	Inventory.RestrictedTo "HalfLifePlayer"	
	states
	{
	Spawn:
		HWU0 ABCDEFGHIJKLMNO 2 bright
		loop
	Select:
		TNT1 A 0 A_TakeInventory("freeman_fistselected",1)	
		TNT1 A 0 A_TakeInventory("freeman_pistolselected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot1selected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot2selected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot3selected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot4selected",1)
		TNT1 A 0 A_TakeInventory("freeman_slot6selected",1)
		TNT1 A 0 A_TakeInventory("freeman_slot7selected",1)		
		TNT1 A 0 A_TakeInventory("freeman_slot5selected",1)
		TNT1 A 0 A_TakeInventory("freeman_unique2selected",1)	
		TNT1 A 0 A_GiveInventory("freeman_uniqueselected",1)	
		Goto SelectLoop
	SelectLoop:	
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
		TNT1 A 1 A_Raise
		loop
	Deselect:
		TNT1 A 0 A_TakeInventory("freeman_uniqueselected",1)
		Goto DeselectLoop
	DeselectLoop:		
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
		TNT1 A 1 A_Lower
		loop
	Ready:
		TNT1 A 0 A_PlayWeaponSound("halflife/weaponselect")
		HW39 WXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
		HW40 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
		HW41 ABCDEFGHIJKLMNOPQRST 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)		
		TNT1 A 0
		goto WIdle
	WIdle:
		HW32 BBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZZ 1 A_WeaponReady
		HW33 AABBCCDDEE 1 A_WeaponReady 
		TNT1 A 0 A_Jump(5,"WIdle")
		TNT1 A 0 A_Jump(4,"WIdle")
		TNT1 A 0 A_Jump(3,"WIdle")
		TNT1 A 0 A_Jump(2,"WIdle")
		TNT1 A 0 A_Jump(1,"WIdle")		
		TNT1 A 0 A_Jump(20,"WIdle2","WIdle3")
		goto WIdle
	WIdle2:
		HW39 AA 1 A_WeaponReady
		HW35 YYZZ 1 A_WeaponReady
		HW36 AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZZ 1 A_WeaponReady
		HW37 AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZZ 1 A_WeaponReady
		HW38 AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZZ 1 A_WeaponReady
		goto WIdle
	WIdle3:
		HW33 FFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZZ 1 A_WeaponReady
		HW34 AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZZ 1 A_WeaponReady
		HW35 AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXX 1 A_WeaponReady
		HW35 WWVVUUTTSSRRQQPPOONNMMLLKKJJIIHHGGFFEEDDCCBBAA 1 A_WeaponReady		
		HW34 ZZXXWWVVUUTTSSRRQQPPOONNMMLLKKJJIIHHGGFFEEDDCCBBAA 1 A_WeaponReady				
		HW33 ZZXXWWVVUUTTSSRRQQPPOONNMMLLKKJJIIHHGGFF 1 A_WeaponReady				
		goto WIdle
	Fire:
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"FireCoop")
		HW41 UVWXYZ 1
		TNT1 A 0 A_SpawnItemEx("HLSqueak",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)		
		goto FireFinish
	FireCoop:
		HW41 UVWXYZ 1
		TNT1 A 0 A_SpawnItemEx("HLSqueakCoop",0,0,0,0,0,0,0,SXF_NOCHECKPOSITION)		
		goto FireFinish
	FireFinish:
		HW42 ABCDEFGHIJ 1
		TNT1 A 0 A_TakeInventory("HLSqueakAmmo", 1, TIF_NOTAKEINFINITE)
		TNT1 A 0 A_JumpIfInventory("HLSqueakAmmo", 1, "WIdle")
		TNT1 A 1
		TNT1 A 0 ACS_NamedExecuteAlways("Freeman_Squeak_Remove")
		stop
	}
}

Actor freeman_unique2selected : Inventory
{
	Inventory.MaxAmount 1
	+INVENTORY.IGNORESKILL
	+INVENTORY.UNDROPPABLE
	-INVENTORY.INVBAR
}

Actor HLXBowIsZoomed : Inventory
{
	Inventory.MaxAmount 1
	+INVENTORY.IGNORESKILL
	+INVENTORY.UNDROPPABLE
	-INVENTORY.INVBAR
}

Actor HLXBowAmmoCounter : Ammo
{
	+INVENTORY.IGNORESKILL
	Inventory.Amount 1
	Inventory.MaxAmount 5
}

Actor "HL Crossbow" : HLWeapon
{
	Weapon.Slotnumber 8
	Weapon.SelectionOrder 1500
	Inventory.Pickupmessage "You found a crossbow!"
	Inventory.Pickupsound "halflife/weaponpickup"
	Weapon.AmmoType "HLXBowAmmoCounter"
	Weapon.AmmoUse 0
	Weapon.AmmoGive 5
	+WEAPON.NOAUTOFIRE
	Tag "Crossbow"
	Inventory.RestrictedTo "HalfLifePlayer"	
	states
	{
	Spawn: 
		HW30 Z -1
		stop
	Select:
		TNT1 A 0 A_TakeInventory("freeman_fistselected",1)	
		TNT1 A 0 A_TakeInventory("freeman_pistolselected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot1selected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot2selected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot3selected",1)	
		TNT1 A 0 A_TakeInventory("freeman_slot4selected",1)
		TNT1 A 0 A_TakeInventory("freeman_slot6selected",1)
		TNT1 A 0 A_TakeInventory("freeman_slot7selected",1)		
		TNT1 A 0 A_TakeInventory("freeman_slot5selected",1)
		TNT1 A 0 A_TakeInventory("freeman_uniqueselected",1)
		TNT1 A 0 A_GiveInventory("freeman_unique2selected",1)				
	SelectLoop:	
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
		TNT1 A 1 A_Raise
		loop
	Deselect:
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, 2)
		TNT1 A 0 A_Jump(256,3)
		TNT1 A 0 A_TakeInventory("HLXBowIsZoomed", 1)
		TNT1 A 0 A_ZoomFactor(1.0,ZOOM_INSTANT)
		TNT1 A 0 A_TakeInventory("freeman_unique2selected",1)
	DeselectLoop:		
		TNT1 AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
		TNT1 A 1 A_Lower
		loop
	Ready:
		TNT1 A 0 A_PlayWeaponSound("halflife/weaponselect")
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, "WIdleZoomed")
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter",1,3)
		TNT1 A 0 A_JumpIfInventory("Shell",2,1)
		Goto Ready2
		TNT1 A 0
		Goto Reload
		HW59 WXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
		HW60 ABCDEFGHIJK 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
		TNT1 A 0
		goto WIdle
	Ready2:
		HW60 MNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
		HW61 AB 1 A_WeaponReady(WRF_NOBOB|WRF_NOFIRE)
		TNT1 A 0
		goto WIdle2_Ammoless
	WIdle:
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, "WIdleZoomed")
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter",1,3)
		TNT1 A 0 A_JumpIfInventory("Shell",2,1)
		Goto WIdle_Ammoless
		TNT1 A 0
		Goto Reload
		HW32 A 8 A_WeaponReady(WRF_ALLOWRELOAD)
		TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("Freeman_HoldAlt") == 1, "AltFire")
		TNT1 A 0 A_Jump(4,"WIdle")
		TNT1 A 0 A_Jump(3,"WIdle")
		TNT1 A 0 A_Jump(2,"WIdle")
		TNT1 A 0 A_Jump(1,"WIdle2","WIdle3")
		goto WIdle
	WIdleZoomed:
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, 1)
		Goto WIdle
		TNT1 A 8 A_WeaponReady(WRF_ALLOWRELOAD)
		TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("Freeman_HoldAlt") == 1, "AltFire")
		Loop
	WIdle_AmmoLessZoomed:
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, 1)
		Goto WIdle_Ammoless
		TNT1 A 8 A_WeaponReady(WRF_ALLOWRELOAD)
		Loop
	WIdle2:
		HW32 BCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW33 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW34 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW35 ABCDEFGHIJKLM 1 A_WeaponReady(WRF_ALLOWRELOAD)
		goto WIdle		
	WIdle3:
		HW36 STUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW37 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW38 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW39 ABCDEFGHIJKLMNOPQRSTU 1 A_WeaponReady(WRF_ALLOWRELOAD)
		goto WIdle
	WIdle_Ammoless:
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, "WIdle_AmmoLessZoomed")
		HW35 N 8 A_WeaponReady(WRF_ALLOWRELOAD)
		TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("Freeman_HoldAlt") == 1, "AltFire")
		TNT1 A 0 A_Jump(240,"WIdle2_Ammoless")
		goto Reload3
	WIdle2_Ammoless:
		HW35 OPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW36 ABCDEFGHIJKLMNOPQR 1 A_WeaponReady(WRF_ALLOWRELOAD)
		goto WIdle_Ammoless	
	Fire:
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, "FireZoomed")
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter", 2, 1)
		Goto FireLast
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"FireCoop")
		HW43 A 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		HW43 IJKLM 1
		HW43 N 0 A_FireCustomMissile("HLXbowBolt", 0, 0, 4)
		HW43 N 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		HW43 NOPQR 1
		HW43 S 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireFinish
	FireZoomed: // I'm just a lazy ass is what it is
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter", 2, 1)
		Goto FireLastZoomed
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"FireZoomedCoop")
		TNT1 A 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		TNT1 IJKLM 1
		TNT1 N 0 A_FireCustomMissile("HLXbowBolt", 0, 0, 4)
		TNT1 N 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		TNT1 NOPQR 1
		TNT1 S 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireFinishZoomed
	FireCoop:
		HW43 A 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		HW43 IJKLM 1
		HW43 N 0 A_FireCustomMissile("HLXbowBoltCoop", 0, 0, 4)
		HW43 N 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		HW43 NOPQR 1
		HW43 S 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireFinish
	FireZoomedCoop: // I'm just a lazy ass is what it is
		TNT1 A 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		TNT1 IJKLM 1
		TNT1 N 0 A_FireCustomMissile("HLXbowBoltCoop", 0, 0, 4)
		TNT1 N 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		TNT1 NOPQR 1
		TNT1 S 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireFinishZoomed
	FireFinish:
		HW43 STUVWXYZ 1
		HW44 A 0 A_JumpIfInventory("HLXBowAmmoCounter", 1, 1)
		goto Reload
		HW44 ACEGIKM 1
		HW44 OQSUWY 1
		HW45 ACEGIKM 1 A_WeaponReady(WRF_NOBOB)
		HW45 OQSUWY 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW46 ACEGIKMOQSUWY 1		
		HW47 ACEGIKM 1
		TNT1 A 0 A_Refire
		goto WIdle
	FireFinishZoomed:
		TNT1 STUVWXYZ 1
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter", 1, 1)
		goto ReloadZoomed
		TNT1 ACEGIKM 1
		TNT1 OQSUWY 1
		TNT1 ACEGIKM 1 A_WeaponReady(WRF_NOBOB)
		TNT1 OQSUWY 1 A_WeaponReady(WRF_ALLOWRELOAD)
		TNT1 ACEGIKMOQSUWY 1		
		TNT1 ACEGIKM 1
		TNT1 A 0 A_Refire
		goto WIdle
	FireLast:
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter", 1, 2)
		TNT1 A 0 A_PlayWeaponSound("halflife/weaponempty")
		Goto Reload
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"FireCoopLast")
		HW53 Y 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		HW53 YZ 1
		HW54 BCD 1
		HW54 E 0 A_FireCustomMissile("HLXbowBolt", 0, 0, 4)
		HW54 E 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		HW54 E 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireLastReload
	FireLastZoomed:
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter", 1, 1)
		Goto Reload
		TNT1 A 0 A_JumpIfInventory("CoopModeOn",1,"FireCoopLastZoomed")
		TNT1 Y 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		TNT1 YZ 1
		TNT1 BCD 1
		TNT1 E 0 A_FireCustomMissile("HLXbowBolt", 0, 0, 4)
		TNT1 E 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		TNT1 E 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireLastReload
	FireCoopLast:
		HW53 Y 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		HW53 YZ 1
		HW54 BCD 1
		HW54 E 0 A_FireCustomMissile("HLXbowBoltCoop", 0, 0, 4)
		HW54 E 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		HW54 E 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireLastReload
	FireCoopLastZoomed:
		TNT1 Y 0 A_PlaySound("HLXBow/Fire", CHAN_WEAPON)
		TNT1 YZ 1
		TNT1 BCD 1
		TNT1 E 0 A_FireCustomMissile("HLXbowBoltCoop", 0, 0, 4)
		TNT1 E 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		TNT1 E 0 A_TakeInventory("HLXBowAmmoCounter", 1)
		Goto FireLastReload
	FireLastReload:
		HW54 E 0 A_JumpIfInventory("HLXBowAmmoCounter",5,"WIdle")
		HW54 E 0 A_JumpIfInventory("Shell",2,"Reload2Success")
		goto WIdle
	Reload2Success:	
		HW54 E 0 A_JumpIfInventory("HLXBowIsZoomed", 1, 2)
		HW54 E 0 A_Jump(256,3)
		HW54 E 0 A_TakeInventory("HLXBowIsZoomed", 1)
		HW54 E 0 A_ZoomFactor(1.0,ZOOM_INSTANT)
		HW54 EFGHIJKLMNOQRSTUVWXYZ 1
		HW55 A 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		HW55 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW56 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW57 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW58 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW59 A 0
		goto Reload2Ammo
	Reload2Ammo:
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter",5,"Reload2Finish")
		TNT1 A 0 A_JumpIfInventory("Shell",2,1)
		goto Reload2Finish
		TNT1 A 0 A_GiveInventory("HLXBowAmmoCounter",1)
		TNT1 A 0 A_TakeInventory("Shell",2,TIF_NOTAKEINFINITE)
		loop
	Reload2Finish:
		HW59 ABCDEFGHIJKLMNOPQRSTU 1
		Goto WIdle
	AltFire:
		TNT1 A 0 A_JumpIfInventory("HLXBowIsZoomed", 1, "UnZoom")
		Goto Zoom
	Zoom:
		TNT1 A 0 A_GiveInventory("HLXBowIsZoomed", 1)
		TNT1 A 0 A_ZoomFactor(2.5,ZOOM_INSTANT)
		Goto WIdle
	UnZoom:
		TNT1 A 0 A_TakeInventory("HLXBowIsZoomed", 1)
		TNT1 A 0 A_ZoomFactor(1.0,ZOOM_INSTANT)
		Goto WIdle
	Reload:
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter",5,"WIdle")
		TNT1 A 0 A_JumpIfInventory("Shell",2,"Reload1Success")
		goto WIdle
	Reload1Success:
		HW47 O 0 A_JumpIfInventory("HLXBowIsZoomed", 1, 2)
		HW47 O 0 A_Jump(256,3)
		HW47 O 0 A_TakeInventory("HLXBowIsZoomed", 1)
		HW47 O 0 A_ZoomFactor(1.0,ZOOM_INSTANT)
		HW47 OPQRSTUVWXYZ 1
		HW48 A 0 A_PlaySound("HLXBow/Reload", CHAN_WEAPON)
		HW48 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW49 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW50 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW51 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		HW52 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1
		Goto Reload1Ammo
	Reload1Ammo:
		TNT1 A 0 A_JumpIfInventory("HLXBowAmmoCounter",5,"Reload1Finish")
		TNT1 A 0 A_JumpIfInventory("Shell",2,1)
		goto Reload1Finish
		TNT1 A 0 A_GiveInventory("HLXBowAmmoCounter",1)
		TNT1 A 0 A_TakeInventory("Shell",2,TIF_NOTAKEINFINITE)
		loop
	Reload1Finish:	
		HW53 ABCDEFGHIJKLMNOPQRSTUVWX 1	
		goto WIdle
	Reload3:
		HW39 VWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW40 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW41 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW42 ABCDEFGHIJKLMNOPQRSTUVWXYZ 1 A_WeaponReady(WRF_ALLOWRELOAD)
		HW43 ABCDEFGH 1 A_WeaponReady(WRF_ALLOWRELOAD)
		Goto WIdle
	}
}

Actor HLXBowSpark
{
	Radius 1
	Height 1
	+NOBLOCKMAP
	+THRUACTORS
	+NOGRAVITY
	+CLIENTSIDEONLY
	RenderStyle Add
	Scale 0.5
	States
	{
		Spawn:
			TNT1 A 0
			HWX4 A 3
			stop
	}
}

Actor HLXBowBolt
{
	PROJECTILE
    Radius 2
    Height 4
    Mass 5
    Speed 55
    Damage (100)
    DamageType "HLBullet"
	+NOEXTREMEDEATH
	+BLOODSPLATTER
	Scale 0.5
	states
	{
	Spawn:
		BOLT A 5 A_PlaySound("HLXbow/Fly", CHAN_6, 0.5, true)
		loop
	Crash:
		TNT1 A 0 A_StopSound(CHAN_6)
		TNT1 A 0 A_Playsound("HLXbow/Hit/Wall", CHAN_5)
		TNT1 A 0 A_Jump(128,1,2,3,4,5,6,7)		
		TNT1 AAAAAA 0 A_SpawnItemEx("HLPuffSpark",0,0,0,FRandom(1,4),0,Random(0,3),Random(-90,90))
		TNT1 A 0
		TNT1 A 0 A_SpawnItemEx("HLXBowSpark", 0, 0, 0, 0, 0, 0, 0, 288)
		TNT1 A 5
		stop
	Death:
		TNT1 A 0 A_CheckCeiling("Terminate")
		TNT1 A 0 A_CheckFloor("Terminate")
		TNT1 A 0 A_StopSound(CHAN_6)
		TNT1 A 0 A_Playsound("HLXbow/Hit/Wall", CHAN_5)
		TNT1 A 0 A_Jump(128,1,2,3,4,5,6,7)		
		TNT1 AAAAAA 0 A_SpawnItemEx("HLPuffSpark",0,0,0,FRandom(1,4),0,Random(0,3),Random(-90,90))
		TNT1 A 0
		TNT1 A 0 A_SpawnItemEx("HLXBowSpark", 0, 0, 0, 0, 0, 0, 0, 288)
		BOLT A 100
		stop
	XDeath:
		TNT1 A 0 A_StopSound(CHAN_6)
		TNT1 A 0 A_Playsound("HLXbow/Hit/Body", CHAN_5)
		TNT1 A 5
		stop
	Terminate:
		TNT1 A 0 A_StopSound(CHAN_6)
		TNT1 A 0 A_Playsound("HLXbow/Hit/Wall", CHAN_5)
		TNT1 A 0 A_Jump(128,1,2,3,4,5,6,7)
		TNT1 AAAAAA 0 A_SpawnItemEx("HLPuffSpark",0,0,0,FRandom(1,4),0,Random(0,3),Random(-90,90))
		TNT1 A 0
		TNT1 A 0 A_SpawnItemEx("HLXBowSpark", 0, 0, 0, 0, 0, 0, 0, 288)
		TNT1 A 5
		stop
	}
}

Actor HLXBowBoltCoop : HLXBowBolt { Species "Player" +THRUSPECIES Speed 60 }