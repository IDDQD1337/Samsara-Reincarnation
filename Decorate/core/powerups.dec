// Powerup Pickup Base
actor SamsaraPowerupPickup : CustomInventory
{
    RenderStyle "Add"
    +FLOATBOB
    +NOTIMEFREEZE // allow the checks and sprite to process during time freeze
    +QUIET
    +THRUACTORS // don't allow picking up until the checks are done
    States
    {
      // Spawn code
      Spawn:
        TNT1 A 0
      SpawnGameModeCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 19), "SpawnNothing") // Prevent spawning in LMS
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 29), "SpawnNothing") // Prevent spawning in instagib
      SpawnActualInit:
        TNT1 A 1 A_Jump(256,"SpawnActual")
        loop

      SpawnActual:
        TNT1 A 0
        stop

      SpawnNothing:
        TNT1 A 0
        stop

      // Pickup code
      Pickup:
        TNT1 A 0
        fail

      PickupFail:
        TNT1 A 0
        fail

      PickupStop:
        TNT1 A 0
        stop
    }
}

actor SamsaraPowerupPickupBlend : Trigger
{
    States
    {
      Pickup:
        TNT1 A 0 A_JumpIfInventory("PickupFlashesAreDisabled",1,"PickupStop")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupMarathon")
        TNT1 A 0 A_SetBlend("D7BA45",0.3,4)
        stop

      PickupMarathon:
        TNT1 A 0 A_SetBlend("Green",0.5,6)
        stop
    }
}

// Partial Invisibility
actor PartialInvisibility : SamsaraPowerupPickup
{
    Alpha 0.75
    +BIGPOWERUP
    +COUNTITEM
    +PICKUPFLASH
    +VISIBILITYPULSE
    States
    {
      Spawn:
        NVSI A 0 Bright Light("SAMSARA_INVISIBILITY") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 2)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualLoop:
        NVSI A 35 Bright Light("SAMSARA_INVISIBILITY") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 75)
        loop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDuke")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupHexen2")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("PortGhostly",0,"PickupFail")
        goto PickupDisplay

      PickupDuke:
        TNT1 A 0 A_JumpIfInventory("ItemHoloduke",0,"PickupFail")
        goto PickupDisplay

      PickupStrife:
        TNT1 A 0 A_JumpIfInventory("PortShadowArmor",0,"PickupFail")
        goto PickupDisplay

      PickupWitchaven:
        TNT1 A 0 A_JumpIfInventory("WTInvisibilityPhial",0,"PickupFail")
        goto PickupDisplay

      PickupPowerSlave:
        TNT1 A 0 A_JumpIfInventory("EyeOfSiaItem_EX",0,"PickupFail")
        goto PickupDisplay

      PickupQuake2:
        TNT1 A 0 A_JumpIfInventory("Q2Silencer",0,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("Q2DualFireDamage",0,"PickupFail")
        goto PickupDisplay

      PickupHexen2:
        TNT1 A 0 A_JumpIfInventory("PortGhostly2",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDisplayDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupDisplayQuake1")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupDisplayStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupDisplayWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupDisplayPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupDisplayQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupDisplayHexen2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("invisibilityget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayDuke:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayQuake1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraDecorate", 0, 25) //A_PlaySound("quake/invisannouncer",CHAN_7,1.0,false,ATTN_NONE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayStrife:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("strife/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayWitchaven:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gpickup/phial",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayPowerSlave:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 6)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Jon/FancyItemPick",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      // Bitterman's pickup messages need special treatment due to being given a random item.
      // This determines which item to jump to.
      PickupDisplayQuake2:
        TNT1 A 0 A_Jump(256,"PickupDisplayQuake2Silencer","PickupDisplayQuake2DualFireDamage")
      PickupDisplayQuake2Silencer:
        TNT1 A 0 A_JumpIfInventory("Q2Silencer",0,"PickupDisplayQuake2")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 7)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccessQuake2Silencer

      PickupDisplayQuake2DualFireDamage:
        TNT1 A 0 A_JumpIfInventory("Q2DualFireDamage",0,"PickupDisplayQuake2")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 8)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccessQuake2DualFireDamage

      PickupDisplayHexen2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, random(9,10))
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Hexen2/ArtifactPickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 11)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 0) //A_PlaySound("Quake3/Items/Invisibility",CHAN_6)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 2)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupSuccessMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupSuccessQuake1")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupSuccessStrife")
        TNT1 A 0 A_JumpIfInventory("RMRClass",1,"PickupSuccessRMR")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupSuccessWitchaven")
        TNT1 A 0 A_JumpIfInventory("HalfLifeClass",1,"PickupSuccessHalfLife")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupSuccessQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupSuccessHexen2")
        TNT1 A 0 A_JumpIfInventory("BondClass",1,"PickupSuccessGoldenEye")
        TNT1 A 0 A_JumpIfInventory("PainkillerClass",1,"PickupSuccessPainkiller")
        TNT1 A 0 A_JumpIfInventory("UnrealClass",1,"PickupSuccessUnreal")
        TNT1 A 0 A_JumpIfInventory("RTCWClass",1,"PickupSuccessRTCW")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DescentClass",1,"PickupSuccessDescent")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",1,"PickupSuccessDoom64")
        goto PickupSuccessDefault

      PickupSuccessDoom64:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucent")
        stop

      PickupSuccessStronghold:
        goto PickupSuccessDefault

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("PortGhostly")
        stop

      PickupSuccessHexen1:
        TNT1 A 0 A_GiveInventory("SamsaraPowerGhostGiver")
        stop

      PickupSuccessDuke:
        TNT1 A 0 A_GiveInventory("ItemHoloduke",3)
        stop

      PickupSuccessMarathon:
        TNT1 AA 0 A_GiveInventory("SamsaraPowerShadowGiver")
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowCumulativeLockGiver")
        stop

      PickupSuccessQuake1:
        TNT1 A 0 A_GiveInventory("QuakeInvisTimer",1050)
        stop

      PickupSuccessStrife:
        TNT1 A 0 A_GiveInventory("PortShadowArmor")
        stop

      PickupSuccessRMR:
        goto PickupSuccessDoom64

      PickupSuccessWitchaven:
        TNT1 A 0 A_GiveInventory("WTInvisibilityPhial")
        stop

      PickupSuccessHalfLife:
        goto PickupSuccessDoom64

      PickupSuccessPowerSlave:
        TNT1 A 0 A_GiveInventory("EyeOfSiaItem_EX")
        stop

      PickupSuccessQuake2:
        TNT1 A 0 A_Jump(256,"PickupSuccessQuake2Silencer","PickupSuccessQuake2DualFireDamage")
      PickupSuccessQuake2Silencer:
        TNT1 A 0 A_JumpIfInventory("Q2Silencer",0,"PickupSuccessQuake2")
        TNT1 A 0 A_GiveInventory("Q2Silencer")
        stop

      PickupSuccessQuake2DualFireDamage:
        TNT1 A 0 A_JumpIfInventory("Q2DualFireDamage",0,"PickupSuccessQuake2")
        TNT1 A 0 A_GiveInventory("Q2DualFireDamage")
        stop

      PickupSuccessHexen2:
        TNT1 A 0 A_GiveInventory("PortGhostly2")
        stop

      PickupSuccessGoldenEye:
        goto PickupSuccessDoom64

      PickupSuccessPainkiller:
        goto PickupSuccessDoom64

      PickupSuccessUnreal:
        goto PickupSuccessDoom64

      PickupSuccessRTCW:
        TNT1 A 0 A_TakeInventory("RTCW_Detection")
        goto PickupSuccessDoom64

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3InvisibilityCloak")
        stop

      PickupSuccessDescent:
        goto PickupSuccessDoom64

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverTranslucentDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 100)
        stop
    }
}

actor DoomPartialInvisibility : PartialInvisibility replaces BlurSphere {}
actor HereticPartialInvisibility : PartialInvisibility replaces ArtiInvisibility {}

actor SamsaraPowerInvisibilityGiver : SamsaraPowerupGiver { Powerup.Type "Invisibility" }
actor SamsaraPowerInvisibilityGiverTranslucent : SamsaraPowerInvisibilityGiver { Powerup.Mode "Translucent" } // Use this for 3D models
actor SamsaraPowerGhostGiver : SamsaraPowerupGiver { Powerup.Type "Ghost" }
actor SamsaraPowerShadowGiver : SamsaraPowerupGiver { Powerup.Type "Shadow" }

actor SamsaraPowerShadowCumulativeLockGiver : SamsaraPowerupGiver { Powerup.Type "ShadowCumulativeLock" }

actor PowerShadowCumulativeLock : Powerup
{
    Powerup.Duration -55
    +HUBPOWER
}

actor SamsaraPartialInvisibilityInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UseStrife")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseHexen2")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 1), "UseFail")
        goto UsePlaySound

      UseStrife:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 2), 1)
        goto UsePlaySound
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 0, 3), "UseFail") // not the best method, but it works
        goto UsePlaySound

      UsePowerSlave:
        goto UseHeretic

      UseHexen2:
        goto UseHeretic

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UsePlaySoundStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"UsePlaySoundWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePlaySoundPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UsePlaySoundHexen2")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundStrife:
        TNT1 A 0 A_PlaySound("strife/itempickup",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundWitchaven:
        TNT1 A 0 A_PlaySound("gplayer/drink",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundPowerSlave:
        TNT1 A 0 A_PlaySound("Jon/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen2:
        TNT1 A 0 A_PlaySound("Hexen2/ArtiUse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UseSuccessStrife")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"UseSuccessWitchaven")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UseSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseSuccessHexen2")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerGhostGiver")
        goto UseFinish

      UseSuccessStrife:
        TNT1 A 0 A_JumpIfInventory("PowerShadow",1,"UseSuccessStrifeSubsequent")
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowGiver")
        goto UseFinish

      UseSuccessStrifeSubsequent:
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowGiver")
        TNT1 A 0 A_GiveInventory("SamsaraPowerShadowCumulativeLockGiver")
        goto UseFinish

      UseSuccessWitchaven:
        TNT1 A 0 A_GiveInventory("SamsaraPowerInvisibilityGiverWitchaven")
        goto UseFinish

      UseSuccessPowerSlave:
        goto UseSuccessHeretic

      UseSuccessHexen2:
        goto UseSuccessHeretic

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor PortGhostly : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "ARTINVSI"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Shadowsphere"
}

actor QuakeInvisTimer: Counter {}

actor PortShadowArmor : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "I_SHDO"
    Inventory.MaxAmount 2
    Inventory.InterHubAmount 2
    Inventory.RestrictedTo "StrifeguyPlayer"
    Tag "Shadow Armor"
}

actor WTInvisibilityPhial : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "WIN0F0"
    Inventory.MaxAmount 10
    Inventory.InterHubAmount 10
    Inventory.RestrictedTo "GrondovalPlayer"
    Tag "Invisibility Potion"
}

actor SamsaraPowerInvisibilityGiverWitchaven : SamsaraPowerInvisibilityGiver { Powerup.Duration -30 }

actor EyeOfSiaItem_EX : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "_EX3E0"
    Inventory.MaxAmount 3
    Inventory.InterHubAmount 3
    Inventory.RestrictedTo "PSPlayer"
    Tag "Eye of Sia"
}

actor PortGhostly2 : SamsaraPartialInvisibilityInventory
{
    Inventory.Icon "H2INVT08"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "Demoness"
    Tag "Shadowsphere"
}

actor SamsaraPowerInvisibilityGiverTranslucentDeusEx1 : SamsaraPowerInvisibilityGiverTranslucent {}
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx2 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -75 }
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx3 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -90 }
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx4 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -105 }
actor SamsaraPowerInvisibilityGiverTranslucentDeusEx5 : SamsaraPowerInvisibilityGiverTranslucent { Powerup.Duration -120 }

/*
actor InvisTrail
{
    RenderStyle "Add"
    Alpha 0.35
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        NVSI A 2 A_FadeOut(0.125)
        loop
    }
}
*/

// Invulnerability
actor InvulnPowerup : SamsaraPowerupPickup
{
    Alpha 0.95
    +BIGPOWERUP
    +COUNTITEM
    +PICKUPFLASH
    States
    {
      Spawn:
        NVLN A 0 Bright Light("SAMSARA_INVULNERABILITY")
      SpawnGameModeCheck:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 28), "SpawnNothing")
        goto Super::SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualLoop:
        NVLN A 35 Bright Light("SAMSARA_INVULNERABILITY") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 95)
        loop

      Pickup:
      PickupInvuln: // TO REMOVE; I'VE GOT ANOTHER METHOD IN MIND
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupROTT")
        TNT1 A 0 A_JumpIfInventory("POGreedClass",1,"PickupIPOG")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupHexen2")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupCatacomb")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("PortRingInvuln",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        TNT1 A 0 A_JumpIfInventory("PortIconDefender",0,"PickupFail")
        goto PickupDisplay

      PickupROTT:
        TNT1 A 0 A_JumpIfInventory("GodProtection",1,"PickupFail")
        TNT1 A 0 A_JumpIfInventory("DogProtection",1,"PickupFail")
        goto PickupDisplay

      PickupIPOG:
        TNT1 A 0 A_JumpIfInventory("IPOGReversoPill",0,"PickupFail")
        goto PickupDisplay

      PickupPowerSlave:
        TNT1 A 0 A_JumpIfInventory("DivineScarab_Ex",0,"PickupFail")
        goto PickupDisplay

      PickupQuake2:
        TNT1 A 0 A_JumpIfInventory("Q2Invulnerability",0,"PickupFail")
        goto PickupDisplay

      PickupHexen2:
        TNT1 A 0 A_JumpIfInventory("PortIconDefender2",0,"PickupFail")
        goto PickupDisplay

      PickupCatacomb:
        TNT1 A 0 A_JumpIfInventory("Catacomb_Hourglass",1,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("Catacomb_HourglassCooldown",1,"PickupDisplay")
        goto PickupFail

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupDisplayQuake1")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupDisplayROTT")
        TNT1 A 0 A_JumpIfInventory("POGreedClass",1,"PickupDisplayIPOG")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupDisplayPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupDisplayQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupDisplayHexen2")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupDisplayCatacomb")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("invulnget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayQuake1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        // pickup sound handled through ACS
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      // ROTT's pickup messages need special treatment due to being given a random item.
      // This determines which item to jump to.
      PickupDisplayROTT:
        TNT1 A 0 A_Jump(256,"PickupDisplayROTTGodMode","PickupDisplayROTTDogMode")
      PickupDisplayROTTGodMode:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/godmode",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccessROTTGodMode

      PickupDisplayROTTDogMode:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/dogmode",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccessROTTDogMode

      PickupDisplayIPOG:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 6)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("greed/pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayPowerSlave:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 7)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Jon/SpecialItemPick",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayQuake2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 8)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayHexen2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, random(9,10))
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Hexen2/ArtifactPickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayCatacomb:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 11)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Catacomb/Hourglass",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 2, 12)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 1) //A_PlaySound("Quake3/Items/QuadDamage",CHAN_6)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 3)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupSuccessQuake1")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupSuccessROTT")
        TNT1 A 0 A_JumpIfInventory("C7Class",1,"PickupSuccessCorridor7")
        TNT1 A 0 A_JumpIfInventory("RMRClass",1,"PickupSuccessRMR")
        TNT1 A 0 A_JumpIfInventory("POGreedClass",1,"PickupSuccessIPOG")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupSuccessQuake2")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupSuccessHexen2")
        TNT1 A 0 A_JumpIfInventory("CatacombClass",1,"PickupSuccessCatacomb")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",1,"PickupSuccessDoom64")
        goto PickupSuccessDefault

      PickupSuccessDoom64:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDoom64")
        stop

      PickupSuccessStronghold:
        goto PickupSuccessDefault

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("PortRingInvuln")
        stop

      PickupSuccessHexen1:
        TNT1 A 0 A_GiveInventory("PortIconDefender")
        stop

      PickupSuccessDuke:
        TNT1 A 0 A_GiveInventory("DukeInvulnTaunt")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDuke")
        stop

      PickupSuccessQuake1:
        TNT1 A 0 A_GiveInventory("QuakePentTimer",1050)
        stop

      PickupSuccessROTT:
        TNT1 A 0 A_Jump(256,"PickupSuccessROTTGodMode","PickupSuccessROTTDogMode")
      PickupSuccessROTTGodMode:
        TNT1 A 0 A_GiveInventory("God Hand")
        TNT1 A 0 A_GiveInventory("GodProtection")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraROTTInvulnSwitchHack", 0) //A_SelectWeapon("God Hand")
        stop

      PickupSuccessROTTDogMode:
        TNT1 A 0 A_GiveInventory("Doggie")
        TNT1 A 0 A_GiveInventory("DogProtection")
        TNT1 A 0 ACS_NamedExecuteWithResult("RottDogModeHandler")
        TNT1 A 0 A_GiveInventory("DogMode")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraROTTInvulnSwitchHack", 1) //A_SelectWeapon("Doggie")
        stop

      PickupSuccessCorridor7:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverCorridor7")
        stop

      PickupSuccessRMR:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverRMR")
        stop

      PickupSuccessIPOG:
        TNT1 A 0 A_GiveInventory("IPOGReversoPill")
        stop

      PickupSuccessPowerSlave:
        TNT1 A 0 A_GiveInventory("DivineScarab_Ex")
        stop

      PickupSuccessQuake2:
        TNT1 A 0 A_GiveInventory("Q2Invulnerability")
        stop

      PickupSuccessHexen2:
        TNT1 A 0 A_GiveInventory("PortIconDefender2")
        stop

      PickupSuccessCatacomb:
        TNT1 A 0 A_GiveInventory("Catacomb_Hourglass")
        TNT1 A 0 A_JumpIfInventory("Catacomb_HourglassCooldown",1,1)
        stop
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraCatacombHourglassCooldownDecrement")
        stop

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3QuadDamageFactor")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 250)
        stop
    }
}

actor DoomInvulnPowerup : InvulnPowerup replaces InvulnerabilitySphere {}
actor HereticInvulnPowerup : InvulnPowerup replaces ArtiInvulnerability {}
actor HexenInvulnPowerup : InvulnPowerup replaces ArtiInvulnerability2 {}

actor SamsaraPowerFakeInvulnerableGiver : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerable"
    Powerup.Color "InverseMap"
}

actor PowerFakeInvulnerable : PowerProtection
{
    Powerup.Duration -30
    DamageFactor "Suicide", 1
    DamageFactor "Telefrag", 1
    DamageFactor "MarathonFusion", 1
    DamageFactor "Kamikaze", 1
    DamageFactor "ZorchKamikaze", 1
    DamageFactor "Normal", 0
}

actor SamsaraInvulnPowerupInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 0), "UseFail")
        goto UsePlaySound

      UseHexen1:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 1), "UseFail")
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 2), "UseFail")
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 1, 3), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePlaySoundPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UsePlaySoundHexen2")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundPowerSlave:
        TNT1 A 0 A_PlaySound("Jon/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen2:
        TNT1 A 0 A_PlaySound("Hexen2/ArtiUse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseSuccessHexen2")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverHeretic")
        goto UseFinish

      // Parias (Reincarnation/Classic) (Ghost Invulnerability)
      UseSuccessHexen1:
        TNT1 A 0 A_JumpIfInventory("HexenClassMode",3,"UseSuccessFighter")
        TNT1 A 0 A_JumpIfInventory("HexenClassMode",2,"UseSuccessMage")
      UseSuccessCleric:
        TNT1 A 0 A_JumpIfInventory("PowerFakeInvulnerableCleric",1,"UseSuccessClericSubsequent")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableMage")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverCleric")
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraHexenInvulnerabilityEffect", 0)
        goto UseFinish

      UseSuccessClericSubsequent:
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableMage")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverCleric")
        goto UseFinish

      // Daedolon (Reflective Invulnerability)
      UseSuccessMage:
        TNT1 A 0 A_JumpIfInventory("PowerFakeInvulnerableMage",1,"UseSuccessMageSubsequent")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableCleric")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverMage")
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraHexenInvulnerabilityEffect", 1)
        goto UseFinish

      UseSuccessMageSubsequent:
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableCleric")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableFighter")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverMage")
        goto UseFinish

      // Baratus (Normal Invulnerability)
      UseSuccessFighter:
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableCleric")
        TNT1 A 0 A_TakeInventory("PowerFakeInvulnerableMage")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverFighter")
        goto UseFinish

      UseSuccessHexen2:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFakeInvulnerableGiverHexen2")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraPowerFakeInvulnerableGiverDoom64 : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "White", 0.35 }

actor PortRingInvuln : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "ARTIINVU"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Ring of Invincibility"
}

actor SamsaraPowerFakeInvulnerableGiverHeretic : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "GoldMap" }

actor PortIconDefender : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "ARTIDFND"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "HexenPlayer"
    Tag "Icon of the Defender"
}

actor SamsaraPowerFakeInvulnerableGiverCleric : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerableCleric"
    Powerup.Color "Gray", 0.1
}

actor PowerFakeInvulnerableCleric : PowerFakeInvulnerable {}

actor SamsaraPowerFakeInvulnerableGiverMage : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerableMage"
    Powerup.Color "Gray", 0.1
}

actor PowerFakeInvulnerableMage : PowerFakeInvulnerable {}

actor SamsaraPowerFakeInvulnerableGiverFighter : SamsaraPowerupGiver
{
    Powerup.Type "FakeInvulnerableFighter"
    Powerup.Color "Gray", 0.1
}

actor PowerFakeInvulnerableFighter : PowerFakeInvulnerable {}

actor SamsaraPowerFakeInvulnerableGiverDuke : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "GoldMap" }

actor QuakePentTimer: Counter { Inventory.InterHubAmount 0 }

actor QuakePentagram : PowerFakeInvulnerable
{
    Powerup.Duration 0x7FFFFFFF
    Powerup.Color "FF 20 00", 0.15
}

actor SamsaraPowerFakeInvulnerableGiverCorridor7 : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "Yellow", 0.15 }

actor SamsaraPowerFakeInvulnerableGiverRMR : SamsaraPowerFakeInvulnerableGiver { Powerup.Colormap 0.0, 0.0, 0.0, 1.0, 0.0, 0.05 }

actor DivineScarab_Ex : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "_EX3F0"
    Inventory.MaxAmount 2
    Inventory.InterHubAmount 2
    Inventory.RestrictedTo "PSPlayer"
    Tag "Divine Scarab"
}

actor PortIconDefender2 : SamsaraInvulnPowerupInventory
{
    Inventory.Icon "H2INVT07"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "Demoness"
    Tag "Icon of the Defender"
}

actor SamsaraPowerFakeInvulnerableGiverHexen2 : SamsaraPowerFakeInvulnerableGiver { Powerup.Color "Gray", 0.1 }

actor SamsaraPowerFakeInvulnerableGiverDeusEx1 : SamsaraPowerFakeInvulnerableGiver {}
actor SamsaraPowerFakeInvulnerableGiverDeusEx2 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -37 }
actor SamsaraPowerFakeInvulnerableGiverDeusEx3 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -45 }
actor SamsaraPowerFakeInvulnerableGiverDeusEx4 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -53 }
actor SamsaraPowerFakeInvulnerableGiverDeusEx5 : SamsaraPowerFakeInvulnerableGiver { Powerup.Duration -60 }

/*
actor InvulnTrail
{
    RenderStyle "Add"
    Alpha 0.4
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        NVLN A 2 A_FadeOut(0.125)
        loop
    }
}
*/

// Environmental Protection
actor BioSuit : SamsaraPowerupPickup
{
    Alpha 0.95
    +PICKUPFLASH
    States
    {
      Spawn:
        RDST A 0 Bright Light("SAMSARA_BIOSUIT")
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualLoop:
        RDST A 35 Bright Light("SAMSARA_BIOSUIT") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 95)
        loop

      Pickup:
        //TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupStrife") // Unused; it was kind of a dumb idea to make the radiation suit an inventory item anyway
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupWitchaven")
        //TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupQuake2")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupStrife:
        TNT1 A 0 A_JumpIfInventory("PortEnviSuit",0,"PickupFail")
        goto PickupDisplay

      PickupWitchaven:
        TNT1 A 0 A_JumpIfInventory("WTFireProofPhial",0,"PickupFail")
        goto PickupDisplay

      PickupQuake2:
        TNT1 A 0 A_JumpIfInventory("Q2EnvironmentSuit",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupDisplayROTT")
        //TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupDisplayStrife")
        //TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupDisplayQuake2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("antisterileget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayROTT:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/asbestos",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayStrife:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("strife/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayQuake2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Q2Misc/Pickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 3, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 2) //A_PlaySound("Quake3/Items/BioSuit",CHAN_6)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("DoomguyClass",1,"PickupSuccessDoom")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupSuccessROTT")
        //TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"PickupSuccessStrife")
        TNT1 A 0 A_JumpIfInventory("KatarnClass",1,"PickupSuccessDarkForces")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"PickupSuccessWitchaven")
        //TNT1 A 0 A_JumpIfInventory("BittermanClass",1,"PickupSuccessQuake2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiver")
        stop

      PickupSuccessDoom:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupSuccessStronghold")
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",1,"PickupSuccessDoom64")
        goto PickupSuccessDefault

      PickupSuccessDoom64:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDoom64")
        stop

      PickupSuccessStronghold:
        goto PickupSuccessDefault

      PickupSuccessROTT:
        TNT1 A 0 A_JumpIfInventory("PowerIronFeetNoColor",1,"PickupSuccessROTTSubsequent")
        TNT1 A 0 A_TakeInventory("PowerBulletProofVest")
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverROTT")
        TNT1 A 0 A_GiveInventory("AsbestosArmor")
        TNT1 A 0 ACS_NamedExecuteWithResult("RottGasMask")
        stop

      PickupSuccessROTTSubsequent:
        TNT1 A 0 A_TakeInventory("PowerBulletProofVest")
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverROTT")
        TNT1 A 0 A_GiveInventory("AsbestosArmor")
        stop

      PickupSuccessStrife:
        TNT1 A 0 A_GiveInventory("PortEnviSuit")
        stop

      PickupSuccessDarkForces:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverNoColor")
        stop

      PickupSuccessWitchaven:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiver")
        TNT1 A 0 A_GiveInventory("WTFireProofPhial")
        stop

      PickupSuccessQuake2:
        TNT1 A 0 A_GiveInventory("Q2EnvironmentSuit")
        stop

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3BattleSuitProtection")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        stop
    }
}

actor DoomBioSuit : BioSuit replaces RadSuit {}
actor ChexBioSuit : BioSuit replaces SlimeProofSuit {}

actor SamsaraPowerIronFeetGiver : SamsaraPowerupGiver { Powerup.Type "IronFeet" }
actor SamsaraPowerIronFeetGiverNoColor : SamsaraPowerupGiver { Powerup.Type "IronFeetNoColor" }
actor SamsaraPowerMaskGiver : SamsaraPowerupGiver { Powerup.Type "Mask" }

actor PowerIronFeetNoColor : PowerIronFeet { Powerup.Color "Green", 0 } // can't remove the color in PowerupGiver, so a powerup-inherited actor it is

actor SamsaraBioSuitInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 2, 0), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("StrifeClass",1,"UsePlaySoundStrife")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundStrife:
        TNT1 A 0 A_PlaySound("strife/itempickup",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerIronFeetGiver")
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraPowerIronFeetGiverDoom64 : SamsaraPowerIronFeetGiver { Powerup.Color "Green", 0.15 }

actor SamsaraPowerIronFeetGiverROTT : SamsaraPowerIronFeetGiverNoColor { Powerup.Duration -45 }

actor PortEnviSuit : SamsaraBioSuitInventory
{
    Inventory.Icon "I_GASM"
    Inventory.MaxAmount 5
    Inventory.InterHubAmount 5
    Inventory.RestrictedTo "StrifeguyPlayer"
    Tag "Environmental Suit"
}

actor WTFireProofPhial : PowerupGiver
{
    Inventory.UseSound "gplayer/drink"
    Inventory.Icon "WIN0D0"
    Inventory.MaxAmount 10
    Inventory.InterHubAmount 10
    Inventory.RestrictedTo "GrondovalPlayer"
    Powerup.Type "WTFireProof"
    Powerup.Color "OrangeRed", 0.25
    Tag "Fire Immunity Potion"
    +UNDROPPABLE
}

actor PowerWTFireProof : PowerProtection
{
    Powerup.Duration -30
    DamageFactor "Fire", 0
    DamageFactor "MarathonFire", 0
    DamageFactor "MarathonPlasmaFire", 0
    DamageFactor "WolfenFlamethrower", 0
    DamageFactor "TotenkopfFire", 0
    DamageFactor "CalebFire", 0
    DamageFactor "LifeLeech", 0
    DamageFactor "FireExplosive", 0
    DamageFactor "Hexen2Fire", 0
    DamageFactor "DoomDamageTypeFire", 0
    DamageFactor "DoomDamageTypeFireExplosive", 0
    DamageFactor "RottFire", 0
    DamageFactor "WTRangedFire", 0
    DamageFactor "DeusExFlamed", 0
    DamageFactor "PSFire", 0
    DamageFactor "SWFlame", 0
    DamageFactor "PGFire", 0
    DamageFactor "PainkillerFire", 0
    DamageFactor "QuakeFire", 0
    DamageFactor "RTCWFire", 0
    DamageFactor "HexGreenFire", 0
    DamageFactor "PhosFire", 0
    DamageFactor "PhosFireCoop", 0
    DamageFactor "EradGreenFire", 0
    DamageFactor "EradCoopGreenFire", 0
    DamageFactor "SWFlame", 0
    DamageFactor "SWFlame2", 0
    DamageFactor "SWFlame2Coop", 0
    DamageFactor "SWFlame3", 0
}

actor SamsaraPowerIronFeetGiverDeusEx1 : SamsaraPowerIronFeetGiver {}
actor SamsaraPowerIronFeetGiverDeusEx2 : SamsaraPowerIronFeetGiver { Powerup.Duration -75 }
actor SamsaraPowerIronFeetGiverDeusEx3 : SamsaraPowerIronFeetGiver { Powerup.Duration -90 }
actor SamsaraPowerIronFeetGiverDeusEx4 : SamsaraPowerIronFeetGiver { Powerup.Duration -105 }
actor SamsaraPowerIronFeetGiverDeusEx5 : SamsaraPowerIronFeetGiver { Powerup.Duration -120 }

/*
actor BioTrail
{
    RenderStyle "Add"
    Alpha 0.4
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        RDST A 2 A_FadeOut(0.125)
        loop
    }
}
*/

// Light Amplification
actor Visor : SamsaraPowerupPickup
{
    Alpha 0.85
    +PICKUPFLASH
    States
    {
      Spawn:
        VISR A 0 Bright Light("SAMSARA_VISOR") NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 1)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualLoop:
        VISR A 20 Bright Light("SAMSARA_VISOR") ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 85)
        VISR A 20 Light("SAMSARA_VISOR")
        loop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDuke")
        TNT1 A 0 A_JumpIfInventory("CalebClass",1,"PickupBlood")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupHexen2")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("PortTorch",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDuke:
        TNT1 A 0 A_JumpIfInventory("DukePortNiVi",1,1)
        goto PickupDisplay
        TNT1 A 0 A_JumpIfInventory("DukeVisionFuel",0,"PickupFail")
        goto PickupDisplay

      PickupBlood:
        TNT1 A 0 A_JumpIfInventory("BeastVision",1,"PickupFail")
        goto PickupDisplay

      PickupPowerSlave:
        TNT1 A 0 A_JumpIfInventory("LighterofGumercindo_EX",0,"PickupFail")
        goto PickupDisplay

      PickupHexen2:
        TNT1 A 0 A_JumpIfInventory("PortTorch3",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupDisplayDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupDisplayROTT")
        TNT1 A 0 A_JumpIfInventory("CalebClass",1,"PickupDisplayBlood")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupDisplayPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupDisplayHexen2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupDisplayQuake3")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("lettherebelight",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayDuke:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 2)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("duke/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayROTT:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("gen/vest",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayBlood:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Caleb/Powerup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayPowerSlave:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Jon/NoramItemPick",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen2:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, random(6,7))
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("Hexen2/ArtifactPickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayQuake3:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 5, 8)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer", 0, 3) //A_PlaySound("Quake3/Items/Haste",CHAN_6)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"PickupSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupSuccessMarathon")
        TNT1 A 0 A_JumpIfInventory("RottClass",1,"PickupSuccessROTT")
        TNT1 A 0 A_JumpIfInventory("CalebClass",1,"PickupSuccessBlood")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"PickupSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"PickupSuccessHexen2")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSuccessQuake3")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiver")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("PortTorch")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic

      PickupSuccessDuke:
        TNT1 A 0 A_GiveInventory("DukePortNiVi")
        TNT1 A 0 A_GiveInventory("DukeVisionFuel",100)
        stop

      PickupSuccessMarathon:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverMarathon")
        stop

      PickupSuccessROTT:
        TNT1 A 0 A_TakeInventory("PowerIronFeetNoColor")
        TNT1 A 0 A_TakeInventory("PowerAsbestosArmor")
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiver")
        TNT1 A 0 A_GiveInventory("BulletProofVest")
        stop

      PickupSuccessBlood:
        TNT1 A 0 A_GiveInventory("BeastVision")
        stop

      PickupSuccessPowerSlave:
        TNT1 A 0 A_GiveInventory("LighterofGumercindo_EX")
        stop

      PickupSuccessHexen2:
        TNT1 A 0 A_GiveInventory("PortTorch3")
        stop

      PickupSuccessQuake3:
        TNT1 A 0 A_GiveInventory("Q3HasteTurbo")
        stop

      PickupSuccessDeusEx:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 23)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"PickupSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"PickupSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"PickupSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"PickupSuccessDeusExTrained")
      PickupSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx1")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx2")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx3")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx4")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiverDeusEx5")
        goto PickupSuccessDeusExFinish

      PickupSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        stop
    }
}

actor DoomVisor : Visor replaces Infrared {}

actor ChexVisor : Visor 2045 //replaces UltraGoggles
{
    Game Chex
    SpawnID 138
}

actor RavenVisor : Visor replaces ArtiTorch {}

actor SamsaraPowerLightAmpGiver : SamsaraPowerupGiver { Powerup.Type "LightAmp" }
actor SamsaraPowerTorchGiver : SamsaraPowerupGiver { Powerup.Type "Torch" }

actor SamsaraVisorInventory : CustomInventory
{
    Inventory.UseSound ""
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseHexen2")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 3, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 3, 1), "UseFail")
        goto UsePlaySound

      UseHexen1:
        goto UseHeretic

      UsePowerSlave:
        goto UseHeretic

      UseHexen2:
        goto UseHeretic

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UsePlaySoundPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UsePlaySoundHexen2")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundPowerSlave:
        TNT1 A 0 A_PlaySound("Jon/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen2:
        TNT1 A 0 A_PlaySound("Hexen2/ArtiUse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("JonClass",1,"UseSuccessPowerSlave")
        TNT1 A 0 A_JumpIfInventory("Hexen2Class",1,"UseSuccessHexen2")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLightAmpGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerTorchGiver")
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessPowerSlave:
        goto UseSuccessHeretic

      UseSuccessHexen2:
        goto UseSuccessHeretic

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor PortTorch : SamsaraVisorInventory
{
    Inventory.Icon "ARTITRCH"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Torch"
}

actor SamsaraPowerLightAmpGiverMarathon : SamsaraPowerLightAmpGiver { Powerup.Color "BlueMap" }

actor LighterofGumercindo_EX : SamsaraVisorInventory
{
    Inventory.Icon "_EX3D0"
    Inventory.MaxAmount 6
    Inventory.InterHubAmount 6
    Inventory.RestrictedTo "PSPlayer"
    Tag "Lighter of Gumercindo"
}

actor PortTorch3 : SamsaraVisorInventory
{
    Inventory.Icon "H2INVT03"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.RestrictedTo "Demoness"
    Tag "Torch"
}

actor SamsaraPowerLightAmpGiverDeusEx1 : SamsaraPowerLightAmpGiver {}
actor SamsaraPowerLightAmpGiverDeusEx2 : SamsaraPowerLightAmpGiver { Powerup.Duration -150 }
actor SamsaraPowerLightAmpGiverDeusEx3 : SamsaraPowerLightAmpGiver { Powerup.Duration -180 }
actor SamsaraPowerLightAmpGiverDeusEx4 : SamsaraPowerLightAmpGiver { Powerup.Duration -210 }
actor SamsaraPowerLightAmpGiverDeusEx5 : SamsaraPowerLightAmpGiver { Powerup.Duration -240 }

/*
actor VisorTrail
{
    RenderStyle "Add"
    Alpha 0.4
    Scale 0.95
    +CLIENTSIDEONLY
    +NOINTERACTION
    States
    {
      Spawn:
        VISR A 2 A_FadeOut(0.125)
        loop
    }
}
*/

actor SamsaraAllmap : SamsaraPowerupPickup
{
    Alpha 0.85
    +COUNTITEM
    +PICKUPFLASH
    States
    {
      Spawn:
        AMAP A 0 Bright NoDelay ACS_NamedExecuteWithResult("Samsara_SwitchableObject", 0)
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
      SpawnActualLoop:
        AMAP ABCDCB 6 Bright //A_SpawnItemEx("VisorTrail",0,0,2.5,0,0,0,0,128)
        loop

      Pickup:
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 6, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("igotamap",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("Allmap")
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraMapRevealerPickup")
        stop
    }
}

actor SamsaraDoomAllmap : SamsaraAllmap replaces Allmap {}
actor SamsaraChexAllmap : SamsaraAllmap replaces ComputerAreaMap {}
actor SamsaraHereticAllmap : SamsaraAllmap replaces SuperMap {}

// Heretic Powerups

// Strength
actor SamsaraLesserTome : SamsaraPowerupPickup
{
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    +COUNTITEM
    +PICKUPFLASH
    States
    {
      Spawn:
        CPRT J 0 Bright Light("SAMSARA_HERETICSTRENGTH")
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT J -1 Bright Light("SAMSARA_HERETICSTRENGTH") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraLesserTomeInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraLesserTomeInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("tome/lesser",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 16, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 9)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraLesserTomeInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraLesserTomeInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraHereticLesserTome : SamsaraLesserTome replaces ArtiTomeOfPower {}

actor SamsaraPowerLesserTomeGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraLesserTome"
    Powerup.Color "Red", 0.1
}

actor PowerSamsaraLesserTome : PowerDamage
{
    Powerup.Duration -30
    DamageFactor "Normal", 2
}

actor SamsaraLesserTomeInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTIPWR1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Strength"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 5, 0), "UseFail")
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiver")
        goto UseFinish

      UseSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"UseSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"UseSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"UseSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"UseSuccessDeusExTrained")
      UseSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx1")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx2")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx3")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx4")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerLesserTomeGiverDeusEx5")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraLesserTomeInventoryRaven : SamsaraLesserTomeInventory
{
    Inventory.Icon "ARTITOM2"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Novice's Tome of Strength"
}

actor SamsaraPowerLesserTomeGiverDeusEx1 : SamsaraPowerLesserTomeGiver {}
actor SamsaraPowerLesserTomeGiverDeusEx2 : SamsaraPowerLesserTomeGiver { Powerup.Duration -37 }
actor SamsaraPowerLesserTomeGiverDeusEx3 : SamsaraPowerLesserTomeGiver { Powerup.Duration -45 }
actor SamsaraPowerLesserTomeGiverDeusEx4 : SamsaraPowerLesserTomeGiver { Powerup.Duration -53 }
actor SamsaraPowerLesserTomeGiverDeusEx5 : SamsaraPowerLesserTomeGiver { Powerup.Duration -60 }

// Teleportation
actor SamsaraTeleportPickup : SamsaraPowerupPickup
{
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    +COUNTITEM
    +PICKUPFLASH
    States
    {
      Spawn:
        CPRT I 0 Bright Light("SAMSARA_TELEPORTATION")
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT I -1 Bright Light("SAMSARA_TELEPORTATION") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportPickupInventoryHeretic",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportPickupInventoryHexen1",0,"PickupFail")
        goto PickupDisplay

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("teleportpickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 15, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryHeretic")
        stop

      PickupSuccessHexen1:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryHexen1")
        stop
    }
}

actor SamsaraRavenTeleportPickup : SamsaraTeleportPickup replaces ArtiTeleport {}

actor SamsaraTeleportPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTITEL1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Teleportation"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryEffect")
        goto UseFinish

      UseSuccessDeusEx:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportPickupInventoryEffect")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraTeleportPickupInventoryHeretic : SamsaraTeleportPickupInventory
{
    Inventory.Icon "ARTITEL2"
    Inventory.RestrictedTo "CorvusPlayer"
    Tag "Chaos Device"
}

actor SamsaraTeleportPickupInventoryHexen1 : SamsaraTeleportPickupInventory
{
    Inventory.Icon "ARTITEL3"
    Inventory.RestrictedTo "HexenPlayer"
    Tag "Chaos Device"
}

actor SamsaraTeleportPickupInventoryEffect : ArtiTeleport
{
    Inventory.UseSound ""
    Inventory.MaxAmount 1
    +ALWAYSPICKUP
    +AUTOACTIVATE
    -INVBAR
}

// Flight
actor SamsaraFlightPickup : SamsaraPowerupPickup
{
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    //+COUNTITEM // leave this off for hexen
    +PICKUPFLASH
    States
    {
      Spawn:
        CPRT K 0 Bright Light("SAMSARA_FLIGHT")
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT K -1 Bright Light("SAMSARA_FLIGHT") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraFlightPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraFlightPickupInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("flightpickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 14, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraFlightPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraFlightPickupInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraRavenFlightPickup : SamsaraFlightPickup replaces ArtiFly {}

actor SamsaraPowerFlightGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraFlight"
    Powerup.Color "Yellow", 0.1
}

actor PowerSamsaraFlight : PowerFlight { Inventory.Icon "TNT1A0" } // can't use ""

// Online games need this because for some reason, the powerup won't
// last forever in Hexen netgames like it's supposed to.
actor SamsaraPowerFlightGiverInfinite : SamsaraPowerFlightGiver
{
    Powerup.Duration 0x7FFFFFFD
    Powerup.Color "Yellow", 0
}

actor SamsaraPowerFlightInfiniteHUDDummyGiver : SamsaraPowerupGiver { Powerup.Type "SamsaraFlightInfiniteHUDDummy" } // in case some custom HUD wants to hide the timer for hexen

actor PowerSamsaraFlightInfiniteHUDDummy : Powerup
{
    Powerup.Duration 0x7FFFFFFD
    +HUBPOWER
}

actor SamsaraFlightPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTISOR1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Flight"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 6, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 6, 1), "UseFail")
        goto UsePlaySound

      UseHexen1:
        goto UseHeretic

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DukeClass",1,"UseSuccessDuke")
        TNT1 A 0 A_JumpIfInventory("RMRClass",1,"UseSuccessRMR")
        TNT1 A 0 A_JumpIfInventory("WitchavenClass",1,"UseSuccessWitchaven")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 49) == 8, "UseSuccessDefaultInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiver")
        goto UseFinish

      UseSuccessDefaultInfinite:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightInfiniteHUDDummyGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 49) == 8, "UseSuccessHereticInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverRaven")
        goto UseFinish

      UseSuccessHereticInfinite:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverRavenInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightInfiniteHUDDummyGiver")
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessDuke:
        TNT1 A 0 A_JumpIfInventory("DukeFlying",1,1)
        goto UseSuccessDefault
        TNT1 A 0 A_PlaySound("duke/jetpackoff",CHAN_ITEM)
        TNT1 A 0 A_GiveInventory("DukeJetPackIdleRemover")
        TNT1 A 0 A_TakeInventory("DukeFlying")
        TNT1 A 0 A_JumpIfInventory("SamsaraHasInfiniteInventory",1,2)
        TNT1 A 0 A_TakeInventory("DukeJetpackFuel",1)
        TNT1 A 0 A_TakeInventory("DukePetjack")
        goto UseSuccessDefault

      UseSuccessRMR:
        TNT1 A 0 A_TakeInventory("PowerRMRFlyAbility")
        TNT1 A 0 A_TakeInventory("PowerRMRFlyAbilityHack")
        goto UseSuccessDefault

      UseSuccessWitchaven:
        TNT1 A 0 A_TakeInventory("PowerWTSpellFly")
        TNT1 A 0 A_TakeInventory("PowerWTSpellFlyHack")
        goto UseSuccessDefault

      UseSuccessDeusEx:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraDecorate", 49) == 8, "UseSuccessDeusExInfinite")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"UseSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"UseSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"UseSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"UseSuccessDeusExTrained")
      UseSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx1")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx2")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx3")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx4")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverDeusEx5")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExInfinite:
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightGiverInfinite")
        TNT1 A 0 A_GiveInventory("SamsaraPowerFlightInfiniteHUDDummyGiver")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraFlightPickupInventoryRaven : SamsaraFlightPickupInventory
{
    Inventory.Icon "ARTISOR2"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Wings of Wrath"
}

actor SamsaraPowerFlightGiverRaven : SamsaraPowerupGiver { Powerup.Type "SamsaraFlightRaven" }

actor PowerSamsaraFlightRaven : PowerFlight { Inventory.Icon "HERFLY0" }

actor SamsaraPowerFlightGiverDeusEx1 : SamsaraPowerFlightGiver {}
actor SamsaraPowerFlightGiverDeusEx2 : SamsaraPowerFlightGiver { Powerup.Duration -75 }
actor SamsaraPowerFlightGiverDeusEx3 : SamsaraPowerFlightGiver { Powerup.Duration -90 }
actor SamsaraPowerFlightGiverDeusEx4 : SamsaraPowerFlightGiver { Powerup.Duration -105 }
actor SamsaraPowerFlightGiverDeusEx5 : SamsaraPowerFlightGiver { Powerup.Duration -120 }

actor SamsaraPowerFlightGiverRavenInfinite : SamsaraPowerFlightGiverRaven { Powerup.Duration 0x7FFFFFFD }

// Hexen Powerups

// Haste
actor SamsaraSpeedBootsPickup : SamsaraPowerupPickup
{
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    +COUNTITEM
    +PICKUPFLASH
    States
    {
      Spawn:
        CPRT H 0 Bright Light("SAMSARA_HEXENHASTE")
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT H -1 Bright Light("SAMSARA_HEXENHASTE") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexenbootspickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 10)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraSpeedBootsPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraSpeedBootsPickupInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraHexenSpeedBootsPickup : SamsaraSpeedBootsPickup replaces ArtiSpeedBoots {}

actor SamsaraPowerSpeedBootsGiver : SamsaraPowerupGiver
{
    Powerup.Type "SamsaraSpeedBoots"
    Powerup.Color "Orange", 0.1
}

actor PowerSamsaraSpeedBoots : PowerSpeed { Inventory.Icon "" }

actor SamsaraSpeedBootsPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTIHST1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Haste"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseHexen1")
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 7, 0), "UseFail")
        goto UsePlaySound

      UseHeretic:
        TNT1 A 0 A_JumpIf(CallACS("SamsaraPowerupTimerActiveChecker", 7, 1), "UseFail")
        goto UsePlaySound

      UseHexen1:
        goto UseHeretic

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiver")
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverRaven")
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessDeusEx:
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",0,"UseSuccessDeusExMaster")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",3,"UseSuccessDeusExAdvanced")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",2,"UseSuccessDeusExProficient")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill",1,"UseSuccessDeusExTrained")
      UseSuccessDeusExUntrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx1")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExTrained:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx2")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExProficient:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx3")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExAdvanced:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx4")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExMaster:
        TNT1 A 0 A_GiveInventory("SamsaraPowerSpeedBootsGiverDeusEx5")
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraSpeedBootsPickupInventoryRaven : SamsaraSpeedBootsPickupInventory
{
    Inventory.Icon "ARTISPD"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Boots of Speed"
}

actor SamsaraPowerSpeedBootsGiverRaven : SamsaraPowerupGiver { Powerup.Type "SamsaraSpeedBootsRaven" }

actor PowerSamsaraSpeedBootsRaven : PowerSpeed { Inventory.Icon "HXSPD0" }

actor SamsaraPowerSpeedBootsGiverDeusEx1 : SamsaraPowerSpeedBootsGiver {}
actor SamsaraPowerSpeedBootsGiverDeusEx2 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -56 }
actor SamsaraPowerSpeedBootsGiverDeusEx3 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -68 }
actor SamsaraPowerSpeedBootsGiverDeusEx4 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -79 }
actor SamsaraPowerSpeedBootsGiverDeusEx5 : SamsaraPowerSpeedBootsGiver { Powerup.Duration -90 }

// Banishment
actor SamsaraTeleportOtherPickup : SamsaraPowerupPickup
{
    RenderStyle "Normal"
    //Alpha 0.95
    Scale 0.5
    +COUNTITEM
    +PICKUPFLASH
    States
    {
      Spawn:
        CPRT G 0 Bright Light("SAMSARA_BANISHMENT")
        goto SpawnGameModeCheck

      SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        CPRT G -1 Bright Light("SAMSARA_BANISHMENT") A_ChangeFlag("NOTIMEFREEZE",false)
        stop

      Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen1")
        TNT1 A 0 A_Jump(256,"PickupDefault") // for inheriting actors
        goto PickupDefault

      PickupDefault:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportOtherPickupInventory",0,"PickupFail")
        goto PickupDisplay

      PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("SamsaraTeleportOtherPickupInventoryRaven",0,"PickupFail")
        goto PickupDisplay

      PickupHexen1:
        goto PickupHeretic

      PickupDisplay:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupDisplayHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupDisplayHexen1")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupDisplayMarathon")
        TNT1 A 0 A_Jump(256,"PickupDisplayDefault") // for inheriting actors
        goto PickupDisplayDefault

      PickupDisplayDefault:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("teleportotherpickup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHeretic:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayHexen1:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupDisplayMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 20, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        goto PickupSuccess

      PickupSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupSuccessHexen1")
        TNT1 A 0 A_Jump(256,"PickupSuccessDefault") // for inheriting actors
        goto PickupSuccessDefault

      PickupSuccessDefault:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherPickupInventory")
        stop

      PickupSuccessHeretic:
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherPickupInventoryRaven")
        stop

      PickupSuccessHexen1:
        goto PickupSuccessHeretic
    }
}

actor SamsaraHexenTeleportOtherPickup : SamsaraTeleportOtherPickup replaces ArtiTeleportOther {}

actor SamsaraTeleportOtherPickupInventory : CustomInventory
{
    Inventory.UseSound ""
    Inventory.Icon "ARTIBAN1"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.ForbiddenTo "CorvusPlayer", "HexenPlayer"
    Tag "Banishment"
    +INVBAR
    +UNDROPPABLE
    States
    {
      Use:
        TNT1 A 0 A_Jump(256,"UseDefault") // for inheriting actors
        goto UseDefault

      UseDefault:
        goto UsePlaySound

      UsePlaySound:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UsePlaySoundHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UsePlaySoundHexen1")
        TNT1 A 0 A_Jump(256,"UsePlaySoundDefault") // for inheriting actors
        goto UsePlaySoundDefault

      UsePlaySoundDefault:
        TNT1 A 0 A_PlaySound("samsaraitemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHeretic:
        TNT1 A 0 A_PlaySound("heretic/itemuse",CHAN_ITEM)
        goto UseSuccess

      UsePlaySoundHexen1:
        TNT1 A 0 A_PlaySound("hexen/artiuse",CHAN_ITEM)
        goto UseSuccess

      UseSuccess:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"UseSuccessHeretic")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"UseSuccessHexen1")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"UseSuccessDeusEx")
        TNT1 A 0 A_Jump(256,"UseSuccessDefault") // for inheriting actors
        goto UseSuccessDefault

      UseSuccessDefault:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1",0,false)
        goto UseFinish

      UseSuccessHeretic:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1Raven",0,false)
        goto UseFinish

      UseSuccessHexen1:
        goto UseSuccessHeretic

      UseSuccessDeusEx:
        TNT1 A 0 A_FireCustomMissile("SamsaraTeleportOtherFX1",0,false)
        goto UseSuccessDeusExFinish

      UseSuccessDeusExFinish:
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        goto UseFinish

      UseFinish:
        TNT1 A 0 A_RailWait
        stop

      UseFail:
        TNT1 A 0
        fail
    }
}

actor SamsaraTeleportOtherPickupInventoryRaven : SamsaraTeleportOtherPickupInventory
{
    Inventory.Icon "ARTIBAN2"
    Inventory.RestrictedTo "CorvusPlayer", "HexenPlayer"
    Tag "Banishment Device"
}

actor SamsaraTeleportOtherFXCounter : Counter { Inventory.MaxAmount 2 }

actor SamsaraTeleportOtherFX1 : TelOtherFX1
{
    States
    {
      Spawn:
        TRNG J 5 Bright Light("SAMSARA_BANISHMENTFX")
        TRNG I 4 Bright Light("SAMSARA_BANISHMENTFX")
      SpawnLoop: // Spawn+2
        TRNG H 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX4",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG G 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX3",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG F 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX2",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG G 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX3",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG H 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX4",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG I 3 Bright Light("SAMSARA_BANISHMENTFX") A_SpawnItemEx("SamsaraTeleportOtherFX5",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        loop

      Death:
        TRNG J 3 Bright Light("SAMSARA_BANISHMENTFX")
        stop
    }
}

actor SamsaraTeleportOtherFX2 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG GHIHG 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG F 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX3 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG HIHGF 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG G 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX4 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG IHGFG 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG H 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX5 : SamsaraTeleportOtherFX1
{
    Speed 16
    States
    {
      Spawn:
        TRNG HGFGH 4 Bright Light("SAMSARA_BANISHMENTFX")
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG I 4 Bright Light("SAMSARA_BANISHMENTFX") A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX1Raven : TelOtherFX1
{
    States
    {
      Spawn:
        TRNG E 5 Bright
        TRNG D 4 Bright
      SpawnLoop: // Spawn+2
        TRNG C 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX4Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG B 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX3Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG A 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX2Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG B 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX3Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG C 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX4Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        TRNG D 3 Bright A_SpawnItemEx("SamsaraTeleportOtherFX5Raven",0,0,0,velx/2,vely/2,velz/2,angle,SXF_ABSOLUTEANGLE|SXF_ABSOLUTEVELOCITY|SXF_TRANSFERPOINTERS)
        loop

      Death:
        TRNG E 3 Bright
        stop
    }
}

actor SamsaraTeleportOtherFX2Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG BCDCB 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG A 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX3Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG CDCBA 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG B 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX4Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG DCBAB 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG C 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

actor SamsaraTeleportOtherFX5Raven : SamsaraTeleportOtherFX1Raven
{
    Speed 16
    States
    {
      Spawn:
        TRNG CBABC 4 Bright
        TNT1 A 0 A_GiveInventory("SamsaraTeleportOtherFXCounter")
        TRNG D 4 Bright A_JumpIfInventory("SamsaraTeleportOtherFXCounter",0,"Death")
        loop
    }
}

// Skulltag Powerups
Actor InvisibilitySphere : CustomInventory 5035
{
    Renderstyle "Normal"
    Alpha 0.95
    Scale 0.5
    +FLOATBOB
    +INVENTORY.PICKUPFLASH
    +INVENTORY.BIGPOWERUP
    +COUNTITEM
    +INVENTORY.QUIET
    +NOGRAVITY
    //Inventory.PickupMessage "$SAMSARA_SKULLTAG_INVIS"
    Inventory.PickupSound "nosoundforyoubitch"
    States
    {
    Spawn:
        CPRT L 0 BRIGHT
        CPRT L 35 BRIGHT
        wait
    Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupCorvus")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupGhost")
        TNT1 A 0 A_JumpIfInventory("MarathonClass",1,"PickupMarathon")
        TNT1 A 0 A_JumpIfInventory("QuakeClass",1,"PickupQuake")
        TNT1 A 0 A_JumpIfInventory("RTCWClass",1,"PickupRTCW")
        TNT1 A 0 A_JumpIfInventory("Q3Class",1,"PickupSarge")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupDeusEx")
        TNT1 A -1 A_Jump(256,"PickupNormal")
        wait
        
    PickupNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("fullinvisibilityget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityNormalGiver")
        stop
    PickupGhost:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("fullinvisibilityget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityGhostGiver")
        stop
    PickupCorvus:
        TNT1 A 0 A_JumpIfInventory("InvisibilitySphereHeretic",0,"PickupFail")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 1 A_GiveInventory("InvisibilitySphereHeretic")
        stop
    PickupMarathon:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 0 A_GiveInventory("SamsaraPowerFullInvisibilityShadowGiver")
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityShadowGiver")
        stop
    PickupQuake:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 3)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraDecorate",0,25,0,0)    //TNT1 A 0 A_PlaySoundEx("quake/invisannouncer","soundslot7",0,2)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 0 A_GiveInventory("QuakeInvisTimer", 1050)
        TNT1 A 1
        stop
    PickupRTCW:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("fullinvisibilityget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 0 A_TakeInventory("RTCW_Detection")
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityNormalGiver")
        stop
    PickupSarge:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 0, 11)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteAlways("Q3_Announcer",0,0,0,0) //TNT1 A 0 A_PlaySound("Quake3/Items/Invisibility", CHAN_6)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 1 A_GiveInventory("Q3InvisibilityCloak",1)
        stop
    PickupDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 9, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate",23)
        TNT1 A 0 A_PlaySound("fullinvisibilityget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 4)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityNormalGiver")
        stop
    PickupDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityDXEnviro1Giver")
        stop
    PickupDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityDXEnviro2Giver")
        stop
    PickupDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityDXEnviro3Giver")
        stop
    PickupDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerFullInvisibilityDXEnviro4Giver")
        stop
    PickupFail:
        CPRT L 1 BRIGHT
        fail
    }
}

Actor SamsaraPowerFullInvisibilityNormal : PowerInvisibility { +SHADOW Powerup.Duration -45 Powerup.Strength 90 Powerup.Mode "Translucent" }
Actor SamsaraPowerFullInvisibilityGhost : PowerGhost { +GHOST Powerup.Duration -45 Powerup.Strength 68 Powerup.Mode "None" }
Actor SamsaraPowerFullInvisibilityShadow : PowerShadow { Powerup.Duration -40 Powerup.Strength 84 Powerup.Mode "Cumulative" }

Actor SamsaraPowerFullInvisibilityNormalGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerFullInvisibilityNormal
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerFullInvisibilityGhostGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerFullInvisibilityGhost
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerFullInvisibilityShadowGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerFullInvisibilityShadow
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

actor InvisibilitySphereHeretic : PowerupGiver
{
    tag "Ring of Obscurity"
    Inventory.MaxAmount 16
    Inventory.InterHubAmount 16
    Inventory.UseSound "heretic/itemuse"
    +inventory.undroppable
    +inventory.hubpower
    Inventory.Icon "ARTIIVRG"
    Inventory.RestrictedTo "CorvusPlayer"
    Powerup.Type SamsaraPowerFullInvisibilityGhost
}

Actor SamsaraPowerFullInvisibilityDXEnviro1 : PowerInvisibility { +SHADOW Powerup.Duration -56 Powerup.Strength 90 Powerup.Mode "Translucent" }
Actor SamsaraPowerFullInvisibilityDXEnviro2 : PowerInvisibility { +SHADOW Powerup.Duration -68 Powerup.Strength 90 Powerup.Mode "Translucent" }
Actor SamsaraPowerFullInvisibilityDXEnviro3 : PowerInvisibility { +SHADOW Powerup.Duration -79 Powerup.Strength 90 Powerup.Mode "Translucent" }
Actor SamsaraPowerFullInvisibilityDXEnviro4 : PowerInvisibility { +SHADOW Powerup.Duration -90 Powerup.Strength 90 Powerup.Mode "Translucent" }

Actor SamsaraPowerFullInvisibilityDXEnviro1Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerFullInvisibilityDXEnviro1
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerFullInvisibilityDXEnviro2Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerFullInvisibilityDXEnviro2
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerFullInvisibilityDXEnviro3Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerFullInvisibilityDXEnviro3
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerFullInvisibilityDXEnviro4Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerFullInvisibilityDXEnviro4
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor TimeFreezeSphere : InvulnPowerup 5032
{
    Game Doom
    SpawnID 171
    Inventory.PickupMessage "$PICKUP_TIMEFREEZER"
    RenderStyle Normal
    Alpha 0.95
    Scale 0.5
    -BIGPOWERUP
    +NOGRAVITY
    -PICKUPFLASH
    -NOTIMEFREEZE // to remove
    -THRUACTORS // to remove
    States
    {
    Spawn:
        CPRT M 0 A_JumpIf(ACS_NamedExecuteWithResult("SamsaraDecorate",28,0,0) == 1, "NoInvuln")
        CPRT M 35 BRIGHT
        wait
    Pickup:
        TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("SamsaraDecorate", 38), "PickupInvuln")
    PickupTimeFreeze:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupTimeFreezeDoomguyStr")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupTimeFreezeCorvus")
        TNT1 A -1 A_Jump(256,"PickupTimeFreezeNormal")
        wait

    PickupTimeFreezeNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("timefreezeget",CHAN_ITEM|CHAN_MAYBE_LOCAL|CHAN_NOPAUSE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezeNormalGiver")
        Stop
    PickupTimeFreezeDoomguyStr:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("timefreezeget",CHAN_ITEM|CHAN_MAYBE_LOCAL|CHAN_NOPAUSE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezeStrongholdGiver")
        Stop
    PickupTimeFreezeCorvus:
        TNT1 A 0 A_JumpIfInventory("TimeFreezeSphereHeretic",0,"PickupFail")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 A_GiveInventory("TimeFreezeSphereHeretic")
        Stop
    PickupTimeFreezeDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("timefreezeget",CHAN_ITEM|CHAN_MAYBE_LOCAL|CHAN_NOPAUSE)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupTimeFreezeDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupTimeFreezeDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupTimeFreezeDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupTimeFreezeDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeNormalGiver")
        stop
    PickupTimeFreezeDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro1Giver")
        stop
    PickupTimeFreezeDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro2Giver")
        stop
    PickupTimeFreezeDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro3Giver")
        stop
    PickupTimeFreezeDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro4Giver")
        stop
    PickupFail:
        CPRT M 1 bright
        Fail
    }
}

Actor SamsaraPowerTimeFreezeNormal : PowerTimeFreezer { Powerup.Duration -12 Powerup.Color GoldMap }
Actor SamsaraPowerTimeFreezeStronghold : PowerTimeFreezer { Powerup.Duration -12 Powerup.Color "00 33 FF", 0.1 }

Actor SamsaraPowerTimeFreezeNormalGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerTimeFreezeNormal
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerTimeFreezeStrongholdGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerTimeFreezeStronghold
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

actor TimeFreezeSphereHeretic : PowerupGiver
{
    Inventory.RestrictedTo "CorvusPlayer"
    Inventory.MaxAmount 16
    Inventory.UseSound "heretic/itemuse"
    +Inventory.UNDROPPABLE
    +Inventory.HUBPOWER
    Inventory.Icon "ARTISTP2"
    Powerup.Type SamsaraPowerTimeFreezeNormal
    Tag "Hourglass of D'Sparil"
}

Actor SamsaraPowerTimeFreezeDXEnviro1 : PowerTimeFreezer { Powerup.Duration -15 Powerup.Color GoldMap }
Actor SamsaraPowerTimeFreezeDXEnviro2 : PowerTimeFreezer { Powerup.Duration -18 Powerup.Color GoldMap }
Actor SamsaraPowerTimeFreezeDXEnviro3 : PowerTimeFreezer { Powerup.Duration -21 Powerup.Color GoldMap }
Actor SamsaraPowerTimeFreezeDXEnviro4 : PowerTimeFreezer { Powerup.Duration -24 Powerup.Color GoldMap }

Actor SamsaraPowerTimeFreezeDXEnviro1Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerTimeFreezeDXEnviro1
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerTimeFreezeDXEnviro2Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerTimeFreezeDXEnviro2
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerTimeFreezeDXEnviro3Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerTimeFreezeDXEnviro3
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerTimeFreezeDXEnviro4Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerTimeFreezeDXEnviro4
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

actor Turbosphere : CustomInventory 5030
{
    Game Doom
    SpawnID 169
    Renderstyle "Normal"
    Alpha 0.95
    Scale 0.5
    +FLOATBOB
    +INVENTORY.PICKUPFLASH
    +INVENTORY.BIGPOWERUP
    +COUNTITEM
    +INVENTORY.QUIET
    +NOGRAVITY
    //Inventory.PickupMessage "$SAMSARA_SKULLTAG_TURBO"
    Inventory.PickupSound "nosoundforyoubitch"
    States
    {
    Spawn:
        CPRT O 0 BRIGHT
        CPRT O 35 BRIGHT
        wait

    Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass", 1, "CheckCorvus")
        TNT1 A 0 A_JumpIfInventory("HexenClass", 1, "CheckHexen")
        TNT1 A -1 A_Jump(256,"PickupActual")
        wait
    CheckCorvus:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven", 0, "PickupFail")
        goto PickupActual
    CheckHexen:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven", 0, "PickupFail")
        goto PickupActual
    PickupActual:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupCorvus")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupDeusEx")
        TNT1 A -1 A_Jump(256,"PickupNormal")
        wait
    PickupNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterNormalGiver")
        stop
    PickupCorvus:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 1 A_GiveInventory("SamsaraSpeedBootsPickupInventoryRaven")
        stop
    PickupHexen:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 1 A_GiveInventory("SamsaraSpeedBootsPickupInventoryRaven")
        stop
    PickupDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate",23)
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterNormalGiver")
        stop
    PickupDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro1Giver")
        stop
    PickupDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro2Giver")
        stop
    PickupDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro3Giver")
        stop
    PickupDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro4Giver")
        stop
    PickupFail:
        CPRT O 1 bright
        Fail
    }
}

Actor SamsaraPowerSpeedBoosterNormal : PowerSpeed { Inventory.Icon "TNT1A0" Powerup.Color Purple 0.1 Speed 2.0 Powerup.Duration -30 }
Actor SamsaraPowerSpeedBoosterDXEnviro1 : PowerSpeed { Inventory.Icon "TNT1A0" Powerup.Color Purple 0.1 Speed 2.0 Powerup.Duration -37 }
Actor SamsaraPowerSpeedBoosterDXEnviro2 : PowerSpeed { Inventory.Icon "TNT1A0" Powerup.Color Purple 0.1 Speed 2.0 Powerup.Duration -45 }
Actor SamsaraPowerSpeedBoosterDXEnviro3 : PowerSpeed { Inventory.Icon "TNT1A0" Powerup.Color Purple 0.1 Speed 2.0 Powerup.Duration -53 }
Actor SamsaraPowerSpeedBoosterDXEnviro4 : PowerSpeed { Inventory.Icon "TNT1A0" Powerup.Color Purple 0.1 Speed 2.0 Powerup.Duration -60 }

Actor SamsaraPowerSpeedBoosterNormalGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerSpeedBoosterNormal
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerSpeedBoosterDXEnviro1Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerSpeedBoosterDXEnviro1
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerSpeedBoosterDXEnviro2Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerSpeedBoosterDXEnviro2
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerSpeedBoosterDXEnviro3Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerSpeedBoosterDXEnviro3
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerSpeedBoosterDXEnviro4Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerSpeedBoosterDXEnviro4
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

actor Guardsphere : CustomInventory 5037
{
    Game Doom
    SpawnID 0
    Renderstyle "Normal"
    Alpha 0.95
    Scale 0.5
    +FLOATBOB
    +INVENTORY.PICKUPFLASH
    +INVENTORY.BIGPOWERUP
    +COUNTITEM
    +INVENTORY.QUIET
    +NOGRAVITY
    //Inventory.PickupMessage "$SAMSARA_SKULLTAG_GUARD"
    Inventory.PickupSound "nosoundforyoubitch"
    States
    {
    Spawn:
        CPRT P 0 BRIGHT
        CPRT P 35 BRIGHT
        wait
    Pickup:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupDoomguyStr")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupCorvus")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupDeusEx")
        TNT1 A -1 A_Jump(256,"PickupNormal")
        wait

    PickupNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 12, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 7)
        TNT1 A 1 A_GiveInventory("SamsaraPowerDefenseBoosterNormalGiver")
        stop
    PickupDoomguyStr:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 12, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 7)
        TNT1 A 1 A_GiveInventory("SamsaraPowerDefenseBoosterStrongholdGiver")
        stop
    PickupCorvus:
        TNT1 A 0 A_JumpIfInventory("GuardsphereHeretic",0,"PickupFail")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 12, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 7)
        TNT1 A 1 A_GiveInventory("GuardsphereHeretic")
        stop
    PickupDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 12, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate",23)
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 7)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 250)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerDefenseBoosterNormalGiver")
        stop
    PickupDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDefenseBoosterDXEnviro1Giver")
        stop
    PickupDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDefenseBoosterDXEnviro2Giver")
        stop
    PickupDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDefenseBoosterDXEnviro3Giver")
        stop
    PickupDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDefenseBoosterDXEnviro4Giver")
        stop
    PickupFail:
        CPRT P 1 bright
        Fail
    }
}

Actor SamsaraPowerDefenseBoosterNormal : PowerProtection { Powerup.Color GreenMap, 0.5 DamageFactor "Normal", 0.25 Powerup.Duration -25 }
Actor SamsaraPowerDefenseBoosterStronghold : PowerProtection { Powerup.Color "FF AA 00", 0.1 DamageFactor "Normal", 0.25 Powerup.Duration -25 }

Actor SamsaraPowerDefenseBoosterNormalGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDefenseBoosterNormal
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerDefenseBoosterStrongholdGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDefenseBoosterStronghold
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

actor GuardsphereHeretic : PowerupGiver
{
    Inventory.RestrictedTo "CorvusPlayer"
    Inventory.MaxAmount 16
    Inventory.UseSound "heretic/itemuse"
    +Inventory.UNDROPPABLE
    +Inventory.HUBPOWER
    Inventory.Icon "ARTISTP5"
    Powerup.Type SamsaraPowerDefenseBoosterNormal
    Tag "Hellish Cuirass"
}

Actor SamsaraPowerDefenseBoosterDXEnviro1 : PowerProtection { Powerup.Color GreenMap, 0.5 DamageFactor "Normal", 0.25 Powerup.Duration -31 }
Actor SamsaraPowerDefenseBoosterDXEnviro2 : PowerProtection { Powerup.Color GreenMap, 0.5 DamageFactor "Normal", 0.25 Powerup.Duration -38 }
Actor SamsaraPowerDefenseBoosterDXEnviro3 : PowerProtection { Powerup.Color GreenMap, 0.5 DamageFactor "Normal", 0.25 Powerup.Duration -44 }
Actor SamsaraPowerDefenseBoosterDXEnviro4 : PowerProtection { Powerup.Color GreenMap, 0.5 DamageFactor "Normal", 0.25 Powerup.Duration -50 }

Actor SamsaraPowerDefenseBoosterDXEnviro1Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDefenseBoosterDXEnviro1
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerDefenseBoosterDXEnviro2Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDefenseBoosterDXEnviro2
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerDefenseBoosterDXEnviro3Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDefenseBoosterDXEnviro3
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerDefenseBoosterDXEnviro4Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDefenseBoosterDXEnviro4
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

actor Doomsphere : CustomInventory 5036
{
    Game Doom
    SpawnID 175
    Renderstyle "Normal"
    Alpha 0.95
    Scale 0.5
    +FLOATBOB
    +INVENTORY.PICKUPFLASH
    +INVENTORY.BIGPOWERUP
    +COUNTITEM
    +INVENTORY.QUIET
    +NOGRAVITY
    //Inventory.PickupMessage "$SAMSARA_SKULLTAG_DOOM"
    Inventory.PickupSound "nosoundforyoubitch"
    States
    {
    Spawn:
        CPRT N 0 BRIGHT
        CPRT N 35 BRIGHT
        wait
    Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupCorvus")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupDeusEx")
        TNT1 A -1 A_Jump(256,"PickupNormal")
        wait

    PickupNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterNormalGiver")
        stop
    PickupCorvus:
        TNT1 A 0 A_JumpIfInventory("DoomsphereHeretic",0,"PickupFail")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        TNT1 A 1 A_GiveInventory("DoomsphereHeretic")
        stop
    PickupDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate",23)
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 250)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterNormalGiver")
        stop
    PickupDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro1Giver")
        stop
    PickupDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro2Giver")
        stop
    PickupDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro3Giver")
        stop
    PickupDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro4Giver")
        stop
    PickupFail:
        CPRT N 1 bright
        Fail
    }
}

Actor SamsaraPowerDamageBoosterNormal : PowerDamage { Powerup.Color "27 27 38", 0.5 DamageFactor "Normal", 4.0 Powerup.Duration -25 }

Actor SamsaraPowerDamageBoosterNormalGiver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDamageBoosterNormal
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

actor DoomsphereHeretic : PowerupGiver
{
    Inventory.RestrictedTo "CorvusPlayer"
    Inventory.MaxAmount 16
    Inventory.UseSound "heretic/itemuse"
    +Inventory.UNDROPPABLE
    +Inventory.HUBPOWER
    Inventory.Icon "ARTISTP4"
    Powerup.Type SamsaraPowerDamageBoosterNormal
    Tag "Master's Tome of Strength"
}

Actor SamsaraPowerDamageBoosterDXEnviro1 : PowerDamage { Powerup.Color "27 27 38", 0.5 DamageFactor "Normal", 4.0 Powerup.Duration -31 }
Actor SamsaraPowerDamageBoosterDXEnviro2 : PowerDamage { Powerup.Color "27 27 38", 0.5 DamageFactor "Normal", 4.0 Powerup.Duration -38 }
Actor SamsaraPowerDamageBoosterDXEnviro3 : PowerDamage { Powerup.Color "27 27 38", 0.5 DamageFactor "Normal", 4.0 Powerup.Duration -44 }
Actor SamsaraPowerDamageBoosterDXEnviro4 : PowerDamage { Powerup.Color "27 27 38", 0.5 DamageFactor "Normal", 4.0 Powerup.Duration -50 }

Actor SamsaraPowerDamageBoosterDXEnviro1Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDamageBoosterDXEnviro1
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerDamageBoosterDXEnviro2Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDamageBoosterDXEnviro2
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerDamageBoosterDXEnviro3Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDamageBoosterDXEnviro3
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

Actor SamsaraPowerDamageBoosterDXEnviro4Giver : PowerupGiver
{
    Inventory.MaxAmount 0
    Powerup.Type SamsaraPowerDamageBoosterDXEnviro4
    +INVENTORY.AUTOACTIVATE
    +INVENTORY.ALWAYSPICKUP
    States
    {
    Spawn:
        TNT1 A 2
        loop
    }
}

/*
    Zandronum's random powerup item has the player get an item that corresponds to the
    sprite, so if they picked up a random powerup that switched to the Megasphere's
    sprite, than they will get the megasphere. In order to keep things simple internally,
    Samsara has the player get a randomly chosen powerup, even if they picked it up 48 tics later.
    This removes the strategization that can come from waiting for a desired powerup, but it
    makes things way easier to handle for programming, especially with future updates.
*/

Actor RandomPowerup : CustomInventory 5039 //replaces RandomPowerup
{
    Game Doom
    SpawnID 176
    RenderStyle Add
    Alpha 0.95
    Scale 0.75
    +NOGRAVITY
    +FLOATBOB
    +INVENTORY.PICKUPFLASH
    +COUNTITEM
    +INVENTORY.QUIET
    Inventory.PickupSound "nosoundforyoubitch"
    States
    {
    Spawn:
        STPQ A 0
        STPQ A 35 BRIGHT ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 95)
        wait
    Pickup:
        TNT1 A -1 A_Jump(256, "PickupMegasphere", "PickupSoulsphere", "PickupGuardsphere", "PickupPartialInvisibility", "PickupTimeFreezeSphere", "PickupInvisibilitySphere", "PickupDoomsphere", "PickupTurbosphere")
        wait
    PickupMegasphere:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupMegaPack", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupSoulsphere:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupSuperHealth", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupGuardsphere:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupGuardsphere", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupPartialInvisibility:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupPartialInvisibility", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupTimeFreezeSphere:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupTimeFreezeSphere", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupInvisibilitySphere:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupInvisibilitySphere", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupDoomsphere:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupDoomsphere", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupTurbosphere:
        TNT1 A 0 A_SpawnItemEx("SamsaraRandomPowerupTurbosphere", 0, 0, 0, 0, 0, 0, 0)
        STPQ A 2 BRIGHT
        stop
    PickupFail:
        STPQ A 1 BRIGHT
        fail
    }
}

Actor SamsaraRandomPowerupMegaPack : MegaPack
{
    -COUNTITEM
    States
    {
    Spawn:
        TNT1 A 0
        goto SpawnGameModeCheck
    SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
        TNT1 A 2
        wait
    PickupFail:
        TNT1 A 1
        fail
    }
}

Actor SamsaraRandomPowerupSuperHealth : SuperHealth
{
    -COUNTITEM
    States
    {
    Spawn:
        TNT1 A 0
        goto SpawnGameModeCheck
    SpawnActual:
        TNT1 A 0 A_ChangeFlag("THRUACTORS",false)
        TNT1 A 0 A_ChangeFlag("NOTIMEFREEZE",false)
        TNT1 A 2
        wait
    PickupFail:
        TNT1 A 1
        fail
    }
}

Actor SamsaraRandomPowerupPartialInvisibility : PartialInvisibility
{
    -COUNTITEM
    States
    {
    Spawn:
        TNT1 A 2
        loop
    PickupFail:
        TNT1 A 1
        fail
    }
}


// Skulltag powerups will have to be manually
// copied over due to errors involving GZDoom
Actor SamsaraRandomPowerupGuardsphere : CustomInventory
{
    -COUNTITEM
    +NOGRAVITY
    Inventory.MaxAmount 0
    Inventory.PickupMessage "$PICKUP_GUARDSPHERE"
    Inventory.PickupSound "nosoundforyoubitch"
    Inventory.PickupAnnouncerEntry "guardsphere"
    States
    {
    Spawn:
        TNT1 A 2
        Loop

    Pickup:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupDoomStr")
        TNT1 A 1 A_JumpIfInventory("CorvusClass", 1, "PickupHeretic")
        TNT1 A 0 A_PlaySound("misc/p_pkup", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 1 A_GiveInventory("PowerQuarterDamage")
        TNT1 A 1 A_GiveInventory("PowerGuardsphereColor")
        Stop

    PickupDoomStr:
        TNT1 A 0 A_PlaySound("misc/p_pkup", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 A_GiveInventory("PowerQuarterDamage")
        TNT1 A 0 A_GiveInventory("PowerGuardsphereColorStr")
        Stop

    PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("GuardsphereHeretic", 0, "PickupFail")
        TNT1 A 0 A_PlaySound("heretic/itemget")
        TNT1 A 1 A_GiveInventory("GuardsphereHeretic")
        Stop

    PickupFail:
        TNT1 A 1
        Fail
    }
}

Actor SamsaraRandomPowerupTimeFreezeSphere : InvulnPowerup
{
    -COUNTITEM
    Inventory.PickupMessage "$PICKUP_TIMEFREEZER"
    RenderStyle Normal
    Alpha 1
    -BIGPOWERUP
    -FLOATBOB
    +NOGRAVITY
    -PICKUPFLASH
    -NOTIMEFREEZE // to remove
    -THRUACTORS // to remove
    States
    {
    Spawn:
        NVSI A 0 A_JumpIf(ACS_NamedExecuteWithResult("SamsaraDecorate", 38), "SpawnInvuln") // Placeholder sprite
        NVSI A 35 BRIGHT ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 75)
        wait
    SpawnInvuln:
        TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("SamsaraDecorate",28,0,0) == 1, "NoInvuln")
        NVLN A 35 BRIGHT ACS_NamedExecuteAlways("SamsaraClientDecorate", 0, 4, 100, 95)
        wait
    Pickup:
        TNT1 A 0 A_JumpIf(ACS_NamedExecuteWithResult("SamsaraDecorate", 38), "PickupInvuln")
    PickupTimeFreeze:
        TNT1 A 0 A_JumpIfInventory("DoomClassMode",2,"PickupTimeFreezeDoomguyStr")
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupTimeFreezeCorvus")
        TNT1 A -1 A_Jump(256,"PickupTimeFreezeNormal")
        wait

    PickupTimeFreezeNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("misc/p_pkup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezeNormalGiver")
        Stop
    PickupTimeFreezeDoomguyStr:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("misc/p_pkup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 A_GiveInventory("SamsaraPowerTimeFreezeStrongholdGiver")
        Stop
    PickupTimeFreezeCorvus:
        TNT1 A 0 A_JumpIfInventory("TimeFreezeSphereHeretic",0,"PickupFail")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 A_GiveInventory("TimeFreezeSphereHeretic")
        Stop
    PickupTimeFreezeDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 10, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("misc/p_pkup",CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 5)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 200)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupTimeFreezeDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupTimeFreezeDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupTimeFreezeDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupTimeFreezeDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeNormalGiver")
        stop
    PickupTimeFreezeDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro1Giver")
        stop
    PickupTimeFreezeDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro2Giver")
        stop
    PickupTimeFreezeDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro3Giver")
        stop
    PickupTimeFreezeDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerTimeFreezeDXEnviro4Giver")
        stop
    PickupFail:
        NVSI A 1 bright
        Fail
    }
}

Actor SamsaraRandomPowerupInvisibilitySphere : CustomInventory
{
    -COUNTITEM
    +NOGRAVITY
    +VISIBILITYPULSE
    Inventory.MaxAmount 0
    RenderStyle Translucent
    Inventory.PickupMessage "$PICKUP_INVISIBILITY"
    Inventory.PickupSound "nosoundforyoubitch"
    Inventory.PickupAnnouncerEntry "invisibility"
    States
    {
    Spawn:
        TNT1 A 2
        Loop

    Pickup:
        TNT1 A 1 A_JumpIfInventory("CorvusClass", 1, "PickupHeretic")
        TNT1 A 1 A_JumpIfInventory("HexenClass", 1, "PickupHexen")
        TNT1 A 1 A_JumpIfInventory("MarathonClass", 1, "PickupMarathon")
        TNT1 A 1 A_JumpIfInventory("QuakeClass", 1, "PickupQuake")
        TNT1 A 0 A_PlaySound("misc/p_pkup", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 1 A_GiveInventory("PowerTranslucency")
        Stop

    PickupHeretic:
        TNT1 A 0 A_JumpIfInventory("InvisibilitySphereHeretic", 0, "PickupHereticFail")
        TNT1 A 0 A_PlaySound("heretic/itemget")
        TNT1 A 1 A_GiveInventory("InvisibilitySphereHeretic")
        Stop

    PickupHereticFail:
        SINV A 1 bright
        Fail

    PickupHexen:
        TNT1 A 0 A_PlaySound("misc/p_pkup", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 1 A_GiveInventory("PowerGhost")
        Stop

    PickupMarathon:
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("marathon/bigitemget")
        TNT1 A 1 A_GiveInventory("PowerShadow")
        TNT1 A 1 A_GiveInventory("PowerShadow")
        Stop

    PickupQuake:
        TNT1 A 0 A_GiveInventory("QuakeInvisTimer", 1050)
        Stop
    }
}

Actor SamsaraRandomPowerupDoomSphere : CustomInventory
{
    -COUNTITEM
    +NOGRAVITY
    Inventory.MaxAmount 0
    Inventory.PickupMessage "$PICKUP_DOOMSPHERE"
    Inventory.PickupSound "nosoundforyoubitch"
    Inventory.PickupAnnouncerEntry "doomsphere"
    States
    {
    Spawn:
        CPRT N 0 BRIGHT
        CPRT N 35 BRIGHT
        wait
    Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupCorvus")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupDeusEx")
        TNT1 A -1 A_Jump(256,"PickupNormal")
        wait

    PickupNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterNormalGiver")
        stop
    PickupCorvus:
        TNT1 A 0 A_JumpIfInventory("DoomsphereHeretic",0,"PickupFail")
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        TNT1 A 1 A_GiveInventory("DoomsphereHeretic")
        stop
    PickupDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 13, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate",23)
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 8)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 250)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterNormalGiver")
        stop
    PickupDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro1Giver")
        stop
    PickupDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro2Giver")
        stop
    PickupDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro3Giver")
        stop
    PickupDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterDXEnviro4Giver")
        stop
    PickupFail:
        CPRT N 1 bright
        Fail
    }
}

Actor SamsaraRandomPowerupTurbosphere : CustomInventory
{
    -COUNTITEM
    +NOGRAVITY
    Inventory.MaxAmount 0
    Inventory.PickupMessage "$PICKUP_TURBOSPHERE"
    Inventory.PickupSound "nosoundforyoubitch"
    Inventory.PickupAnnouncerEntry "turbosphere"
    States
    {
    Spawn:
        CPRT O 0 BRIGHT
        CPRT O 35 BRIGHT
        wait

    Pickup:
        TNT1 A 0 A_JumpIfInventory("CorvusClass", 1, "CheckCorvus")
        TNT1 A 0 A_JumpIfInventory("HexenClass", 1, "CheckHexen")
        TNT1 A -1 A_Jump(256,"PickupActual")
        wait
    CheckCorvus:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven", 0, "PickupFail")
        goto PickupActual
    CheckHexen:
        TNT1 A 0 A_JumpIfInventory("SamsaraSpeedBootsPickupInventoryRaven", 0, "PickupFail")
        goto PickupActual
    PickupActual:
        TNT1 A 0 A_JumpIfInventory("CorvusClass",1,"PickupCorvus")
        TNT1 A 0 A_JumpIfInventory("HexenClass",1,"PickupHexen")
        TNT1 A 0 A_JumpIfInventory("DeusExClass",1,"PickupDeusEx")
        TNT1 A -1 A_Jump(256,"PickupNormal")
        wait
    PickupNormal:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterNormalGiver")
        stop
    PickupCorvus:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("heretic/itemget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 1 A_GiveInventory("SamsaraSpeedBootsPickupInventoryRaven")
        stop
    PickupHexen:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 19, 1)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 A_PlaySound("hexen/artiget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 1 A_GiveInventory("SamsaraSpeedBootsPickupInventoryRaven")
        stop
    PickupDeusEx:
        TNT1 A 0 ACS_NamedExecuteAlways("SamsaraPickupMessages", 0, 2, 11, 0)
        TNT1 A 0 A_GiveInventory("SamsaraPowerupPickupBlend")
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate",23)
        TNT1 A 0 A_PlaySound("damageboostget", CHAN_ITEM|CHAN_MAYBE_LOCAL)
        TNT1 A 0 ACS_NamedExecuteWithResult("SamsaraPickupAnnouncerSounds", 6)
        TNT1 A 0 ACS_NamedExecuteWithResult("DeusEx_Decorate", 26, 150)
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 4, "PickupDeusExEnviro4")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 3, "PickupDeusExEnviro3")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 2, "PickupDeusExEnviro2")
        TNT1 A 0 A_JumpIfInventory("DeusEx_EnviroSkill", 1, "PickupDeusExEnviro1")
        TNT1 A 1 A_GiveInventory("SamsaraPowerDamageBoosterNormalGiver")
        stop
    PickupDeusExEnviro1:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro1Giver")
        stop
    PickupDeusExEnviro2:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro2Giver")
        stop
    PickupDeusExEnviro3:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro3Giver")
        stop
    PickupDeusExEnviro4:
        TNT1 A 1 A_GiveInventory("SamsaraPowerSpeedBoosterDXEnviro4Giver")
        stop
    PickupFail:
        CPRT O 1 bright
        Fail
    }
}
